<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExcelWriter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">data-excel</a> &gt; <a href="index.source.html" class="el_package">org.molgenis.data.excel</a> &gt; <span class="el_source">ExcelWriter.java</span></div><h1>ExcelWriter.java</h1><pre class="source lang-java linenums">package org.molgenis.data.excel;

import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.molgenis.data.MolgenisDataException;
import org.molgenis.data.WritableFactory;
import org.molgenis.data.file.processor.CellProcessor;
import org.molgenis.data.meta.model.Attribute;
import org.molgenis.data.meta.model.AttributeFactory;
import org.molgenis.data.support.AbstractWritable.AttributeWriteMode;

import java.io.*;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

import static java.util.Objects.requireNonNull;

/**
 * Creates new Excel sheets
 */
public class ExcelWriter implements WritableFactory
{
	private final Workbook workbook;
	private final OutputStream os;
	private final AttributeFactory attrMetaFactory;
	private List&lt;CellProcessor&gt; cellProcessors;

<span class="fc" id="L31">	public enum FileFormat</span>
	{
<span class="fc" id="L33">		XLS, XLSX</span>
	}

	public ExcelWriter(OutputStream os, AttributeFactory attrMetaFactory)
	{
<span class="fc" id="L38">		this(os, attrMetaFactory, FileFormat.XLS);</span>
<span class="fc" id="L39">	}</span>

	public ExcelWriter(OutputStream os, AttributeFactory attrMetaFactory, FileFormat format)
<span class="fc" id="L42">	{</span>
<span class="fc" id="L43">		this.os = requireNonNull(os);</span>
<span class="fc" id="L44">		this.attrMetaFactory = requireNonNull(attrMetaFactory);</span>
<span class="fc bfc" id="L45" title="All 2 branches covered.">		this.workbook = requireNonNull(format) == FileFormat.XLS ? new HSSFWorkbook() : new XSSFWorkbook();</span>
<span class="fc" id="L46">	}</span>

	public ExcelWriter(File file, AttributeFactory attrMetaFactory) throws FileNotFoundException
	{
<span class="nc" id="L50">		this(new FileOutputStream(file), attrMetaFactory, FileFormat.XLS);</span>
<span class="nc" id="L51">	}</span>

	public ExcelWriter(File file, AttributeFactory attrMetaFactory, FileFormat format) throws FileNotFoundException
	{
<span class="nc" id="L55">		this(new FileOutputStream(file), attrMetaFactory, format);</span>
<span class="nc" id="L56">	}</span>

	public void addCellProcessor(CellProcessor cellProcessor)
	{
<span class="pc bpc" id="L60" title="1 of 2 branches missed.">		if (cellProcessors == null) cellProcessors = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L61">		cellProcessors.add(cellProcessor);</span>
<span class="fc" id="L62">	}</span>

	@Override
	public ExcelSheetWriter createWritable(String entityTypeId, Iterable&lt;Attribute&gt; attributes,
			AttributeWriteMode attributeWriteMode)
	{
<span class="fc" id="L68">		Sheet poiSheet = workbook.createSheet(entityTypeId);</span>
<span class="fc" id="L69">		return new ExcelSheetWriter(poiSheet, attributes, attributeWriteMode, cellProcessors);</span>
	}

	@Override
	public void close() throws IOException
	{
		try
		{
<span class="fc" id="L77">			workbook.write(os);</span>
		}
<span class="nc" id="L79">		catch (IOException e)</span>
		{
<span class="nc" id="L81">			throw new MolgenisDataException(&quot;Exception writing to excel file&quot;, e);</span>
<span class="fc" id="L82">		}</span>
<span class="fc" id="L83">		os.close();</span>
<span class="fc" id="L84">	}</span>

	@Override
	public ExcelSheetWriter createWritable(String entityTypeId, List&lt;String&gt; attributeNames)
	{
<span class="fc bfc" id="L89" title="All 2 branches covered.">		List&lt;Attribute&gt; attributes = attributeNames != null ? attributeNames.stream()</span>
<span class="fc" id="L90">																			.map(attrName -&gt; attrMetaFactory.create()</span>
<span class="fc" id="L91">																											.setName(</span>
																													attrName))
<span class="fc" id="L93">																			.collect(Collectors.toList()) : null;</span>

<span class="fc" id="L95">		return createWritable(entityTypeId, attributes, AttributeWriteMode.ATTRIBUTE_NAMES);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>