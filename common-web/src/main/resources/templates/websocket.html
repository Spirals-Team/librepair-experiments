<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Title</title>
</head>
<body>
<div>
    <label>token:</label>
    <input type="text" id="token"/>
    <button onclick="connect()" id="connect">连接</button>
    <button onclick="disconnect()" id="disconnect">断开</button>
</div>
<div>
    <label>msg:</label>
    <input type="text" id="name"/>
    <button id="send">发送</button>
    <label>接受对象:</label>
    <input type="text" id="to"/>
    <hr/>
    <div id="result"  style="overFlow-y:scroll; width:550px; height: 400px; border: solid black;">
        <div id="msg"></div>
        <a id="end" ></a>
    </div>
</div>

<script src="https://cdn.bootcss.com/stomp.js/2.3.3/stomp.min.js"></script>
<script src="https://cdn.bootcss.com/sockjs-client/1.1.4/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/web-socket-js/1.0.0/web_socket.min.js"></script>
<script>
    var stompClient = null;
    var socket;

    function connect() {
//        var socket = new SockJS("http://127.0.0.1:8080/endpoint");//连接SockJS的endpoint名称为"/endpoint"
//        stompClient = Stomp.over(socket);//使用STOMP子协议的WebSocket客户端
//        stompClient.connect({}, function (frame) {//连接WebSocket服务端
//            stompClient.subscribe("/topic/response", function (msg) {//通过stopmClient.subscribe订阅"/topic/response"目标发送的消息，这个路径是在控制器的@SendTo中定义的
//                console.log(msg);
//                var msgDom = document.getElementById("msg");
//                var html = msgDom.innerHTML;
//                msgDom.innerHTML = html + "\n" + msg.body;
//            });
//        });

        if (typeof(WebSocket) == "undefined") {
            console.log("您的浏览器不支持WebSocket");
        } else {
            console.log("您的浏览器支持WebSocket");
            var token = document.getElementById("token").value;
            socket = new WebSocket("ws://localhost:8080/endpoint/" + token);
            console.log(socket);
            //打开事件
            socket.onopen = function () {
                console.log("Socket 已打开");
                //socket.send("这是来自客户端的消息" + location.href + new Date());
            };
            //获得消息事件
            socket.onmessage = function (ret) {
                console.log(ret);
                //发现消息进入    调后台获取
                var msgDom = document.getElementById("msg");
                var html = msgDom.innerHTML;
                var jsonObject = JSON.parse(ret.data);
                msgDom.innerHTML = html + "<p>" + jsonObject.msg + "</p>";
//                document.getElementById("end").scrollIntoView();
                var div = document.getElementById("result");
                div.scrollTop = div.scrollHeight;
            };
            //关闭事件
            socket.onclose = function () {
                console.log("Socket已关闭");
            };
            //发生了错误事件
            socket.onerror = function () {
                alert("Socket发生了错误");
            };
            window.unload = function () {
                socket.close();
            };
        }
    }

    function disconnect() {
        if (socket != null) {
            socket.close();
        }
    }

    function send() {
        var name = document.getElementById("name").value;
        var to = document.getElementById("to").value;
        if (!socket) {
            alert('未连接!');
            return;
        }
        socket.send(JSON.stringify({
            'type':"test",
            'msg': name,
            'to':to
        }));
    }

    document.getElementById("send").onclick = send;
</script>
</body>
</html>