<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JobExecution.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jobs</a> &gt; <a href="index.source.html" class="el_package">org.molgenis.jobs.model</a> &gt; <span class="el_source">JobExecution.java</span></div><h1>JobExecution.java</h1><pre class="source lang-java linenums">package org.molgenis.jobs.model;

import org.apache.commons.lang3.StringUtils;
import org.molgenis.data.Entity;
import org.molgenis.data.meta.model.EntityType;
import org.molgenis.data.security.auth.User;
import org.molgenis.data.support.StaticEntity;

import javax.annotation.Nullable;
import java.time.Instant;

import static org.apache.commons.lang3.StringUtils.*;
import static org.molgenis.jobs.model.JobExecutionMetaData.*;

/**
 * Superclass that represents a job execution.
 * &lt;p&gt;
 * Do not add abstract identifier to this class, see EntitySerializerTest
 */
public class JobExecution extends StaticEntity
{
	public static final String TRUNCATION_BANNER = &quot;&lt;&lt;&lt; THIS LOG HAS BEEN TRUNCATED &gt;&gt;&gt;&quot;;
	/**
	 * If the progress message is larger than this value, it will be abbreviated.
	 * This value shouldn't exceed the max length of the {@link org.molgenis.data.meta.AttributeType#STRING}
	 */
	public static final int MAX_PROGRESS_MESSAGE_LENGTH = 255;
	/**
	 * If log is larger than this value, it will be truncated.
	 * This value shouldn't exceed the max length of the {@link org.molgenis.data.meta.AttributeType#TEXT}
	 */
	public static final int MAX_LOG_LENGTH = 65535;
<span class="pc" id="L33">	private boolean logTruncated = false;</span>

	public JobExecution(Entity entity)
	{
<span class="nc" id="L37">		super(entity);</span>
<span class="nc" id="L38">	}</span>

	public JobExecution(EntityType entityType)
	{
<span class="fc" id="L42">		super(entityType);</span>
<span class="fc" id="L43">	}</span>

	public JobExecution(String identifier, EntityType entityType)
	{
<span class="nc" id="L47">		super(entityType);</span>
<span class="nc" id="L48">		setIdentifier(identifier);</span>
<span class="nc" id="L49">	}</span>

	public String getIdentifier()
	{
<span class="nc" id="L53">		return getString(IDENTIFIER);</span>
	}

	public void setIdentifier(String value)
	{
<span class="fc" id="L58">		set(IDENTIFIER, value);</span>
<span class="fc" id="L59">	}</span>

	public String getUser()
	{
<span class="fc" id="L63">		return getString(USER);</span>
	}

	public void setUser(String username)
	{
<span class="fc" id="L68">		set(USER, username);</span>
<span class="fc" id="L69">	}</span>

	public void setUser(User value)
	{
<span class="nc" id="L73">		set(USER, value.getUsername());</span>
<span class="nc" id="L74">	}</span>

	public Status getStatus()
	{
<span class="nc" id="L78">		return Status.valueOf(getString(STATUS));</span>
	}

	public void setStatus(Status value)
	{
<span class="fc" id="L83">		set(STATUS, value.toString().toUpperCase());</span>
<span class="fc" id="L84">	}</span>

	public String getType()
	{
<span class="fc" id="L88">		return getString(TYPE);</span>
	}

	public void setType(String value)
	{
<span class="fc" id="L93">		set(TYPE, value);</span>
<span class="fc" id="L94">	}</span>

	public Instant getSubmissionDate()
	{
<span class="nc" id="L98">		return getInstant(SUBMISSION_DATE);</span>
	}

	public void setSubmissionDate(Instant value)
	{
<span class="nc" id="L103">		set(SUBMISSION_DATE, value);</span>
<span class="nc" id="L104">	}</span>

	@Nullable
	public Instant getStartDate()
	{
<span class="fc" id="L109">		return getInstant(START_DATE);</span>
	}

	public void setStartDate(Instant value)
	{
<span class="fc" id="L114">		set(START_DATE, value);</span>
<span class="fc" id="L115">	}</span>

	@Nullable
	public Instant getEndDate()
	{
<span class="nc" id="L120">		return getInstant(END_DATE);</span>
	}

	public void setEndDate(Instant value)
	{
<span class="fc" id="L125">		set(END_DATE, value);</span>
<span class="fc" id="L126">	}</span>

	@Nullable
	public Integer getProgressInt()
	{
<span class="fc" id="L131">		return getInt(PROGRESS_INT);</span>
	}

	public void setProgressInt(Integer value)
	{
<span class="fc" id="L136">		set(PROGRESS_INT, value);</span>
<span class="fc" id="L137">	}</span>

	@Nullable
	public String getProgressMessage()
	{
<span class="fc" id="L142">		return getString(PROGRESS_MESSAGE);</span>
	}

	public void setProgressMessage(String value)
	{
<span class="fc" id="L147">		set(PROGRESS_MESSAGE, StringUtils.abbreviate(value, MAX_PROGRESS_MESSAGE_LENGTH));</span>
<span class="fc" id="L148">	}</span>

	@Nullable
	public Integer getProgressMax()
	{
<span class="fc" id="L153">		return getInt(PROGRESS_MAX);</span>
	}

	public void setProgressMax(Integer value)
	{
<span class="fc" id="L158">		set(PROGRESS_MAX, value);</span>
<span class="fc" id="L159">	}</span>

	@Nullable
	public String getLog()
	{
<span class="fc" id="L164">		return getString(LOG);</span>
	}

	private void setLog(String value)
	{
<span class="fc" id="L169">		set(LOG, value);</span>
<span class="fc" id="L170">	}</span>

	@Nullable
	public String getResultUrl()
	{
<span class="nc" id="L175">		return getString(RESULT_URL);</span>
	}

	public void setResultUrl(String value)
	{
<span class="nc" id="L180">		set(RESULT_URL, value);</span>
<span class="nc" id="L181">	}</span>

	public String[] getSuccessEmail()
	{
<span class="fc" id="L185">		String email = getString(SUCCESS_EMAIL);</span>
<span class="fc bfc" id="L186" title="All 2 branches covered.">		if (isEmpty(email))</span>
		{
<span class="fc" id="L188">			return new String[] {};</span>
		}
<span class="fc" id="L190">		return email.split(&quot;,&quot;);</span>
	}

	public String[] getFailureEmail()
	{
<span class="fc" id="L195">		String email = getString(FAILURE_EMAIL);</span>
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">		if (isEmpty(email))</span>
		{
<span class="nc" id="L198">			return new String[] {};</span>
		}
<span class="fc" id="L200">		return email.split(&quot;,&quot;);</span>
	}

	public void setSuccessEmail(String successEmail)
	{
<span class="fc" id="L205">		set(SUCCESS_EMAIL, successEmail);</span>
<span class="fc" id="L206">	}</span>

	public void setFailureEmail(String failureEmail)
	{
<span class="fc" id="L210">		set(FAILURE_EMAIL, failureEmail);</span>
<span class="fc" id="L211">	}</span>

	public void setScheduledJobId(String scheduledJobId)
	{
<span class="nc" id="L215">		set(SCHEDULED_JOB_ID, scheduledJobId);</span>
<span class="nc" id="L216">	}</span>

	@Nullable
	public String getScheduledJobId()
	{
<span class="nc" id="L221">		return getString(SCHEDULED_JOB_ID);</span>
	}

	/**
	 * Appends a log message to the execution log.
	 * The first time the log exceeds MAX_LOG_LENGTH, it gets truncated and the TRUNCATION_BANNER gets added.
	 * Subsequent calls to appendLog will be ignored.
	 *
	 * @param formattedMessage The formatted message to append to the log.
	 */
	void appendLog(String formattedMessage)
	{
<span class="fc bfc" id="L233" title="All 2 branches covered.">		if (logTruncated) return;</span>
<span class="fc" id="L234">		String combined = join(getLog(), formattedMessage);</span>
<span class="fc bfc" id="L235" title="All 2 branches covered.">		if (combined.length() &gt; MAX_LOG_LENGTH)</span>
		{
<span class="fc" id="L237">			String truncated = abbreviate(combined, MAX_LOG_LENGTH - TRUNCATION_BANNER.length() * 2 - 2);</span>
<span class="fc" id="L238">			combined = join(new String[] { TRUNCATION_BANNER, truncated, TRUNCATION_BANNER }, &quot;\n&quot;);</span>
<span class="fc" id="L239">			logTruncated = true;</span>
		}
<span class="fc" id="L241">		setLog(combined);</span>
<span class="fc" id="L242">	}</span>

<span class="fc" id="L244">	public enum Status</span>
	{
<span class="fc" id="L246">		PENDING, RUNNING, SUCCESS, FAILED, CANCELED</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>