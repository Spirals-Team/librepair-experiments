<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VcfRepositoryCollection.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">data-vcf</a> &gt; <a href="index.source.html" class="el_package">org.molgenis.data.vcf</a> &gt; <span class="el_source">VcfRepositoryCollection.java</span></div><h1>VcfRepositoryCollection.java</h1><pre class="source lang-java linenums">package org.molgenis.data.vcf;

import com.google.common.collect.ImmutableSet;
import org.molgenis.data.Entity;
import org.molgenis.data.MolgenisDataException;
import org.molgenis.data.Repository;
import org.molgenis.data.file.support.FileRepositoryCollection;
import org.molgenis.data.meta.model.AttributeFactory;
import org.molgenis.data.meta.model.EntityType;
import org.molgenis.data.meta.model.EntityTypeFactory;
import org.molgenis.data.vcf.model.VcfAttributes;
import org.springframework.beans.factory.annotation.Autowired;

import java.io.File;
import java.io.IOException;
import java.util.Collections;
import java.util.Iterator;
import java.util.Set;

import static java.util.Objects.requireNonNull;

public class VcfRepositoryCollection extends FileRepositoryCollection
{
	public static final String NAME = &quot;VCF&quot;;
	private static final String EXTENSION_VCF = &quot;vcf&quot;;
	private static final String EXTENSION_VCF_GZ = &quot;vcf.gz&quot;;
	private static final String EXTENSION_VCF_ZIP = &quot;vcf.zip&quot;;
<span class="nc" id="L28">	static final Set&lt;String&gt; EXTENSIONS = ImmutableSet.of(EXTENSION_VCF, EXTENSION_VCF_GZ, EXTENSION_VCF_ZIP);</span>

	@Autowired
	private VcfAttributes vcfAttributes;

	@Autowired
	private EntityTypeFactory entityTypeFactory;

	@Autowired
	private AttributeFactory attrMetaFactory;

	private final File file;
	private final String entityTypeId;

	public VcfRepositoryCollection(File file)
	{
<span class="nc" id="L44">		super(EXTENSIONS);</span>
<span class="nc" id="L45">		this.file = requireNonNull(file);</span>

<span class="nc" id="L47">		String name = file.getName();</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">		if (name.toLowerCase().endsWith(EXTENSION_VCF))</span>
		{
<span class="nc" id="L50">			this.entityTypeId = name.substring(0, name.toLowerCase().lastIndexOf('.' + EXTENSION_VCF));</span>
		}
<span class="nc bnc" id="L52" title="All 2 branches missed.">		else if (name.toLowerCase().endsWith(EXTENSION_VCF_GZ))</span>
		{
<span class="nc" id="L54">			this.entityTypeId = name.substring(0, name.toLowerCase().lastIndexOf('.' + EXTENSION_VCF_GZ));</span>
		}
<span class="nc bnc" id="L56" title="All 2 branches missed.">		else if (name.toLowerCase().endsWith(EXTENSION_VCF_ZIP))</span>
		{
<span class="nc" id="L58">			this.entityTypeId = name.substring(0, name.toLowerCase().lastIndexOf('.' + EXTENSION_VCF_ZIP));</span>
		}
		else
		{
<span class="nc" id="L62">			throw new IllegalArgumentException(&quot;Not a VCF file [&quot; + file.getName() + &quot;]&quot;);</span>
		}
<span class="nc" id="L64">	}</span>

	@Override
	public void init() throws IOException
	{
		// no operation
<span class="nc" id="L70">	}</span>

	@Override
	public Iterable&lt;String&gt; getEntityTypeIds()
	{
<span class="nc" id="L75">		return Collections.singleton(entityTypeId);</span>
	}

	@Override
	public Repository&lt;Entity&gt; getRepository(String name)
	{
<span class="nc bnc" id="L81" title="All 2 branches missed.">		if (!entityTypeId.equals(name)) throw new MolgenisDataException(&quot;Unknown entity name [&quot; + name + &quot;]&quot;);</span>
<span class="nc" id="L82">		return new VcfRepository(file, name, vcfAttributes, entityTypeFactory, attrMetaFactory);</span>
	}

	@Override
	public String getName()
	{
<span class="nc" id="L88">		return NAME;</span>
	}

	@Override
	public Iterator&lt;Repository&lt;Entity&gt;&gt; iterator()
	{
<span class="nc" id="L94">		return new Iterator&lt;Repository&lt;Entity&gt;&gt;()</span>
<span class="nc" id="L95">		{</span>
<span class="nc" id="L96">			Iterator&lt;String&gt; it = getEntityTypeIds().iterator();</span>

			@Override
			public boolean hasNext()
			{
<span class="nc" id="L101">				return it.hasNext();</span>
			}

			@Override
			public Repository&lt;Entity&gt; next()
			{
<span class="nc" id="L107">				return getRepository(it.next());</span>
			}

		};
	}

	@Override
	public boolean hasRepository(String name)
	{
<span class="nc bnc" id="L116" title="All 2 branches missed.">		if (null == name) return false;</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">		for (String s : getEntityTypeIds())</span>
		{
<span class="nc bnc" id="L119" title="All 2 branches missed.">			if (s.equals(name)) return true;</span>
<span class="nc" id="L120">		}</span>
<span class="nc" id="L121">		return false;</span>
	}

	@Override
	public boolean hasRepository(EntityType entityType)
	{
<span class="nc" id="L127">		return hasRepository(entityType.getId());</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>