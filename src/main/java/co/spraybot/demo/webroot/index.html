<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>spraybot test chat</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.21.0/moment.min.js"></script>
    <script src="/app.js"></script>
    <style>
        html,
        body,
        #main-chat-window,
        #sidebar {
            max-height: 100vh;
            height: 100vh;
            min-height: 100vh;
        }

        html,
        body {
          overflow: hidden;
        }

        #received-chat-messages {
          overflow: auto;
          flex-direction: column-reverse;
        }

        #main-chat-window {
          padding-left: 16px;
          padding-bottom: 0;
          flex-direction: column-reverse;
        }

        #sidebar {
            padding-top: 16px;
        }

        .received-chat-message {
            padding-bottom: 8px;
        }

        .user-menu-avatar {
            height: 32px;
            width: 32px;
        }

        .fade-enter-active, .fade-leave-active {
            transition: opacity 1s;
        }

        .fade-enter, .fade-leave-to {
            opacity: 0;
        }
    </style>
  </head>
  <body>
    <section v-bind:class="{ 'is-paddingless': hasJoinedChat }" class="section" id="main-chrome">
      <div v-bind:class="{ 'is-fullhd': hasJoinedChat }" class="container">
        <template v-if="showUsernamePrompt">
          <h1 class="title">spraybot test chat</h1>
          <div class="field has-addons">
            <div class="control">
              <input v-on:keyup.enter="joinChat" v-model="username" class="input" type="text" placeholder="Your username"
                     autofocus/>
            </div>
            <div class="control">
              <a v-on:click="joinChat" v-bind:disabled="username == null" class="button is-primary">
                Join Chat
              </a>
            </div>
          </div>
          <p v-if="usernameError" class="help is-danger is-marginless">Please provide a valid username</p>


        </template>

        <transition name="fade">
          <template v-if="hasJoinedChat">
            <div class="columns">
              <div id="main-chat-window" class="column is-flex is-10">
                <div class="field has-addons is-marginless">
                  <div class="control is-expanded">
                    <input v-on:keyup.enter="sendChatMessage" v-on:keydown="newChatMessageError = null" v-model="newChatMessage" v-bind:class="{ 'is-danger': newChatMessageError }" class="input" type="text"
                           placeholder="Message #general" id="message-editor" v-focus/>
                  </div>
                  <div class="control">
                    <a v-on:click="sendChatMessage" v-bind:disabled="newChatMessage == null" class="button is-success">
                      <span class="icon">
                          <i class="fas fa-comment"></i>
                      </span>
                    </a>
                  </div>
                </div>

                <div id="received-chat-messages" class="is-flex">
                  <div class="received-chat-message" v-for="chatMessage in chatMessages">
                    <article class="media">
                      <figure class="media-left">
                        <img class="image is-32x32" v-bind:src="chatMessage.avatar" v-if="chatMessage.avatar != 'icon'" />
                        <div class="user-menu-avatar" v-if="chatMessage.avatar == 'icon'">
                          <span class="icon" >
                            <i class="far fa-user"></i>
                          </span>
                        </div>
                      </figure>
                      <div class="media-content">
                        <div class="content chat-message-header is-small is-marginless">
                          <strong>{{chatMessage.username}}</strong> <small>{{chatMessage.timestamp.fromNow()}}</small>
                        </div>
                        <div class="content chat-message-body">
                          {{chatMessage.message}}
                        </div>
                      </div>
                    </article>
                  </div>
                </div>
              </div>

              <div id="sidebar" class="column is-2">
                <aside class="menu">
                  <p class="menu-label">
                    Rooms
                  </p>
                  <ul class="menu-list">
                    <li><a class="is-active">#general</a></li>
                  </ul>

                  <p class="menu-label">
                    Users
                  </p>
                  <ul class="menu-list">
                    <li><a>
                      <div class="level">
                        <div class="level-left">
                          <div class="level-item">
                            <img src="https://robohash.org/spraybot.png?size=64x64" alt="spraybot avatar" class="image is-32x32"/>
                          </div>
                          <div class="level-item">
                            spraybot
                          </div>
                        </div>
                      </div>
                    </a></li>
                    <li><a>
                      <div class="level">
                        <div class="level-left">
                          <div class="level-item user-menu-avatar">
                            <span class="icon">
                                <i class="far fa-user"></i>
                            </span>
                          </div>
                          <div class="level-item">
                            {{username}}
                          </div>
                        </div>
                      </div>
                    </a></li>
                  </ul>
                </aside>
              </div>
            </div>
          </template>
        </transition>
      </div>
    </section>
  </body>
</html>