<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AppDbSettings.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core-ui</a> &gt; <a href="index.source.html" class="el_package">org.molgenis.core.ui.settings</a> &gt; <span class="el_source">AppDbSettings.java</span></div><h1>AppDbSettings.java</h1><pre class="source lang-java linenums">package org.molgenis.core.ui.settings;

import org.molgenis.core.ui.menumanager.MenuManagerServiceImpl;
import org.molgenis.data.meta.model.Attribute;
import org.molgenis.settings.AppSettings;
import org.molgenis.settings.DefaultSettingsEntity;
import org.molgenis.settings.DefaultSettingsEntityType;
import org.springframework.stereotype.Component;

import static java.util.Objects.requireNonNull;
import static org.molgenis.data.meta.AttributeType.*;

/**
 * Application settings that are read from a data source and persisted to a data source.
 */
@Component
public class AppDbSettings extends DefaultSettingsEntity implements AppSettings
{
	private static final long serialVersionUID = 1L;

	private static final String ID = &quot;app&quot;;

	public AppDbSettings()
	{
<span class="nc" id="L25">		super(ID);</span>
<span class="nc" id="L26">	}</span>

	@Component
	public static class Meta extends DefaultSettingsEntityType
	{
		private static final String TITLE = &quot;title&quot;;
		private static final String LOGO_NAVBAR_HREF = &quot;logo_href_navbar&quot;;
		private static final String LOGO_TOP_HREF = &quot;logo_href_top&quot;;
		private static final String FIXED_LOGO_HEIGHT = &quot;fixed_logo_height&quot;;
		private static final String FOOTER = &quot;footer&quot;;
		public static final String MENU = &quot;molgenis_menu&quot;;
		private static final String LANGUAGE_CODE = &quot;language_code&quot;;
		private static final String BOOTSTRAP_THEME = &quot;bootstrap_theme&quot;;
		private static final String CSS_HREF = &quot;css_href&quot;;

		private static final String TRACKING = &quot;tracking&quot;;
		private static final String TRACKING_CODE_FOOTER = &quot;tracking_code_footer&quot;;
		private static final String GOOGLE_ANALYTICS_IP_ANONYMIZATION = &quot;ga_privacy_friendly&quot;;
		private static final String GOOGLE_ANALYTICS_TRACKING_ID = &quot;ga_tracking_id&quot;;
		private static final String GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS = &quot;ga_acc_privacy_friendly&quot;;
		private static final String GOOGLE_ANALYTICS_TRACKING_ID_MOLGENIS = &quot;ga_tracking_id_mgs&quot;;
		private static final String GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS_MOLGENIS = &quot;ga_acc_privacy_friendly_mgs&quot;;
		private static final String AGGREGATE_THRESHOLD = &quot;aggregate_threshold&quot;;

		private static final String DEFAULT_TITLE = &quot;MOLGENIS&quot;;
		private static final String DEFAULT_LOGO_NAVBAR_HREF = &quot;/img/logo_molgenis_small.png&quot;;
<span class="nc" id="L52">		private static final Integer DEFAULT_FIXED_LOGO_HEIGHT = 150;</span>
		private static final String DEFAULT_LANGUAGE_CODE = &quot;en&quot;;
		private static final String DEFAULT_BOOTSTRAP_THEME = &quot;bootstrap-molgenis.min.css&quot;;
		private static final boolean DEFAULT_GOOGLE_ANALYTICS_IP_ANONYMIZATION = true;
		private static final boolean DEFAULT_GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS = false;
		private static final boolean DEFAULT_GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS_MOLGENIS = true;

		private static final String CUSTOM_JAVASCRIPT = &quot;custom_javascript&quot;;

		private final MenuManagerServiceImpl menuManagerServiceImpl;

		public Meta(MenuManagerServiceImpl menuManagerServiceImpl)
		{
<span class="nc" id="L65">			super(ID);</span>
<span class="nc" id="L66">			this.menuManagerServiceImpl = requireNonNull(menuManagerServiceImpl);</span>
<span class="nc" id="L67">		}</span>

		@Override
		public void init()
		{
<span class="nc" id="L72">			super.init();</span>
<span class="nc" id="L73">			setLabel(&quot;Application settings&quot;);</span>
<span class="nc" id="L74">			setDescription(&quot;General application settings.&quot;);</span>

<span class="nc" id="L76">			addAttribute(TITLE).setDataType(STRING)</span>
<span class="nc" id="L77">							   .setNillable(false)</span>
<span class="nc" id="L78">							   .setDefaultValue(DEFAULT_TITLE)</span>
<span class="nc" id="L79">							   .setLabel(&quot;Application title&quot;)</span>
<span class="nc" id="L80">							   .setDescription(&quot;Displayed in browser toolbar.&quot;);</span>
<span class="nc" id="L81">			addAttribute(LOGO_NAVBAR_HREF).setDataType(STRING)</span>
<span class="nc" id="L82">										  .setNillable(true)</span>
<span class="nc" id="L83">										  .setLabel(&quot;Logo in navigation bar&quot;)</span>
<span class="nc" id="L84">										  .setDefaultValue(DEFAULT_LOGO_NAVBAR_HREF)</span>
<span class="nc" id="L85">										  .setDescription(&quot;HREF to logo image used instead of home plugin label&quot;);</span>
<span class="nc" id="L86">			addAttribute(LOGO_TOP_HREF).setDataType(STRING)</span>
<span class="nc" id="L87">									   .setNillable(true)</span>
<span class="nc" id="L88">									   .setLabel(&quot;Logo above navigation bar&quot;)</span>
<span class="nc" id="L89">									   .setDescription(&quot;HREF to logo image&quot;);</span>
<span class="nc" id="L90">			addAttribute(FIXED_LOGO_HEIGHT).setDataType(INT)</span>
<span class="nc" id="L91">										   .setNillable(true)</span>
<span class="nc" id="L92">										   .setLabel(&quot;Fixed height top logo&quot;)</span>
<span class="nc" id="L93">										   .setDefaultValue(String.valueOf(DEFAULT_FIXED_LOGO_HEIGHT))</span>
<span class="nc" id="L94">										   .setDescription(&quot;Set fixed height for top logo in px&quot;);</span>
<span class="nc" id="L95">			addAttribute(FOOTER).setDataType(TEXT).setNillable(true).setLabel(&quot;Footer text&quot;);</span>
<span class="nc" id="L96">			addAttribute(MENU).setDataType(TEXT)</span>
<span class="nc" id="L97">							  .setNillable(true)</span>
<span class="nc" id="L98">							  .setDefaultValue(getDefaultMenuValue())</span>
<span class="nc" id="L99">							  .setLabel(&quot;Menu&quot;)</span>
<span class="nc" id="L100">							  .setDescription(&quot;JSON object that describes menu content.&quot;)</span>
<span class="nc" id="L101">							  .setValidationExpression(&quot;$('&quot; + MENU + &quot;').isValidJson().value()&quot;);</span>
<span class="nc" id="L102">			addAttribute(LANGUAGE_CODE).setDataType(STRING)</span>
<span class="nc" id="L103">									   .setNillable(false)</span>
<span class="nc" id="L104">									   .setDefaultValue(DEFAULT_LANGUAGE_CODE)</span>
<span class="nc" id="L105">									   .setLabel(&quot;Language code&quot;)</span>
<span class="nc" id="L106">									   .setDescription(&quot;ISO 639 alpha-2 or alpha-3 language code.&quot;);</span>
<span class="nc" id="L107">			addAttribute(BOOTSTRAP_THEME).setDataType(STRING)</span>
<span class="nc" id="L108">										 .setNillable(false)</span>
<span class="nc" id="L109">										 .setDefaultValue(DEFAULT_BOOTSTRAP_THEME)</span>
<span class="nc" id="L110">										 .setLabel(&quot;Bootstrap theme&quot;)</span>
<span class="nc" id="L111">										 .setDescription(</span>
												 &quot;CSS file name of theme (see molgenis-core-ui/src/main/resources/css/themes).&quot;);
<span class="nc" id="L113">			addAttribute(CSS_HREF).setDataType(STRING)</span>
<span class="nc" id="L114">								  .setNillable(true)</span>
<span class="nc" id="L115">								  .setLabel(&quot;CSS href&quot;)</span>
<span class="nc" id="L116">								  .setDescription(</span>
										  &quot;CSS file name to add custom CSS (see molgenis-core-ui/src/main/resources/css).&quot;);

<span class="nc" id="L119">			addAttribute(AGGREGATE_THRESHOLD).setDataType(INT)</span>
<span class="nc" id="L120">											 .setNillable(true)</span>
<span class="nc" id="L121">											 .setLabel(&quot;Aggregate threshold&quot;)</span>
<span class="nc" id="L122">											 .setDescription(</span>
													 &quot;Aggregate value counts below this threshold are reported as the threshold. (e.g. a count of 1 is reported as &lt;= 10)&quot;);

<span class="nc" id="L125">			addAttribute(CUSTOM_JAVASCRIPT).setDataType(TEXT)</span>
<span class="nc" id="L126">										   .setNillable(true)</span>
<span class="nc" id="L127">										   .setLabel(&quot;Custom javascript headers&quot;)</span>
<span class="nc" id="L128">										   .setDescription(</span>
												   &quot;Custom javascript headers, specified as comma separated list. These headers will be included in the molgenis header before the applications own javascript headers. Values not ending with the extension 'js' will be ignored&quot;);

			// tracking settings
<span class="nc" id="L132">			Attribute trackingAttr = addAttribute(TRACKING).setDataType(COMPOUND).setLabel(&quot;Tracking&quot;);</span>

<span class="nc" id="L134">			addAttribute(GOOGLE_ANALYTICS_IP_ANONYMIZATION).setParent(trackingAttr)</span>
<span class="nc" id="L135">														   .setDataType(BOOL)</span>
<span class="nc" id="L136">														   .setNillable(false)</span>
<span class="nc" id="L137">														   .setDefaultValue(String.valueOf(</span>
																   DEFAULT_GOOGLE_ANALYTICS_IP_ANONYMIZATION))
<span class="nc" id="L139">														   .setLabel(&quot;IP anonymization&quot;)</span>
<span class="nc" id="L140">														   .setDescription(</span>
																   &quot;Disables the cookie wall by using privacy friendly tracking (only works if google analytics accounts are configured correctly, see below)&quot;);
<span class="nc" id="L142">			addAttribute(GOOGLE_ANALYTICS_TRACKING_ID).setParent(trackingAttr)</span>
<span class="nc" id="L143">													  .setDataType(STRING)</span>
<span class="nc" id="L144">													  .setNillable(true)</span>
<span class="nc" id="L145">													  .setLabel(&quot;Google analytics tracking ID&quot;)</span>
<span class="nc" id="L146">													  .setDescription(&quot;Google analytics tracking ID (e.g. UA-XXXX-Y)&quot;);</span>
<span class="nc" id="L147">			addAttribute(GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS).setParent(trackingAttr)</span>
<span class="nc" id="L148">																			.setDataType(BOOL)</span>
<span class="nc" id="L149">																			.setNillable(false)</span>
<span class="nc" id="L150">																			.setDefaultValue(String.valueOf(</span>
																					DEFAULT_GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS))
<span class="nc" id="L152">																			.setLabel(</span>
																					&quot;Google analytics account privacy friendly&quot;)
<span class="nc" id="L154">																			.setDescription(</span>
																					&quot;Confirm that you have configured your Google Analytics account as described here: https://cbpweb.nl/sites/default/files/atoms/files/handleiding_privacyvriendelijk_instellen_google_analytics_0.pdf&quot;);
<span class="nc" id="L156">			addAttribute(GOOGLE_ANALYTICS_TRACKING_ID_MOLGENIS).setParent(trackingAttr)</span>
<span class="nc" id="L157">															   .setDataType(STRING)</span>
<span class="nc" id="L158">															   .setNillable(true)</span>
<span class="nc" id="L159">															   .setLabel(&quot;Google analytics tracking ID (MOLGENIS)&quot;)</span>
<span class="nc" id="L160">															   .setDescription(</span>
																	   &quot;Google analytics tracking ID used by MOLGENIS&quot;);
<span class="nc" id="L162">			addAttribute(GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS_MOLGENIS).setParent(trackingAttr)</span>
<span class="nc" id="L163">																					 .setDataType(BOOL)</span>
<span class="nc" id="L164">																					 .setNillable(false)</span>
<span class="nc" id="L165">																					 .setDefaultValue(String.valueOf(</span>
																							 DEFAULT_GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS_MOLGENIS))
<span class="nc" id="L167">																					 .setReadOnly(true)</span>
<span class="nc" id="L168">																					 .setLabel(</span>
																							 &quot;Google analytics account privacy friendly (MOLGENIS)&quot;)
<span class="nc" id="L170">																					 .setDescription(</span>
																							 &quot;Confirm that the MOLGENIS Google Analytics account is configured as described here: https://cbpweb.nl/sites/default/files/atoms/files/handleiding_privacyvriendelijk_instellen_google_analytics_0.pdf&quot;);
<span class="nc" id="L172">			addAttribute(TRACKING_CODE_FOOTER).setParent(trackingAttr)</span>
<span class="nc" id="L173">											  .setDataType(SCRIPT)</span>
<span class="nc" id="L174">											  .setNillable(true)</span>
<span class="nc" id="L175">											  .setLabel(&quot;Tracking code footer&quot;)</span>
<span class="nc" id="L176">											  .setDescription(</span>
													  &quot;JS tracking code that is placed in the footer HTML (e.g. PiWik). This enables the cookie wall.&quot;);
<span class="nc" id="L178">		}</span>

		private String getDefaultMenuValue()
		{
<span class="nc" id="L182">			return menuManagerServiceImpl.getDefaultMenuValue();</span>
		}
	}

	@Override
	public String getTitle()
	{
<span class="nc" id="L189">		return getString(Meta.TITLE);</span>
	}

	@Override
	public void setTitle(String title)
	{
<span class="nc" id="L195">		set(Meta.TITLE, title);</span>
<span class="nc" id="L196">	}</span>

	@Override
	public String getLogoTopHref()
	{
<span class="nc" id="L201">		return getString(Meta.LOGO_TOP_HREF);</span>
	}

	@Override
	public void setLogoTopHref(String logoHref)
	{
<span class="nc" id="L207">		set(Meta.LOGO_TOP_HREF, logoHref);</span>
<span class="nc" id="L208">	}</span>

	@Override
	public Integer getFixedHeightLogo()
	{
<span class="nc" id="L213">		return getInt(Meta.FIXED_LOGO_HEIGHT);</span>
	}

	@Override
	public void setFixedHeightLogo(int fixedHeight)
	{
<span class="nc" id="L219">		set(Meta.FIXED_LOGO_HEIGHT, fixedHeight);</span>
<span class="nc" id="L220">	}</span>

	@Override
	public String getLogoNavBarHref()
	{
<span class="nc" id="L225">		return getString(Meta.LOGO_NAVBAR_HREF);</span>
	}

	@Override
	public void setLogoNavBarHref(String logoHref)
	{
<span class="nc" id="L231">		set(Meta.LOGO_NAVBAR_HREF, logoHref);</span>
<span class="nc" id="L232">	}</span>

	@Override
	public String getFooter()
	{
<span class="nc" id="L237">		return getString(Meta.FOOTER);</span>
	}

	@Override
	public void setFooter(String footerText)
	{
<span class="nc" id="L243">		set(Meta.FOOTER, footerText);</span>
<span class="nc" id="L244">	}</span>

	@Override
	public String getLanguageCode()
	{
<span class="nc" id="L249">		return getString(Meta.LANGUAGE_CODE);</span>
	}

	@Override
	public void setLanguageCode(String languageCode)
	{
<span class="nc" id="L255">		set(Meta.LANGUAGE_CODE, languageCode);</span>
<span class="nc" id="L256">	}</span>

	@Override
	public String getBootstrapTheme()
	{
<span class="nc" id="L261">		return getString(Meta.BOOTSTRAP_THEME);</span>
	}

	@Override
	public void setBootstrapTheme(String bootstrapTheme)
	{
<span class="nc" id="L267">		set(Meta.BOOTSTRAP_THEME, bootstrapTheme);</span>
<span class="nc" id="L268">	}</span>

	@Override
	public String getCssHref()
	{
<span class="nc" id="L273">		return getString(Meta.CSS_HREF);</span>
	}

	@Override
	public void setCssHref(String cssHref)
	{
<span class="nc" id="L279">		set(Meta.CSS_HREF, cssHref);</span>
<span class="nc" id="L280">	}</span>

	@Override
	public String getMenu()
	{
<span class="nc" id="L285">		return getString(Meta.MENU);</span>
	}

	@Override
	public void setMenu(String menuJson)
	{
<span class="nc" id="L291">		set(Meta.MENU, menuJson);</span>
<span class="nc" id="L292">	}</span>

	@Override
	public String getTrackingCodeFooter()
	{
<span class="nc" id="L297">		return getString(Meta.TRACKING_CODE_FOOTER);</span>
	}

	@Override
	public void setTrackingCodeFooter(String trackingCodeHeader)
	{
<span class="nc" id="L303">		set(Meta.TRACKING_CODE_FOOTER, trackingCodeHeader);</span>
<span class="nc" id="L304">	}</span>

	@Override
	public String getGoogleAnalyticsTrackingId()
	{
<span class="nc" id="L309">		return getString(Meta.GOOGLE_ANALYTICS_TRACKING_ID);</span>
	}

	@Override
	public void setGoogleAnalyticsTrackingId(String trackingCodeFooter)
	{
<span class="nc" id="L315">		set(Meta.GOOGLE_ANALYTICS_TRACKING_ID, trackingCodeFooter);</span>
<span class="nc" id="L316">	}</span>

	@Override
	public String getGoogleAnalyticsTrackingIdMolgenis()
	{
<span class="nc" id="L321">		return getString(Meta.GOOGLE_ANALYTICS_TRACKING_ID_MOLGENIS);</span>
	}

	@Override
	public void setGoogleAnalyticsTrackingIdMolgenis(String googleAnalyticsTrackingIdMolgenis)
	{
<span class="nc" id="L327">		set(Meta.GOOGLE_ANALYTICS_TRACKING_ID_MOLGENIS, googleAnalyticsTrackingIdMolgenis);</span>
<span class="nc" id="L328">	}</span>

	@Override
	public Integer getAggregateThreshold()
	{
<span class="nc" id="L333">		return getInt(Meta.AGGREGATE_THRESHOLD);</span>
	}

	@Override
	public void setAggregateThreshold(Integer threshold)
	{
<span class="nc" id="L339">		set(Meta.AGGREGATE_THRESHOLD, threshold);</span>
<span class="nc" id="L340">	}</span>

	@Override
	public boolean getGoogleAnalyticsIpAnonymization()
	{
<span class="nc" id="L345">		Boolean value = getBoolean(Meta.GOOGLE_ANALYTICS_IP_ANONYMIZATION);</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">		return value != null ? value : false;</span>
	}

	@Override
	public void setGoogleAnalyticsIpAnonymization(boolean googleAnalyticsIpAnonymization)
	{
<span class="nc" id="L352">		set(Meta.GOOGLE_ANALYTICS_IP_ANONYMIZATION, googleAnalyticsIpAnonymization);</span>
<span class="nc" id="L353">	}</span>

	@Override
	public boolean getGoogleAnalyticsAccountPrivacyFriendly()
	{
<span class="nc" id="L358">		Boolean value = getBoolean(Meta.GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS);</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">		return value != null ? value : false;</span>
	}

	@Override
	public void setGoogleAnalyticsAccountPrivacyFriendly(boolean googleAnalyticsAccountPrivacyFriendly)
	{
<span class="nc" id="L365">		set(Meta.GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS, googleAnalyticsAccountPrivacyFriendly);</span>
<span class="nc" id="L366">	}</span>

	@Override
	public boolean getGoogleAnalyticsAccountPrivacyFriendlyMolgenis()
	{
<span class="nc" id="L371">		Boolean value = getBoolean(Meta.GOOGLE_ANALYTICS_ACCOUNT_PRIVACY_FRIENDLY_SETTINGS_MOLGENIS);</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">		return value != null ? value : false;</span>
	}

	@Override
	public void setCustomJavascript(String customJavascript)
	{
<span class="nc" id="L378">		set(Meta.CUSTOM_JAVASCRIPT, customJavascript);</span>
<span class="nc" id="L379">	}</span>

	@Override
	public String getCustomJavascript()
	{
<span class="nc" id="L384">		return getString(Meta.CUSTOM_JAVASCRIPT);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>