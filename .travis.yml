#after_success:
#  - bash <(curl -s https://codecov.io/bash)

language: java
dist: trusty
install: skip

cache:
  directories:
    - $HOME/.m2/repository

stages:
  - compile
  - test
  - integrationtest
  - codequality

jobs:
  include:

    # compile against all supported JDK versions
    - stage: compile
      jdk: openjdk8
      install: skip
      script: mvn compile
    - stage: compile
      jdk: oraclejdk8
      install: skip
      script: mvn compile
#    - stage: compile
#      jdk: openjdk9
#      install: skip
#      script: mvn compile
#    - stage: compile
#      jdk: oraclejdk9
#      install: skip
#      script: mvn compile
#    - stage: compile
#      jdk: openjdk10
#      install: skip
#      script: mvn compile
#    - stage: compile
#      jdk: oraclejdk10
#      install: skip
#      script: mvn compile

    # run unit tests against base JDK versions
    - stage: test
      jdk: openjdk8
      script: mvn test -DskipIntegrationTests=true
    - stage: test
      jdk: oraclejdk8
      script: mvn test -DskipIntegrationTests=true

    # run integration tests against base JDK versions and dockerized Selenium Grid
    - stage: integrationtest
      jdk: openjdk8
      services: docker
      sudo: required
      env:
        - BROWSER=Firefox
      before_script: docker-compose up -d
      script: >
        mvn test
        -DskipUnitTests=true
        -DtestProfile=remote
        -Dremote.browser.name=firefox
        -Dremote.firefox.marionette=false
        -DtestPageServerHost=172.17.0.1
    - stage: integrationtest
      jdk: openjdk8
      services: docker
      sudo: required
      env:
        - BROWSER=Chrome
      before_script: docker-compose up -d
      script: >
        mvn test
        -DskipUnitTests=true
        -DtestProfile=remote
        -Dremote.browser.name=chrome
        -DtestPageServerHost=172.17.0.1
    - stage: integrationtest
      jdk: oraclejdk8
      services: docker
      sudo: required
      env:
        - BROWSER=Firefox
      before_script: docker-compose up -d
      script: >
        mvn test
        -DskipUnitTests=true
        -DtestProfile=remote
        -Dremote.browser.name=firefox
        -Dremote.firefox.marionette=false
        -DtestPageServerHost=172.17.0.1
    - stage: integrationtest
      jdk: oraclejdk8
      services: docker
      sudo: required
      env:
        - BROWSER=Chrome
      before_script: docker-compose up -d
      script: >
        mvn test
        -DskipUnitTests=true
        -DtestProfile=remote
        -Dremote.browser.name=chrome
        -DtestPageServerHost=172.17.0.1

    # check code quality using tools like PMD and FindBugs
    - stage: codequality
      jdk: openjdk8
      script: >
        mvn verify
        -P code-quality,documentation,release
        -DskipUnitTests=true
        -DskipIntegrationTests=true
    - stage: codequality
      jdk: oraclejdk8
      script: >
        mvn verify
        -P code-quality,documentation,release
        -DskipUnitTests=true
        -DskipIntegrationTests=true
