sudo: false
os: linux
dist: trusty

services:
  - docker

language: java

matrix:
  include:
    - jdk: openjdk7
      if: type != cron AND type != api
      env: TYPE=AES128
    - jdk: oraclejdk8
      if: type != cron AND type != api
      env: TYPE=AES128
    - jdk: openjdk7
      if: type != cron AND type != api
      env: TYPE=AES256
    - jdk: oraclejdk8
      if: type != cron AND type != api
      env: TYPE=AES256
    - jdk: oraclejdk8
      if: type = cron OR type = api

script:
  - echo $TRAVIS_EVENT_TYPE
  - if  [ "$TRAVIS_EVENT_TYPE" != "cron" ] && [ "$TRAVIS_EVENT_TYPE" != "api" ] ; then wget https://archive.apache.org/dist/maven/maven-3/3.1.1/binaries/apache-maven-3.1.1-bin.zip ; fi
  - if  [ "$TRAVIS_EVENT_TYPE" != "cron" ] && [ "$TRAVIS_EVENT_TYPE" != "api" ] ; then unzip -qq apache-maven-3.1.1-bin.zip ; fi
  - if  [ "$TRAVIS_EVENT_TYPE" != "cron" ] && [ "$TRAVIS_EVENT_TYPE" != "api" ] ; then export M2_HOME=$PWD/apache-maven-3.1.1 ; fi
  - if  [ "$TRAVIS_EVENT_TYPE" != "cron" ] && [ "$TRAVIS_EVENT_TYPE" != "api" ] ; then export PATH=$M2_HOME/bin:$PATH; fi
  - if  [ "$TRAVIS_EVENT_TYPE" == "cron" ] || [ "$TRAVIS_EVENT_TYPE" == "api" ] ; then bash ./scripts/keepSync.sh ; else bash ./scripts/travis-deploy.sh; fi

before_deploy:
  - echo "Now deploying things !"
  - git config --local user.name "Villena Guillaume"
  - git config --local user.email "guiguivil@gmail.com"
  - source VERSION
deploy:
  provider: releases
  api_key: $GH_TOKEN
  overwrite: true
  file_glob: true
  file: /home/travis/build/Willena/sqlite-jdbc-crypt/target/sqlite-jdbc-*-SNAPSHOT.jar
  skip_cleanup: true
  name: SQLite-jdbc-$version
  on:
    tag: true
