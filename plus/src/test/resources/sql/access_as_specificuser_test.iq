# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to you under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
!use CALCITE_WITH_GENERAL_CONDITION_SPECIFICUSER
!set outputformat mysql

# count returns number of rows in table
SELECT COUNT(*) as C1 FROM chinook.album;
 java.sql.SQLException: Error while executing SQL "SELECT COUNT(*) as C1 FROM chinook.album": From line 1, column 28 to line 1, column 40: Not allowed to perform SELECT on [CHINOOK, ALBUM]
 	at org.apache.calcite.avatica.Helper.createException(Helper.java:56)
 	at org.apache.calcite.avatica.Helper.createException(Helper.java:41)
 	at org.apache.calcite.avatica.AvaticaStatement.executeInternal(AvaticaStatement.java:163)
 	at org.apache.calcite.avatica.AvaticaStatement.executeQuery(AvaticaStatement.java:227)
 	at net.hydromatic.quidem.Quidem.checkResult(Quidem.java:322)
 	at net.hydromatic.quidem.Quidem.access$2800(Quidem.java:54)
 	at net.hydromatic.quidem.Quidem$ContextImpl.checkResult(Quidem.java:1747)
 	at net.hydromatic.quidem.Quidem$CheckResultCommand.execute(Quidem.java:1078)
 	at net.hydromatic.quidem.Quidem$CompositeCommand.execute(Quidem.java:1548)
 	at net.hydromatic.quidem.Quidem.execute(Quidem.java:216)
 	at org.apache.calcite.test.QuidemTest.checkRun(QuidemTest.java:175)
 	at org.apache.calcite.test.QuidemTest.test(QuidemTest.java:212)
 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
 	at java.lang.reflect.Method.invoke(Method.java:498)
 	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
 	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
 	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
 	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
 	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
 	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
 	at org.apache.maven.surefire.junitcore.pc.Scheduler$1.run(Scheduler.java:410)
 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
 	at java.lang.Thread.run(Thread.java:748)
 Caused by: org.apache.calcite.runtime.CalciteContextException: From line 1, column 28 to line 1, column 40: Not allowed to perform SELECT on [CHINOOK, ALBUM]
 	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
 	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
 	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
 	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
 	at org.apache.calcite.runtime.Resources$ExInstWithCause.ex(Resources.java:463)
 	at org.apache.calcite.sql.SqlUtil.newContextException(SqlUtil.java:783)
 	at org.apache.calcite.sql.SqlUtil.newContextException(SqlUtil.java:768)
 	at org.apache.calcite.sql.validate.SqlValidatorImpl.newValidationError(SqlValidatorImpl.java:4779)
 	at org.apache.calcite.sql.validate.SqlValidatorImpl.validateAccess(SqlValidatorImpl.java:4612)
 	at org.apache.calcite.sql.validate.SqlValidatorImpl.validateQuery(SqlValidatorImpl.java:953)
 	at org.apache.calcite.sql.validate.SqlValidatorImpl.validateFrom(SqlValidatorImpl.java:3027)
 	at org.apache.calcite.sql.validate.SqlValidatorImpl.validateFrom(SqlValidatorImpl.java:3012)
 	at org.apache.calcite.sql.validate.SqlValidatorImpl.validateSelect(SqlValidatorImpl.java:3271)
 	at org.apache.calcite.sql.validate.SelectNamespace.validateImpl(SelectNamespace.java:60)
 	at org.apache.calcite.sql.validate.AbstractNamespace.validate(AbstractNamespace.java:84)
 	at org.apache.calcite.sql.validate.SqlValidatorImpl.validateNamespace(SqlValidatorImpl.java:965)
 	at org.apache.calcite.sql.validate.SqlValidatorImpl.validateQuery(SqlValidatorImpl.java:944)
 	at org.apache.calcite.sql.SqlSelect.validate(SqlSelect.java:225)
 	at org.apache.calcite.sql.validate.SqlValidatorImpl.validateScopedExpression(SqlValidatorImpl.java:919)
 	at org.apache.calcite.sql.validate.SqlValidatorImpl.validate(SqlValidatorImpl.java:629)
 	at org.apache.calcite.sql2rel.SqlToRelConverter.convertQuery(SqlToRelConverter.java:552)
 	at org.apache.calcite.prepare.Prepare.prepareSql(Prepare.java:264)
 	at org.apache.calcite.prepare.Prepare.prepareSql(Prepare.java:230)
 	at org.apache.calcite.prepare.CalcitePrepareImpl.prepare2_(CalcitePrepareImpl.java:773)
 	at org.apache.calcite.prepare.CalcitePrepareImpl.prepare_(CalcitePrepareImpl.java:638)
 	at org.apache.calcite.prepare.CalcitePrepareImpl.prepareSql(CalcitePrepareImpl.java:608)
 	at org.apache.calcite.jdbc.CalciteConnectionImpl.parseQuery(CalciteConnectionImpl.java:238)
 	at org.apache.calcite.jdbc.CalciteMetaImpl.prepareAndExecute(CalciteMetaImpl.java:550)
 	at org.apache.calcite.avatica.AvaticaConnection.prepareAndExecuteInternal(AvaticaConnection.java:675)
 	at org.apache.calcite.avatica.AvaticaStatement.executeInternal(AvaticaStatement.java:156)
 	... 27 more
 Caused by: org.apache.calcite.sql.validate.SqlValidatorException: Not allowed to perform SELECT on [CHINOOK, ALBUM]
 	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
 	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
 	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
 	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
 	at org.apache.calcite.runtime.Resources$ExInstWithCause.ex(Resources.java:463)
 	at org.apache.calcite.runtime.Resources$ExInst.ex(Resources.java:572)
 	... 52 more
!error

# count returns number of rows in table
SELECT COUNT(*) as C1 FROM enhanced.preferred_tracks;
+------+
| C1   |
+------+
| 3503 |
+------+
(1 row)

!ok
