<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_121) on Fri May 25 13:21:42 CEST 2018 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>LockService (Hekate 2.4.0-SNAPSHOT)</title>
<meta name="date" content="2018-05-25">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="LockService (Hekate 2.4.0-SNAPSHOT)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6,"i1":6,"i2":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<link rel="stylesheet" href="../../../highlight/styles/idea.css">                         <link rel="stylesheet" href="../../../jquery/jquery-ui.structure.min.css">                         <link rel="stylesheet" href="../../../jquery/jquery-ui.min.css">                         <link rel="stylesheet" href="../../../jquery/jquery-ui.theme.min.css">                         <link rel="stylesheet" href="../../../style.css">                         <script src="../../../highlight/highlight.pack.js"></script>                         <script src="../../../jquery/jquery.min.js"></script>                         <script src="../../../jquery/jquery-ui.min.js"></script>                         <script>                             hljs.initHighlightingOnLoad();                              $( function() {                                 $(".tabs").tabs();                              });                         </script>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/LockService.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../io/hekate/lock/LockRegionConfig.html" title="class in io.hekate.lock"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../io/hekate/lock/LockServiceFactory.html" title="class in io.hekate.lock"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?io/hekate/lock/LockService.html" target="_top">Frames</a></li>
<li><a href="LockService.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">io.hekate.lock</div>
<h2 title="Interface LockService" class="title">Interface LockService</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Superinterfaces:</dt>
<dd><a href="../../../io/hekate/core/service/Service.html" title="interface in io.hekate.core.service">Service</a></dd>
</dl>
<hr>
<br>
<pre><a href="../../../io/hekate/core/service/DefaultServiceFactory.html" title="annotation in io.hekate.core.service">@DefaultServiceFactory</a>(<a href="../../../io/hekate/core/service/DefaultServiceFactory.html#value--">value</a>=<a href="../../../io/hekate/lock/LockServiceFactory.html" title="class in io.hekate.lock">LockServiceFactory.class</a>)
public interface <span class="typeNameLabel">LockService</span>
extends <a href="../../../io/hekate/core/service/Service.html" title="interface in io.hekate.core.service">Service</a></pre>
<div class="block"><span class="startHere">&laquo; start here</span>Main entry point to distributed locks API.

 <h2>Overview</h2>
 <p>
 <a href="../../../io/hekate/lock/LockService.html" title="interface in io.hekate.lock"><code>LockService</code></a> provides support for mutually exclusive distributed locks. Each lock can be obtained only by a single node within
 the cluster. All other nodes that are trying to obtain the same lock will be kept waiting until the lock is released by the owner node
 or until the owner node goes down and leaves the cluster.
 </p>

 <h2>Service configuration</h2>
 <p>
 <a href="../../../io/hekate/lock/LockService.html" title="interface in io.hekate.lock"><code>LockService</code></a> can be registered and configured in <a href="../../../io/hekate/core/HekateBootstrap.html" title="class in io.hekate.core"><code>HekateBootstrap</code></a> with the help of <a href="../../../io/hekate/lock/LockServiceFactory.html" title="class in io.hekate.lock"><code>LockServiceFactory</code></a> as shown in
 the example below:
 </p>

 <div class="tabs">
 <ul>
 <li><a href="#configure-java">Java</a></li>
 <li><a href="#configure-xsd">Spring XSD</a></li>
 <li><a href="#configure-bean">Spring bean</a></li>
 </ul>
 <div id="configure-java">
<div class="doc_source">
<pre><code class="java">
// Prepare lock service factory.
LockServiceFactory factory = new LockServiceFactory()
    // Register some lock regions.
    .withRegion(new LockRegionConfig()
        .withName("region1")
    )
    .withRegion(new LockRegionConfig()
        .withName("region2")
    );

// Start node.
Hekate hekate = new HekateBootstrap()
    .withService(factory)
    .join();
</code></pre>
</div>
 </div>
 <div id="configure-xsd">
 <b>Note:</b> This example requires Spring Framework integration
 (see <a href="../../../io/hekate/spring/bean/HekateSpringBootstrap.html">HekateSpringBootstrap</a>).
<div class="doc_source">
<pre><code class="xml">
&lt;beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:h="http://www.hekate.io/spring/hekate-core"
    xmlns="http://www.springframework.org/schema/beans"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.hekate.io/spring/hekate-core
        http://www.hekate.io/spring/hekate-core.xsd"&gt;

    &lt;h:node id="hekate"&gt;
        &lt;!-- Lock service. --&gt;
        &lt;h:locks&gt;
            &lt;!-- Register some lock regions. --&gt;
            &lt;h:region name="region1"/&gt;
            &lt;h:region name="region2"/&gt;
        &lt;/h:locks&gt;

        &lt;!-- ...other services... --&gt;
    &lt;/h:node&gt;
&lt;/beans&gt;
</code></pre>
</div>
 </div>
 <div id="configure-bean">
 <b>Note:</b> This example requires Spring Framework integration
 (see <a href="../../../io/hekate/spring/bean/HekateSpringBootstrap.html">HekateSpringBootstrap</a>).
<div class="doc_source">
<pre><code class="xml">
&lt;beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://www.springframework.org/schema/beans"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

    &lt;bean id="hekate" class="io.hekate.spring.bean.HekateSpringBootstrap"&gt;
        &lt;property name="services"&gt;
            &lt;list&gt;
                &lt;!-- Lock service. --&gt;
                &lt;bean class="io.hekate.lock.LockServiceFactory"&gt;
                    &lt;property name="regions"&gt;
                        &lt;list&gt;
                            &lt;!-- Register some lock regions. --&gt;
                            &lt;bean class="io.hekate.lock.LockRegionConfig"&gt;
                                &lt;property name="name" value="region1"/&gt;
                            &lt;/bean&gt;
                            &lt;bean class="io.hekate.lock.LockRegionConfig"&gt;
                                &lt;property name="name" value="region2"/&gt;
                            &lt;/bean&gt;
                        &lt;/list&gt;
                    &lt;/property&gt;
                &lt;/bean&gt;

                &lt;!-- ...other services... --&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
</div>
 </div>
 </div>

 <h2>Accessing service</h2>
 <p>
 <a href="../../../io/hekate/lock/LockService.html" title="interface in io.hekate.lock"><code>LockService</code></a> can be accessed via the <a href="../../../io/hekate/core/Hekate.html#locks--"><code>Hekate.locks()</code></a> method as in the example below:
<div class="doc_source">
<pre><code class="java">
LockService locks = hekate.locks();
</code></pre>
</div>
 </p>

 <h2>Locks and Regions</h2>
 <p>
 Each lock within the lock service is identified by its <a href="../../../io/hekate/lock/DistributedLock.html#name--"><code>name</code></a> and a <a href="../../../io/hekate/lock/LockRegion.html" title="interface in io.hekate.lock"><code>LockRegion</code></a>. Lock name is
 an arbitrary string which can be dynamically constructed and doesn't require any pre-registration within the lock service. Each <a href="../../../io/hekate/lock/LockRegion.html" title="interface in io.hekate.lock"><code>LockRegion</code></a> acts as an independent namespace for locks and must be pre-registered within the <a href="../../../io/hekate/lock/LockServiceFactory.html" title="class in io.hekate.lock"><code>LockServiceFactory</code></a>. Each region
 can manage an unlimited amount of locks.
 </p>

 <p>
 Lock regions provide support for distributing workload among the cluster nodes. Only those nodes that have some particular
 region defined in their configuration will be managing locks for that region. Breaking locks into regions makes it possible to configure
 cluster nodes so that some subset of cluster nodes will be managing region 'A' while some other subset will be managing region 'B' (note
 that those subsets can intersect and some nodes from those subsets can manage both regions, i.e. there are no restrictions on how many
 regions are managed by the particular node).
 </p>

 <h2>Locking/Unlocking</h2>
 <p>
 In order obtain the lock, one must get the <a href="../../../io/hekate/lock/LockRegion.html" title="interface in io.hekate.lock"><code>LockRegion</code></a> instance from the <a href="../../../io/hekate/lock/LockService.html" title="interface in io.hekate.lock"><code>LockService</code></a> and then use that instance to create
 a named <a href="../../../io/hekate/lock/DistributedLock.html" title="interface in io.hekate.lock"><code>DistributedLock</code></a> as in the example below:
<div class="doc_source">
<pre><code class="java">
// Get lock with name 'example.lock'.
DistributedLock lock = hekate.locks().region("region1").get("example.lock");

// Acquire the lock.
lock.lock();

try {
    // Do some work ...
    thereCanBeOnlyOne();
} finally {
    // Make sure that lock is always released after the work is done.
    lock.unlock();
}
</code></pre>
</div>
 </p>

 <p>
 <a href="../../../io/hekate/lock/DistributedLock.html" title="interface in io.hekate.lock"><code>DistributedLock</code></a>s are <b>reentrant</b> and it is possible to call <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html?is-external=true#lock--" title="class or interface in java.util.concurrent.locks"><code>lock()</code></a> while the same
 lock (with the same region and name) is already held by the current thread. In such case <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html?is-external=true#lock--" title="class or interface in java.util.concurrent.locks"><code>lock()</code></a> method
 will return immediately without accessing remote nodes. However, please note that <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html?is-external=true#lock--" title="class or interface in java.util.concurrent.locks"><code>lock()</code></a> method calls
 must always be followed by the same amount of <a href="../../../io/hekate/lock/DistributedLock.html#unlock--"><code>unlock()</code></a> method calls or the lock will never be released.
 </p>

 <h2>Locking protocol details</h2>
 <p>
 <a href="../../../io/hekate/lock/LockService.html" title="interface in io.hekate.lock"><code>LockService</code></a> uses <a href="../../../io/hekate/partition/RendezvousHashMapper.html" title="class in io.hekate.partition"><code>RendezvousHashMapper</code></a> to evenly distribute locks processing workload among the nodes. For each
 lock/unlock operation it selects a node that is responsible for managing the lock with the given name and forwards those operations to
 such node. Manager node controls the lifecycle and order of locks and makes sure that locks are released if lock owner node prematurely
 leaves the cluster before properly releasing the lock.
 </p>

 <p>
 During the normal work each lock/unlock operation is performed within a single network round trip from the lock requester to the lock
 manager. In case of the cluster topology changes all lock/unlock operations are suspended until the cluster rebalancing is finished and
 live locks are migrated among the cluster members. The time it takes to perform rebalancing depends on the number of nodes within the
 lock region and the amount of acquired locks that require migration. Note that <a href="../../../io/hekate/lock/LockService.html" title="interface in io.hekate.lock"><code>LockService</code></a> doesn't keep track of released locks
 and removes them from memory, thus only those locks that are in the LOCKED state at the time of rebalancing are migrated.
 </p>

 <p>
 Locks rebalancing is controlled by the cluster coordinator which is dynamically selected among the cluster nodes. Coordinator uses a
 two-phase lock migration protocol. During the the first phase it collects information about all locks that require migration by sending
 a 'prepare' message over the nodes ring. This message circulates over the ring so that each node could inspect its local state and
 decide which of its owned locks require migration (i.e. which lock was re-mapped to another manager node). When message returns back to
 the coordinator it contains information about all locks in the region that require migration. During the second phase, coordinator sends
 an 'apply' message over the ring. This message contains information about migrating locks and is used by the cluster nodes to change
 their lock management state (i.e. take control over newly assigned locks and unload locks that were re-mapped to some other manager
 node).
 </p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../io/hekate/lock/LockRegion.html" title="interface in io.hekate.lock">LockRegion</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/hekate/lock/LockService.html#allRegions--">allRegions</a></span>()</code>
<div class="block">Returns all lock regions that are <a href="../../../io/hekate/lock/LockServiceFactory.html#setRegions-java.util.List-"><code>LockServiceFactory.setRegions(List)</code></a> registered within this service.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/hekate/lock/LockService.html#hasRegion-java.lang.String-">hasRegion</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;region)</code>
<div class="block">Returns <code>true</code> if this service has a lock region with the specified name.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="../../../io/hekate/lock/LockRegion.html" title="interface in io.hekate.lock">LockRegion</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/hekate/lock/LockService.html#region-java.lang.String-">region</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;region)</code>
<div class="block">Returns a lock region for the specified name.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="allRegions--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>allRegions</h4>
<pre><a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../io/hekate/lock/LockRegion.html" title="interface in io.hekate.lock">LockRegion</a>&gt;&nbsp;allRegions()</pre>
<div class="block">Returns all lock regions that are <a href="../../../io/hekate/lock/LockServiceFactory.html#setRegions-java.util.List-"><code>LockServiceFactory.setRegions(List)</code></a> registered within this service.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Lock regions or an empty collection if there are no registered regions.</dd>
</dl>
</li>
</ul>
<a name="region-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>region</h4>
<pre><a href="../../../io/hekate/lock/LockRegion.html" title="interface in io.hekate.lock">LockRegion</a>&nbsp;region(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;region)</pre>
<div class="block">Returns a lock region for the specified name.

 <p>
 Lock region with the specified name must be registered within the <a href="../../../io/hekate/lock/LockServiceFactory.html" title="class in io.hekate.lock"><code>LockServiceFactory</code></a> otherwise an error will be thrown.
 </p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>region</code> - Region name (see <a href="../../../io/hekate/lock/LockRegionConfig.html#setName-java.lang.String-"><code>LockRegionConfig.setName(String)</code></a>).</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Lock region.</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../io/hekate/lock/LockServiceFactory.html#withRegion-io.hekate.lock.LockRegionConfig-"><code>LockServiceFactory.withRegion(LockRegionConfig)</code></a></dd>
</dl>
</li>
</ul>
<a name="hasRegion-java.lang.String-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>hasRegion</h4>
<pre>boolean&nbsp;hasRegion(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;region)</pre>
<div class="block">Returns <code>true</code> if this service has a lock region with the specified name.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>region</code> - Region name (see <a href="../../../io/hekate/lock/LockRegionConfig.html#setName-java.lang.String-"><code>LockRegionConfig.setName(String)</code></a>).</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd><code>true</code> if region exists.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/LockService.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../io/hekate/lock/LockRegionConfig.html" title="class in io.hekate.lock"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../io/hekate/lock/LockServiceFactory.html" title="class in io.hekate.lock"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?io/hekate/lock/LockService.html" target="_top">Frames</a></li>
<li><a href="LockService.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2018 <a href="http://hekate.io/">The Hekate Project</a>. All rights reserved.</small></p>
</body>
</html>
