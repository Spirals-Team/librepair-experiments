function evalScript(script,entity){var $=MagmaScript.$.bind(entity);var newValue=MagmaScript.newValue;var _isNull=MagmaScript._isNull;return eval(script)}function MagmaScript(a){this.val=a}MagmaScript.prototype.value=function(){return this.val};MagmaScript.prototype.isValidJson=function(){try{JSON.parse(this.val);this.val=true}catch(a){this.val=false}return this};MagmaScript.prototype.plus=function(a){if(!MagmaScript._isNull(a)){if(typeof a==="object"||typeof a==="function"){this.val=this.val+a.value()}else{this.val=this.val+a}}return this};MagmaScript.prototype.pow=function(a){if((typeof denominator==="object")&&(typeof denominator.value==="function")){a=a.value()}this.val=Math.pow(this.val,a);return this};MagmaScript.prototype.times=function(a){if((typeof a==="object")&&(typeof a.value==="function")){a=a.value()}this.val=(this.val*a);return this};MagmaScript.prototype.div=function(a){if((typeof a==="object")&&(typeof a.value==="function")){a=a.value()}this.val=(this.val/a);return this};MagmaScript.prototype.age=function(){if(MagmaScript._isNull(this.val)){this.val=undefined}else{this.val=Math.floor((Date.now()-this.val)/(365.2425*24*60*60*1000))}return this};MagmaScript.prototype.map=function(c,a,d){function e(f){if(f===null){return null}if(f===undefined){return undefined}if(Array.isArray(f)){return f.map(e)}if(typeof f==="object"&&f._idValue!==undefined){return f._idValue}return f}if(typeof c==="function"){this.val=this.val.map(MagmaScript.newValue).map(c)}else{var b=e(this.val);if(b in c){this.val=c[b]}else{if(d!==undefined&&((this.val===undefined)||(this.val===null))){this.val=d}else{this.val=a}}}return this};MagmaScript.prototype.group=function(a,d,e){if(d&&d.length>0){for(var c=0;c<d.length;c++){if(this.val===d[c]){return this}}}if(a&&a.length>0){var b=this.val;if(b<a[0]){this.val="-"+a[0]}else{if(b>=a[a.length-1]){this.val=a[a.length-1]+"+"}}if(a.length>1){for(var c=1;c<a.length;c++){var g=a[c-1];var f=a[c];if(g>f){this.val=e?e:null;break}if(b>=g&&b<f){this.val=g+"-"+f;break}}}return this}this.val=e?e:null;return this};MagmaScript.prototype.eq=function(a){if(MagmaScript._isNull(this.val)&&MagmaScript._isNull(a)){this.val=false}else{if(MagmaScript._isNull(this.val)&&!MagmaScript._isNull(a)){this.val=false}else{this.val=(this.value()===a)}}return this};MagmaScript.prototype.matches=function(a){this.val=a.test(this.val);return this};MagmaScript.prototype.isNull=function(){this.val=MagmaScript._isNull(this.val);return this};MagmaScript.prototype.not=function(){this.val=!this.val;return this};MagmaScript.prototype.or=function(a){this.val=(this.val||a.value());return this};MagmaScript.prototype.and=function(a){this.val=(this.val&&a.value());return this};MagmaScript.prototype.gt=function(a){this.val=MagmaScript._isNull(this.val)?false:(this.value()>a);return this};MagmaScript.prototype.lt=function(a){this.val=MagmaScript._isNull(this.val)?false:(this.value()<a);return this};MagmaScript.prototype.ge=function(a){this.val=MagmaScript._isNull(this.val)?false:(this.value()>=a);return this};MagmaScript.prototype.le=function(a){this.val=MagmaScript._isNull(this.val)?false:(this.value()<=a);return this};MagmaScript.prototype.unit=function(a){if(!a){return this.unit}this.unit=a;return this};MagmaScript.prototype.toUnit=function(b){var a=math.unit(this.val,this.unit);this.val=a.toNumber(b);return this};MagmaScript.$=function(b){var c=b.split(".");var a=this;for(var d=0;d<c.length&&a!==null;d++){a=a[c[d]]}return new MagmaScript(a)};MagmaScript._isNull=function(a){if(a===null||a===undefined){return true}return(typeof a==="string")&&(a.length===0)};MagmaScript.newValue=function(a){return new MagmaScript(a)};