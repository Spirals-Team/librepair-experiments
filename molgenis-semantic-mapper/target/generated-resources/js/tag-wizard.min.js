(function(c,g){var e,h,i=[],f;function a(j){g.createAlert([{message:"You need at least one ontology selected before being able to tag."}],j)}function b(l,k){var j="";j+="<button ";j+='type="btn" ';j+='class="btn btn-primary btn-xs remove-tag-btn" ';j+='data-relation="'+k.relationIRI+'" ';j+='data-attribute="'+l+'" ';j+='data-tag="'+k.IRI+'">';j+=k.label+" ";j+='<span class="glyphicon glyphicon-remove"></span>';j+="</button> ";return j}function d(){c("#tag-dropdown").select2({width:"100%",minimumInputLength:1,multiple:true,closeOnSelect:true,query:function(j){c.ajax({url:"tagwizard/getontologyterms",type:"POST",contentType:"application/json",data:JSON.stringify({searchTerm:j.term,ontologyIds:i}),success:function(k){j.callback({results:k,more:false})}})},formatSelection:function(j){return j.label},formatResult:function(j){return j.label},id:function(j){return j.IRI}})}c(function(){f=c("#global-information").data("entity");c("#select-target").on("change",function(){c("#change-entity-form").submit()}).select2();c("#tag-mapping-table").scrollTableBody();c("#ontology-select").select2();if(c("#ontology-select").val()){i=c("#ontology-select").val()}c("#ontology-select").on("change",function(){if(c(this).val()===null){i=[]}else{i=c(this).val()}});c("#automatic-tag-btn").on("click",function(){if(i.length>0){c.ajax({url:"tagwizard/autotagattributes",type:"POST",contentType:"application/json",data:JSON.stringify({entityTypeId:f,ontologyIds:i}),success:function(j){g.createAlert([{message:"Automatic tagging has been succesfully completed"}],"success");c.each(j,function(l,k){if(k.ontologyTerm){c("#"+l+"-tag-column").append(b(l,k.ontologyTerm))}})}})}else{a("warning")}});c("#clear-all-tags-btn").on("click",function(){bootbox.confirm("Are you sure you want to remove all tags?",function(j){if(j===true){c.ajax({url:"tagwizard/clearalltags",type:"POST",data:{entityTypeId:f},success:function(){c("td.tag-column").empty();g.createAlert([{message:"All tags have been succesfully removed"}],"success")}})}})});c(".edit-attribute-tags-btn").on("click",function(j){if(i.length>0){e=c(this).data("attribute");h=c(this).data("relation")}else{a("warning");j.stopPropagation();j.preventDefault()}});d();c("#save-tag-selection-btn").on("click",function(){var j=e,k=c("#tag-dropdown").select2("val");c.ajax({url:"tagwizard/tagattribute",type:"POST",contentType:"application/json",data:JSON.stringify({entityTypeId:f,attributeName:j,relationIRI:h,ontologyTermIRIs:k}),success:function(l){c("#tag-dropdown").select2("val","");if(l!==undefined){c("#"+j+"-tag-column").append(b(j,l.ontologyTerm))}}})});c(".tag-column").on("click",".remove-tag-btn",function(){var j=c(this).data("attribute"),k=c(this).data("tag");h=c(this).data("relation");c.ajax({url:"tagwizard/deletesingletag",type:"POST",contentType:"application/json",data:JSON.stringify({entityTypeId:f,attributeName:j,relationIRI:h,ontologyTermIRI:k})});c(this).remove()})})}($,window.top.molgenis=window.top.molgenis||{}));