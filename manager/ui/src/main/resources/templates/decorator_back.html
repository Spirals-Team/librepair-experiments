<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="common/back_header"/>
<body class="main">
<div class="container-fluid full-size bg-faded">
  <div class="row h-100">
    <div class="col-sm-3 col-xl-2 back-menu">
      <div th:include="common/back_menu"/>
    </div>
    <div class="col-sm-9 col-xl-10" id="page-wrapper">
      <div th:include="common/back_navigation"/>
      <div th:include="common/back_breadcrumb"/>
      <div th:replace="${content}"/>
      <div th:include="common/back_modals"/>
    </div>
  </div>
</div>
</body>
<script type="text/javascript">
  var stompClient = null;
  $(document).ready(function () {
    toggleActiveMenu();
    connect();
  });

  function toggleActiveMenu() {
    $("#menu .nav-item .nav-link").each(function () {
      var that = $(this);
      if (that.hasClass("collapsed") && that.parent().hasClass("active")) {
        that.next(".collapse").collapse("show");
      }
    });
  }

  function connect() {
    var socket = new SockJS('/manager-websocket');
    stompClient = Stomp.over(socket);
    stompClient.debug = null;
    stompClient.connect({}, function (frame) {
      stompClient.subscribe('/notifications', function (data) {
        showNotification('top', 'right', JSON.parse(data.body));
      });
    });
  }

  function showNotification(from, align, notification) {

    $.notify({
      icon: "notifications",
      message: notification.content

    }, {
      type: notification.type,
      timer: 1000,
      placement: {
        from: from,
        align: align
      }
    });
  }


</script>
</html>