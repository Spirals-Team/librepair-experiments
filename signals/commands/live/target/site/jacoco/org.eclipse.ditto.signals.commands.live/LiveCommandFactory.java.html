<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LiveCommandFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Eclipse Ditto :: Signals :: Commands :: Live</a> &gt; <a href="index.source.html" class="el_package">org.eclipse.ditto.signals.commands.live</a> &gt; <span class="el_source">LiveCommandFactory.java</span></div><h1>LiveCommandFactory.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2017 Bosch Software Innovations GmbH.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v2.0
 * which accompanies this distribution, and is available at
 * https://www.eclipse.org/org/documents/epl-2.0/index.php
 *
 * Contributors:
 *    Bosch Software Innovations GmbH - initial contribution
 */
package org.eclipse.ditto.signals.commands.live;

import static org.eclipse.ditto.model.base.common.ConditionChecker.checkNotNull;

import java.text.MessageFormat;
import java.util.Collections;
import java.util.HashMap;
import java.util.Map;
import java.util.function.Function;

import javax.annotation.Nonnull;
import javax.annotation.concurrent.Immutable;

import org.eclipse.ditto.signals.commands.base.Command;
import org.eclipse.ditto.signals.commands.live.base.LiveCommand;
import org.eclipse.ditto.signals.commands.live.modify.ModifyLiveCommandFactory;
import org.eclipse.ditto.signals.commands.things.modify.CreateThing;
import org.eclipse.ditto.signals.commands.things.modify.DeleteAttribute;
import org.eclipse.ditto.signals.commands.things.modify.DeleteAttributes;
import org.eclipse.ditto.signals.commands.things.modify.DeleteFeature;
import org.eclipse.ditto.signals.commands.things.modify.DeleteFeatureDefinition;
import org.eclipse.ditto.signals.commands.things.modify.DeleteFeatureProperties;
import org.eclipse.ditto.signals.commands.things.modify.DeleteFeatureProperty;
import org.eclipse.ditto.signals.commands.things.modify.DeleteFeatures;
import org.eclipse.ditto.signals.commands.things.modify.DeleteThing;
import org.eclipse.ditto.signals.commands.things.modify.ModifyAttribute;
import org.eclipse.ditto.signals.commands.things.modify.ModifyAttributes;
import org.eclipse.ditto.signals.commands.things.modify.ModifyFeature;
import org.eclipse.ditto.signals.commands.things.modify.ModifyFeatureDefinition;
import org.eclipse.ditto.signals.commands.things.modify.ModifyFeatureProperties;
import org.eclipse.ditto.signals.commands.things.modify.ModifyFeatureProperty;
import org.eclipse.ditto.signals.commands.things.modify.ModifyFeatures;
import org.eclipse.ditto.signals.commands.things.modify.ModifyThing;
import org.eclipse.ditto.signals.commands.things.query.RetrieveAttribute;
import org.eclipse.ditto.signals.commands.things.query.RetrieveAttributes;
import org.eclipse.ditto.signals.commands.things.query.RetrieveFeature;
import org.eclipse.ditto.signals.commands.things.query.RetrieveFeatureDefinition;
import org.eclipse.ditto.signals.commands.things.query.RetrieveFeatureProperties;
import org.eclipse.ditto.signals.commands.things.query.RetrieveFeatureProperty;
import org.eclipse.ditto.signals.commands.things.query.RetrieveFeatures;
import org.eclipse.ditto.signals.commands.things.query.RetrieveThing;
import org.eclipse.ditto.signals.commands.things.query.RetrieveThings;

import org.eclipse.ditto.signals.commands.live.query.QueryLiveCommandFactory;

/**
 * A factory for creating immutable instances of {@link LiveCommand} based on existing &lt;em&gt;Twin Commands&lt;/em&gt;.
 */
@Immutable
public final class LiveCommandFactory {

    private static final int STRATEGIES_NUMBER = 26;
<span class="fc" id="L64">    private static final LiveCommandFactory INSTANCE = new LiveCommandFactory();</span>

    private final Map&lt;String, Function&lt;Command, LiveCommand&gt;&gt; mappingStrategies;

<span class="fc" id="L68">    private LiveCommandFactory() {</span>
<span class="fc" id="L69">        mappingStrategies = Collections.unmodifiableMap(initMappingStrategies());</span>
<span class="fc" id="L70">    }</span>

    private static Map&lt;String, Function&lt;Command, LiveCommand&gt;&gt; initMappingStrategies() {
<span class="fc" id="L73">        final Map&lt;String, Function&lt;Command, LiveCommand&gt;&gt; result = new HashMap&lt;&gt;(STRATEGIES_NUMBER);</span>
<span class="fc" id="L74">        result.put(CreateThing.TYPE, ModifyLiveCommandFactory::createThing);</span>
<span class="fc" id="L75">        result.put(DeleteAttribute.TYPE, ModifyLiveCommandFactory::deleteAttribute);</span>
<span class="fc" id="L76">        result.put(DeleteAttributes.TYPE, ModifyLiveCommandFactory::deleteAttributes);</span>
<span class="fc" id="L77">        result.put(DeleteFeature.TYPE, ModifyLiveCommandFactory::deleteFeature);</span>
<span class="fc" id="L78">        result.put(DeleteFeatureDefinition.TYPE, ModifyLiveCommandFactory::deleteFeatureDefinition);</span>
<span class="fc" id="L79">        result.put(DeleteFeatureProperties.TYPE, ModifyLiveCommandFactory::deleteFeatureProperties);</span>
<span class="fc" id="L80">        result.put(DeleteFeatureProperty.TYPE, ModifyLiveCommandFactory::deleteFeatureProperty);</span>
<span class="fc" id="L81">        result.put(DeleteFeatures.TYPE, ModifyLiveCommandFactory::deleteFeatures);</span>
<span class="fc" id="L82">        result.put(DeleteThing.TYPE, ModifyLiveCommandFactory::deleteThing);</span>
<span class="fc" id="L83">        result.put(ModifyAttribute.TYPE, ModifyLiveCommandFactory::modifyAttribute);</span>
<span class="fc" id="L84">        result.put(ModifyAttributes.TYPE, ModifyLiveCommandFactory::modifyAttributes);</span>
<span class="fc" id="L85">        result.put(ModifyFeature.TYPE, ModifyLiveCommandFactory::modifyFeature);</span>
<span class="fc" id="L86">        result.put(ModifyFeatureDefinition.TYPE, ModifyLiveCommandFactory::modifyFeatureDefinition);</span>
<span class="fc" id="L87">        result.put(ModifyFeatureProperties.TYPE, ModifyLiveCommandFactory::modifyFeatureProperties);</span>
<span class="fc" id="L88">        result.put(ModifyFeatureProperty.TYPE, ModifyLiveCommandFactory::modifyFeatureProperty);</span>
<span class="fc" id="L89">        result.put(ModifyFeatures.TYPE, ModifyLiveCommandFactory::modifyFeatures);</span>
<span class="fc" id="L90">        result.put(ModifyThing.TYPE, ModifyLiveCommandFactory::modifyThing);</span>

<span class="fc" id="L92">        result.put(RetrieveAttribute.TYPE, QueryLiveCommandFactory::retrieveAttribute);</span>
<span class="fc" id="L93">        result.put(RetrieveAttributes.TYPE, QueryLiveCommandFactory::retrieveAttributes);</span>
<span class="fc" id="L94">        result.put(RetrieveFeature.TYPE, QueryLiveCommandFactory::retrieveFeature);</span>
<span class="fc" id="L95">        result.put(RetrieveFeatureDefinition.TYPE, QueryLiveCommandFactory::retrieveFeatureDefinition);</span>
<span class="fc" id="L96">        result.put(RetrieveFeatureProperties.TYPE, QueryLiveCommandFactory::retrieveFeatureProperties);</span>
<span class="fc" id="L97">        result.put(RetrieveFeatureProperty.TYPE, QueryLiveCommandFactory::retrieveFeatureProperty);</span>
<span class="fc" id="L98">        result.put(RetrieveFeatures.TYPE, QueryLiveCommandFactory::retrieveFeatures);</span>
<span class="fc" id="L99">        result.put(RetrieveThing.TYPE, QueryLiveCommandFactory::retrieveThing);</span>
<span class="fc" id="L100">        result.put(RetrieveThings.TYPE, QueryLiveCommandFactory::retrieveThings);</span>
<span class="fc" id="L101">        return result;</span>
    }

    /**
     * Returns an instance of {@code LiveCommandFactory}.
     *
     * @return the instance.
     */
    @Nonnull
    public static LiveCommandFactory getInstance() {
<span class="fc" id="L111">        return INSTANCE;</span>
    }

    /**
     * Returns an immutable {@link LiveCommand} which is associated with the specified Command.
     *
     * @param command the command to get a LiveCommand for.
     * @return the LiveCommand.
     * @throws NullPointerException if {@code command} is {@code null}.
     * @throws IllegalArgumentException if the given command cannot be mapped to a LiveCommand because there is no
     * mapping strategy associated with the command's type.
     */
    @Nonnull
    public LiveCommand getLiveCommand(@Nonnull final Command&lt;?&gt; command) {
<span class="fc" id="L125">        checkNotNull(command, &quot;command&quot;);</span>

<span class="fc" id="L127">        final String commandType = command.getType();</span>
<span class="fc" id="L128">        final Function&lt;Command, LiveCommand&gt; commandToLiveCommand = mappingStrategies.get(commandType);</span>
<span class="fc bfc" id="L129" title="All 2 branches covered.">        if (null == commandToLiveCommand) {</span>
<span class="fc" id="L130">            final String msgTemplate = &quot;No mapping strategy for command &lt;{0}&gt; available!&quot;</span>
                    + &quot; The command type &lt;{1}&gt; is unknown!&quot;;
<span class="fc" id="L132">            throw new IllegalArgumentException(MessageFormat.format(msgTemplate, command, commandType));</span>
        }
<span class="fc" id="L134">        return commandToLiveCommand.apply(command);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>