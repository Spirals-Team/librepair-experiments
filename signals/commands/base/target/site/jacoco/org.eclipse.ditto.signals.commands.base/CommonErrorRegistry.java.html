<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CommonErrorRegistry.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Eclipse Ditto :: Signals :: Commands :: Base</a> &gt; <a href="index.source.html" class="el_package">org.eclipse.ditto.signals.commands.base</a> &gt; <span class="el_source">CommonErrorRegistry.java</span></div><h1>CommonErrorRegistry.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2017 Bosch Software Innovations GmbH.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v2.0
 * which accompanies this distribution, and is available at
 * https://www.eclipse.org/org/documents/epl-2.0/index.php
 *
 * Contributors:
 *    Bosch Software Innovations GmbH - initial contribution
 */
package org.eclipse.ditto.signals.commands.base;

import java.util.HashMap;
import java.util.Map;

import javax.annotation.concurrent.Immutable;

import org.eclipse.ditto.json.JsonFieldSelectorInvalidException;
import org.eclipse.ditto.json.JsonMissingFieldException;
import org.eclipse.ditto.json.JsonObject;
import org.eclipse.ditto.json.JsonParseException;
import org.eclipse.ditto.json.JsonPointerInvalidException;
import org.eclipse.ditto.model.base.exceptions.DittoJsonException;
import org.eclipse.ditto.model.base.exceptions.DittoRuntimeException;
import org.eclipse.ditto.signals.base.AbstractErrorRegistry;
import org.eclipse.ditto.signals.base.ErrorRegistry;
import org.eclipse.ditto.signals.base.JsonParsable;
import org.eclipse.ditto.signals.base.JsonTypeNotParsableException;
import org.eclipse.ditto.signals.commands.base.exceptions.GatewayAuthenticationFailedException;
import org.eclipse.ditto.signals.commands.base.exceptions.GatewayAuthenticationProviderUnavailableException;
import org.eclipse.ditto.signals.commands.base.exceptions.GatewayBadGatewayException;
import org.eclipse.ditto.signals.commands.base.exceptions.GatewayInternalErrorException;
import org.eclipse.ditto.signals.commands.base.exceptions.GatewayMethodNotAllowedException;
import org.eclipse.ditto.signals.commands.base.exceptions.GatewayQueryTimeExceededException;
import org.eclipse.ditto.signals.commands.base.exceptions.GatewayServiceTimeoutException;
import org.eclipse.ditto.signals.commands.base.exceptions.GatewayServiceTooManyRequestsException;
import org.eclipse.ditto.signals.commands.base.exceptions.GatewayServiceUnavailableException;

/**
 * A {@link ErrorRegistry} aware of common {@link DittoRuntimeException}s.
 */
@Immutable
public final class CommonErrorRegistry extends AbstractErrorRegistry&lt;DittoRuntimeException&gt; {

    private CommonErrorRegistry(final Map&lt;String, JsonParsable&lt;DittoRuntimeException&gt;&gt; parseStrategies) {
<span class="fc" id="L47">        super(parseStrategies);</span>
<span class="fc" id="L48">    }</span>

    /**
     * Returns a new {@code CommonErrorRegistry}.
     *
     * @return the error registry.
     */
    public static CommonErrorRegistry newInstance() {
<span class="fc" id="L56">        final Map&lt;String, JsonParsable&lt;DittoRuntimeException&gt;&gt; parseStrategies = new HashMap&lt;&gt;();</span>

<span class="pc" id="L58">        parseStrategies.put(JsonParseException.ERROR_CODE, (jsonObject, dittoHeaders) -&gt; new DittoJsonException(</span>
<span class="nc" id="L59">                JsonParseException.newBuilder().message(getMessage(jsonObject)).build(), dittoHeaders));</span>

<span class="fc" id="L61">        parseStrategies.put(JsonMissingFieldException.ERROR_CODE, (jsonObject, dittoHeaders) -&gt; new DittoJsonException(</span>
<span class="fc" id="L62">                JsonMissingFieldException.newBuilder().message(getMessage(jsonObject)).build(), dittoHeaders));</span>

<span class="fc" id="L64">        parseStrategies.put(JsonFieldSelectorInvalidException.ERROR_CODE,</span>
<span class="nc" id="L65">                (jsonObject, dittoHeaders) -&gt; new DittoJsonException(</span>
<span class="nc" id="L66">                        JsonFieldSelectorInvalidException.newBuilder().message(getMessage(jsonObject)).build(),</span>
                        dittoHeaders));

<span class="fc" id="L69">        parseStrategies.put(JsonPointerInvalidException.ERROR_CODE,</span>
<span class="nc" id="L70">                (jsonObject, dittoHeaders) -&gt; new DittoJsonException(</span>
<span class="nc" id="L71">                        JsonPointerInvalidException.newBuilder().message(getMessage(jsonObject)).build(),</span>
                        dittoHeaders));

        // Fallback DittoJsonException which originated from a RuntimeException.
<span class="fc" id="L75">        parseStrategies.put(DittoJsonException.FALLBACK_ERROR_CODE,</span>
<span class="nc" id="L76">                (jsonObject, dittoHeaders) -&gt; new DittoJsonException(new RuntimeException(getMessage(jsonObject)),</span>
                        dittoHeaders));

        // other common exceptions
<span class="fc" id="L80">        parseStrategies.put(CommandNotSupportedException.ERROR_CODE, CommandNotSupportedException::fromJson);</span>
<span class="fc" id="L81">        parseStrategies.put(JsonTypeNotParsableException.ERROR_CODE, JsonTypeNotParsableException::fromJson);</span>

        // Gateway exceptions
<span class="fc" id="L84">        parseStrategies.put(GatewayAuthenticationFailedException.ERROR_CODE,</span>
<span class="nc" id="L85">                (jsonObject, dittoHeaders) -&gt; GatewayAuthenticationFailedException.newBuilder(getMessage(jsonObject))</span>
<span class="nc" id="L86">                        .dittoHeaders(dittoHeaders).build());</span>

<span class="fc" id="L88">        parseStrategies.put(GatewayAuthenticationProviderUnavailableException.ERROR_CODE,</span>
<span class="nc" id="L89">                (jsonObject, dittoHeaders) -&gt; GatewayAuthenticationProviderUnavailableException.newBuilder()</span>
<span class="nc" id="L90">                        .message(getMessage(jsonObject)).dittoHeaders(dittoHeaders).build());</span>

<span class="fc" id="L92">        parseStrategies.put(GatewayBadGatewayException.ERROR_CODE,</span>
<span class="nc" id="L93">                (jsonObject, dittoHeaders) -&gt; GatewayBadGatewayException.newBuilder().message(getMessage(jsonObject))</span>
<span class="nc" id="L94">                        .dittoHeaders(dittoHeaders).build());</span>

<span class="fc" id="L96">        parseStrategies.put(GatewayInternalErrorException.ERROR_CODE,</span>
<span class="fc" id="L97">                (jsonObject, dittoHeaders) -&gt; GatewayInternalErrorException.newBuilder()</span>
<span class="fc" id="L98">                        .message(getMessage(jsonObject))</span>
<span class="fc" id="L99">                        .dittoHeaders(dittoHeaders)</span>
<span class="fc" id="L100">                        .build());</span>

<span class="fc" id="L102">        parseStrategies.put(GatewayMethodNotAllowedException.ERROR_CODE,</span>
<span class="fc" id="L103">                (jsonObject, dittoHeaders) -&gt; GatewayMethodNotAllowedException.newBuilder(&quot;&quot;)</span>
<span class="fc" id="L104">                        .message(getMessage(jsonObject))</span>
<span class="fc" id="L105">                        .dittoHeaders(dittoHeaders)</span>
<span class="fc" id="L106">                        .build());</span>

<span class="fc" id="L108">        parseStrategies.put(GatewayQueryTimeExceededException.ERROR_CODE,</span>
<span class="nc" id="L109">                (jsonObject, dittoHeaders) -&gt; GatewayQueryTimeExceededException.newBuilder()</span>
<span class="nc" id="L110">                        .message(getMessage(jsonObject))</span>
<span class="nc" id="L111">                        .dittoHeaders(dittoHeaders)</span>
<span class="nc" id="L112">                        .build());</span>

<span class="fc" id="L114">        parseStrategies.put(GatewayServiceTimeoutException.ERROR_CODE,</span>
<span class="fc" id="L115">                (jsonObject, dittoHeaders) -&gt; GatewayServiceTimeoutException.newBuilder()</span>
<span class="fc" id="L116">                        .message(getMessage(jsonObject))</span>
<span class="fc" id="L117">                        .dittoHeaders(dittoHeaders)</span>
<span class="fc" id="L118">                        .build());</span>

<span class="fc" id="L120">        parseStrategies.put(GatewayServiceUnavailableException.ERROR_CODE,</span>
<span class="nc" id="L121">                (jsonObject, dittoHeaders) -&gt; GatewayServiceUnavailableException.newBuilder()</span>
<span class="nc" id="L122">                        .message(getMessage(jsonObject))</span>
<span class="nc" id="L123">                        .dittoHeaders(dittoHeaders)</span>
<span class="nc" id="L124">                        .build());</span>

<span class="fc" id="L126">        parseStrategies.put(GatewayServiceTooManyRequestsException.ERROR_CODE,</span>
<span class="nc" id="L127">                (jsonObject, dittoHeaders) -&gt; GatewayServiceTooManyRequestsException.newBuilder()</span>
<span class="nc" id="L128">                        .message(getMessage(jsonObject))</span>
<span class="nc" id="L129">                        .dittoHeaders(dittoHeaders)</span>
<span class="nc" id="L130">                        .build());</span>


<span class="fc" id="L133">        return new CommonErrorRegistry(parseStrategies);</span>
    }


    private static String getMessage(final JsonObject jsonObject) {
<span class="fc" id="L138">        return jsonObject.getValue(DittoJsonException.JsonFields.MESSAGE)</span>
<span class="pc" id="L139">                .orElseThrow(() -&gt; JsonMissingFieldException.newBuilder()</span>
<span class="nc" id="L140">                        .fieldName(DittoRuntimeException.JsonFields.MESSAGE.getPointer().toString()).build());</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>