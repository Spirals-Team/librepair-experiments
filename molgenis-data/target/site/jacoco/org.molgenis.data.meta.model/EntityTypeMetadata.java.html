<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EntityTypeMetadata.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">data</a> &gt; <a href="index.source.html" class="el_package">org.molgenis.data.meta.model</a> &gt; <span class="el_source">EntityTypeMetadata.java</span></div><h1>EntityTypeMetadata.java</h1><pre class="source lang-java linenums">package org.molgenis.data.meta.model;

import org.molgenis.data.Sort;
import org.molgenis.data.meta.SystemEntityType;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.Set;

import static java.lang.Boolean.FALSE;
import static java.util.Collections.singleton;
import static java.util.Objects.requireNonNull;
import static org.molgenis.data.meta.AttributeType.*;
import static org.molgenis.data.meta.model.AttributeMetadata.SEQUENCE_NR;
import static org.molgenis.data.meta.model.EntityType.AttributeRole.*;
import static org.molgenis.data.meta.model.MetaPackage.PACKAGE_META;
import static org.molgenis.data.meta.model.Package.PACKAGE_SEPARATOR;

@Component
public class EntityTypeMetadata extends SystemEntityType
{
	private static final String SIMPLE_NAME = &quot;EntityType&quot;;
	public static final String ENTITY_TYPE_META_DATA = PACKAGE_META + PACKAGE_SEPARATOR + SIMPLE_NAME;

	private AttributeMetadata attributeMetadata;
	private PackageMetadata packageMetadata;
	private TagMetadata tagMetadata;

	public static final String ID = &quot;id&quot;;
	public static final String PACKAGE = &quot;package&quot;;
	public static final String LABEL = &quot;label&quot;;
	public static final String DESCRIPTION = &quot;description&quot;;
	public static final String ATTRIBUTES = &quot;attributes&quot;;
	public static final String IS_ABSTRACT = &quot;isAbstract&quot;;
	public static final String EXTENDS = &quot;extends&quot;;
	public static final String TAGS = &quot;tags&quot;;
	public static final String BACKEND = &quot;backend&quot;;
	public static final String INDEXING_DEPTH = &quot;indexingDepth&quot;;

	private List&lt;String&gt; backendEnumOptions;
	private String defaultBackend;

	EntityTypeMetadata()
	{
<span class="fc" id="L46">		super(SIMPLE_NAME, PACKAGE_META);</span>
<span class="fc" id="L47">	}</span>

	public void init()
	{
<span class="fc" id="L51">		requireNonNull(backendEnumOptions, &quot;backend enum options not set!&quot;);</span>

<span class="fc" id="L53">		setId(ENTITY_TYPE_META_DATA);</span>
<span class="fc" id="L54">		setLabel(&quot;Entity type&quot;);</span>
<span class="fc" id="L55">		setDescription(&quot;Meta data for entity classes&quot;);</span>

<span class="fc" id="L57">		addAttribute(ID, ROLE_ID).setAuto(true).setLabel(&quot;Identifier&quot;);</span>
<span class="fc" id="L58">		addAttribute(LABEL, ROLE_LABEL, ROLE_LOOKUP).setNillable(false).setLabel(&quot;Label&quot;);</span>
<span class="fc" id="L59">		addAttribute(DESCRIPTION).setDataType(TEXT).setLabel(&quot;Description&quot;);</span>
<span class="fc" id="L60">		addAttribute(PACKAGE).setDataType(XREF).setRefEntity(packageMetadata).setLabel(&quot;Package&quot;);</span>
<span class="fc" id="L61">		Attribute refAttr = attributeMetadata.getAttribute(AttributeMetadata.ENTITY);</span>
<span class="fc" id="L62">		addAttribute(ATTRIBUTES).setDataType(ONE_TO_MANY)</span>
<span class="fc" id="L63">								.setRefEntity(attributeMetadata)</span>
<span class="fc" id="L64">								.setMappedBy(refAttr)</span>
<span class="fc" id="L65">								.setOrderBy(new Sort(SEQUENCE_NR))</span>
<span class="fc" id="L66">								.setNillable(true)</span>
<span class="fc" id="L67">								.setLabel(&quot;Attributes&quot;);</span>
<span class="fc" id="L68">		addAttribute(IS_ABSTRACT).setDataType(BOOL)</span>
<span class="fc" id="L69">								 .setNillable(false)</span>
<span class="fc" id="L70">								 .setReadOnly(true)</span>
<span class="fc" id="L71">								 .setLabel(&quot;Abstract&quot;)</span>
<span class="fc" id="L72">								 .setReadOnly(true)</span>
<span class="fc" id="L73">								 .setDefaultValue(FALSE.toString());</span>
		// TODO replace with autowired self-reference after update to Spring 4.3
<span class="fc" id="L75">		addAttribute(EXTENDS).setDataType(XREF).setRefEntity(this).setReadOnly(true).setLabel(&quot;Extends&quot;);</span>
<span class="fc" id="L76">		addAttribute(TAGS).setDataType(MREF).setRefEntity(tagMetadata).setLabel(&quot;Tags&quot;);</span>
<span class="fc" id="L77">		addAttribute(BACKEND).setDataType(ENUM)</span>
<span class="fc" id="L78">							 .setEnumOptions(backendEnumOptions)</span>
<span class="fc" id="L79">							 .setNillable(false)</span>
<span class="fc" id="L80">							 .setReadOnly(true)</span>
<span class="fc" id="L81">							 .setDefaultValue(defaultBackend)</span>
<span class="fc" id="L82">							 .setLabel(&quot;Backend&quot;)</span>
<span class="fc" id="L83">							 .setDescription(&quot;Backend data store&quot;);</span>
<span class="fc" id="L84">		addAttribute(INDEXING_DEPTH).setDataType(INT)</span>
<span class="fc" id="L85">									.setLabel(&quot;Indexing depth&quot;)</span>
<span class="fc" id="L86">									.setDescription(</span>
											&quot;1 = index attributes and referenced entities (default) 2 = index attributes, referenced entities and entities referenced by referenced entities&quot;)
<span class="fc" id="L88">									.setNillable(false)</span>
<span class="fc" id="L89">									.setDefaultValue(String.valueOf(1))</span>
<span class="fc" id="L90">									.setRangeMin(1L);</span>
<span class="fc" id="L91">	}</span>

	/**
	 * Used during bootstrapping to set the enum options for the backend field. Circumvents unresolvable circular
	 * dependencies when autowiring RepositoryCollectionRegistry into this bean.
	 *
	 * @param repositoryCollectionNames list of RepositoryCollection names
	 */
	public void setBackendEnumOptions(List&lt;String&gt; repositoryCollectionNames)
	{
<span class="fc" id="L101">		this.backendEnumOptions = requireNonNull(repositoryCollectionNames);</span>
<span class="fc" id="L102">	}</span>

	/**
	 * Used during bootstrapping to set the default value of the backend field.
	 *
	 * @param repositoryCollectionName list of RepositoryCollection names
	 */
	public void setDefaultBackend(String repositoryCollectionName)
	{
<span class="nc" id="L111">		this.defaultBackend = requireNonNull(repositoryCollectionName);</span>
<span class="nc" id="L112">	}</span>

	// setter injection instead of constructor injection to avoid unresolvable circular dependencies
	@Autowired
	public void setAttributeMetadata(AttributeMetadata attributeMetadata)
	{
<span class="fc" id="L118">		this.attributeMetadata = requireNonNull(attributeMetadata);</span>
<span class="fc" id="L119">	}</span>

	@Autowired
	public void setPackageMetadata(PackageMetadata packageMetadata)
	{
<span class="fc" id="L124">		this.packageMetadata = requireNonNull(packageMetadata);</span>
<span class="fc" id="L125">	}</span>

	@Autowired
	public void setTagMetadata(TagMetadata tagMetadata)
	{
<span class="fc" id="L130">		this.tagMetadata = requireNonNull(tagMetadata);</span>
<span class="fc" id="L131">	}</span>

	@Override
	public Set&lt;SystemEntityType&gt; getDependencies()
	{
<span class="fc" id="L136">		return singleton(attributeMetadata);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>