<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AttributeMetadata.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">data</a> &gt; <a href="index.source.html" class="el_package">org.molgenis.data.meta.model</a> &gt; <span class="el_source">AttributeMetadata.java</span></div><h1>AttributeMetadata.java</h1><pre class="source lang-java linenums">package org.molgenis.data.meta.model;

import org.molgenis.data.Sort;
import org.molgenis.data.meta.AttributeType;
import org.molgenis.data.meta.SystemEntityType;
import org.molgenis.data.support.EntityTypeUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

import static java.util.Objects.requireNonNull;
import static org.molgenis.data.meta.AttributeType.*;
import static org.molgenis.data.meta.model.EntityType.AttributeRole.*;
import static org.molgenis.data.meta.model.MetaPackage.PACKAGE_META;
import static org.molgenis.data.meta.model.Package.PACKAGE_SEPARATOR;
import static org.molgenis.data.support.AttributeUtils.getValidIdAttributeTypes;

@Component
public class AttributeMetadata extends SystemEntityType
{
	private static final String SIMPLE_NAME = &quot;Attribute&quot;;
	public static final String ATTRIBUTE_META_DATA = PACKAGE_META + PACKAGE_SEPARATOR + SIMPLE_NAME;

	public static final String ID = &quot;id&quot;;
	public static final String NAME = &quot;name&quot;;
	public static final String ENTITY = &quot;entity&quot;;
	public static final String SEQUENCE_NR = &quot;sequenceNr&quot;;
	public static final String TYPE = &quot;type&quot;;
	public static final String IS_ID_ATTRIBUTE = &quot;isIdAttribute&quot;;
	public static final String IS_LABEL_ATTRIBUTE = &quot;isLabelAttribute&quot;;
	public static final String LOOKUP_ATTRIBUTE_INDEX = &quot;lookupAttributeIndex&quot;;
	public static final String REF_ENTITY_TYPE = &quot;refEntityType&quot;;
	/**
	 * Deleting an entity also deletes the referenced entity when cascading delete is enabled
	 */
	public static final String IS_CASCADE_DELETE = &quot;isCascadeDelete&quot;;

	/**
	 * For attributes with data type ONE_TO_MANY defines the attribute in the referenced entity that owns the relationship.
	 */
	public static final String MAPPED_BY = &quot;mappedBy&quot;;

	/**
	 * For attributes with data type ONE_TO_MANY defines how to sort the entity collection.
	 * Syntax: attribute_name,[ASC | DESC] [;attribute_name,[ASC | DESC]]*
	 * - If ASC or DESC is not specified, ASC (ascending order) is assumed.
	 * - If the ordering element is not specified, ordering by the id attribute of the associated entity is assumed.
	 */
	public static final String ORDER_BY = &quot;orderBy&quot;;

	public static final String LABEL = &quot;label&quot;;
	public static final String DESCRIPTION = &quot;description&quot;;
	public static final String IS_NULLABLE = &quot;isNullable&quot;;
	public static final String IS_AUTO = &quot;isAuto&quot;;
	public static final String IS_VISIBLE = &quot;isVisible&quot;;
	public static final String IS_UNIQUE = &quot;isUnique&quot;;
	public static final String IS_READ_ONLY = &quot;isReadOnly&quot;;
	public static final String IS_AGGREGATABLE = &quot;isAggregatable&quot;;
	public static final String EXPRESSION = &quot;expression&quot;;
	public static final String ENUM_OPTIONS = &quot;enumOptions&quot;;
	public static final String RANGE_MIN = &quot;rangeMin&quot;;
	public static final String RANGE_MAX = &quot;rangeMax&quot;;
	public static final String PARENT = &quot;parent&quot;;
	public static final String CHILDREN = &quot;children&quot;;
	public static final String TAGS = &quot;tags&quot;;
	public static final String NULLABLE_EXPRESSION = &quot;nullableExpression&quot;;
	public static final String VISIBLE_EXPRESSION = &quot;visibleExpression&quot;;
	public static final String VALIDATION_EXPRESSION = &quot;validationExpression&quot;;
	public static final String DEFAULT_VALUE = &quot;defaultValue&quot;;

	private TagMetadata tagMetadata;
	private EntityTypeMetadata entityTypeMeta;

	public AttributeMetadata()
	{
<span class="fc" id="L79">		super(SIMPLE_NAME, PACKAGE_META);</span>
<span class="fc" id="L80">	}</span>

	public void init()
	{
<span class="fc" id="L84">		setId(ATTRIBUTE_META_DATA);</span>
<span class="fc" id="L85">		setLabel(&quot;Attribute&quot;);</span>
<span class="fc" id="L86">		setDescription(&quot;Meta data for attributes&quot;);</span>

<span class="fc" id="L88">		addAttribute(ID, ROLE_ID).setVisible(false).setAuto(true).setLabel(&quot;Identifier&quot;);</span>
<span class="fc" id="L89">		addAttribute(NAME, ROLE_LABEL, ROLE_LOOKUP).setNillable(false).setReadOnly(true).setLabel(&quot;Name&quot;);</span>
<span class="fc" id="L90">		addAttribute(ENTITY).setDataType(XREF)</span>
<span class="fc" id="L91">							.setRefEntity(entityTypeMeta)</span>
<span class="fc" id="L92">							.setLabel(&quot;Entity&quot;)</span>
<span class="fc" id="L93">							.setNillable(false)</span>
<span class="fc" id="L94">							.setReadOnly(true);</span>
<span class="fc" id="L95">		addAttribute(SEQUENCE_NR).setDataType(INT)</span>
<span class="fc" id="L96">								 .setLabel(&quot;Sequence number&quot;)</span>
<span class="fc" id="L97">								 .setDescription(&quot;Number that defines order of attributes in a entity&quot;)</span>
<span class="fc" id="L98">								 .setNillable(false);</span>
<span class="fc" id="L99">		addAttribute(TYPE).setDataType(ENUM)</span>
<span class="fc" id="L100">						  .setEnumOptions(AttributeType.getOptionsLowercase())</span>
<span class="fc" id="L101">						  .setNillable(false)</span>
<span class="fc" id="L102">						  .setLabel(&quot;Data type&quot;);</span>
<span class="fc" id="L103">		addAttribute(IS_ID_ATTRIBUTE).setDataType(BOOL)</span>
<span class="fc" id="L104">									 .setLabel(&quot;ID attribute&quot;)</span>
<span class="fc" id="L105">									 .setValidationExpression(getIdAttributeValidationExpression());</span>
<span class="fc" id="L106">		addAttribute(IS_LABEL_ATTRIBUTE).setDataType(BOOL).setLabel(&quot;Label attribute&quot;);</span>
<span class="fc" id="L107">		addAttribute(LOOKUP_ATTRIBUTE_INDEX).setDataType(INT)</span>
<span class="fc" id="L108">											.setLabel(&quot;Lookup attribute index&quot;)</span>
<span class="fc" id="L109">											.setValidationExpression(getLookupAttributeValidationExpression());</span>
<span class="fc" id="L110">		Attribute parentAttr = addAttribute(PARENT).setDataType(XREF).setRefEntity(this).setLabel(&quot;Attribute parent&quot;);</span>
<span class="fc" id="L111">		addAttribute(CHILDREN).setDataType(ONE_TO_MANY)</span>
<span class="fc" id="L112">							  .setRefEntity(this)</span>
<span class="fc" id="L113">							  .setMappedBy(parentAttr)</span>
<span class="fc" id="L114">							  .setOrderBy(new Sort(SEQUENCE_NR))</span>
<span class="fc" id="L115">							  .setLabel(&quot;Attribute parts&quot;)</span>
<span class="fc" id="L116">							  .setCascadeDelete(true);</span>
<span class="fc" id="L117">		addAttribute(REF_ENTITY_TYPE).setDataType(XREF)</span>
<span class="fc" id="L118">									 .setRefEntity(entityTypeMeta)</span>
<span class="fc" id="L119">									 .setLabel(&quot;Referenced entity&quot;)</span>
<span class="fc" id="L120">									 .setValidationExpression(getRefEntityValidationExpression());</span>
<span class="fc" id="L121">		addAttribute(IS_CASCADE_DELETE).setDataType(BOOL)</span>
<span class="fc" id="L122">									   .setLabel(&quot;Cascade delete&quot;)</span>
<span class="fc" id="L123">									   .setDescription(&quot;Delete corresponding referenced entities on delete&quot;)</span>
<span class="fc" id="L124">									   .setValidationExpression(getCascadeDeleteValidationExpression());</span>
<span class="fc" id="L125">		addAttribute(MAPPED_BY).setDataType(XREF)</span>
<span class="fc" id="L126">							   .setRefEntity(this)</span>
<span class="fc" id="L127">							   .setLabel(&quot;Mapped by&quot;)</span>
<span class="fc" id="L128">							   .setDescription(</span>
									   &quot;Attribute in the referenced entity that owns the relationship of a onetomany attribute&quot;)
<span class="fc" id="L130">							   .setValidationExpression(getMappedByValidationExpression())</span>
<span class="fc" id="L131">							   .setReadOnly(true);</span>
<span class="fc" id="L132">		addAttribute(ORDER_BY).setLabel(&quot;Order by&quot;)</span>
<span class="fc" id="L133">							  .setDescription(</span>
									  &quot;Order expression that defines entity collection order of a onetomany attribute (e.g. \&quot;attr0\&quot;, \&quot;attr0,ASC\&quot;, \&quot;attr0,DESC\&quot; or \&quot;attr0,ASC;attr1,DESC\&quot;&quot;)
<span class="fc" id="L135">							  .setValidationExpression(getOrderByValidationExpression());</span>
<span class="fc" id="L136">		addAttribute(EXPRESSION).setNillable(true)</span>
<span class="fc" id="L137">								.setLabel(&quot;Expression&quot;)</span>
<span class="fc" id="L138">								.setDescription(&quot;Computed value expression in Magma JavaScript&quot;);</span>
<span class="fc" id="L139">		addAttribute(IS_NULLABLE).setDataType(BOOL)</span>
<span class="fc" id="L140">								 .setNillable(false)</span>
<span class="fc" id="L141">								 .setLabel(&quot;Nillable&quot;)</span>
<span class="fc" id="L142">								 .setDefaultValue(&quot;true&quot;)</span>
<span class="fc" id="L143">								 .setValidationExpression(getNullableValidationExpression());</span>
<span class="fc" id="L144">		addAttribute(IS_AUTO).setDataType(BOOL)</span>
<span class="fc" id="L145">							 .setNillable(false)</span>
<span class="fc" id="L146">							 .setLabel(&quot;Auto&quot;)</span>
<span class="fc" id="L147">							 .setDescription(&quot;Auto generated values&quot;)</span>
<span class="fc" id="L148">							 .setValidationExpression(getAutoValidationExpression());</span>
<span class="fc" id="L149">		addAttribute(IS_VISIBLE).setDataType(BOOL).setNillable(false).setLabel(&quot;Visible&quot;);</span>
<span class="fc" id="L150">		addAttribute(LABEL, ROLE_LOOKUP).setLabel(&quot;Label&quot;);</span>
<span class="fc" id="L151">		addAttribute(DESCRIPTION).setDataType(TEXT).setLabel(&quot;Description&quot;);</span>
<span class="fc" id="L152">		addAttribute(IS_AGGREGATABLE).setDataType(BOOL)</span>
<span class="fc" id="L153">									 .setNillable(false)</span>
<span class="fc" id="L154">									 .setLabel(&quot;Aggregatable&quot;)</span>
<span class="fc" id="L155">									 .setValidationExpression(getAggregatableExpression());</span>
<span class="fc" id="L156">		addAttribute(ENUM_OPTIONS).setDataType(TEXT)</span>
<span class="fc" id="L157">								  .setLabel(&quot;Enum values&quot;)</span>
<span class="fc" id="L158">								  .setDescription(&quot;For data type ENUM&quot;)</span>
<span class="fc" id="L159">								  .setValidationExpression(getEnumOptionsValidationExpression());</span>
<span class="fc" id="L160">		addAttribute(RANGE_MIN).setDataType(LONG)</span>
<span class="fc" id="L161">							   .setLabel(&quot;Range min&quot;)</span>
<span class="fc" id="L162">							   .setValidationExpression(getRangeValidationExpression(RANGE_MIN));</span>
<span class="fc" id="L163">		addAttribute(RANGE_MAX).setDataType(LONG)</span>
<span class="fc" id="L164">							   .setLabel(&quot;Range max&quot;)</span>
<span class="fc" id="L165">							   .setValidationExpression(getRangeValidationExpression(RANGE_MAX));</span>
<span class="fc" id="L166">		addAttribute(IS_READ_ONLY).setDataType(BOOL).setNillable(false).setLabel(&quot;Read-only&quot;);</span>
<span class="fc" id="L167">		addAttribute(IS_UNIQUE).setDataType(BOOL).setNillable(false).setLabel(&quot;Unique&quot;);</span>
<span class="fc" id="L168">		addAttribute(TAGS).setDataType(MREF).setRefEntity(tagMetadata).setLabel(&quot;Tags&quot;);</span>
<span class="fc" id="L169">		addAttribute(NULLABLE_EXPRESSION).setDataType(SCRIPT).setNillable(true).setLabel(&quot;Nullable expression&quot;);</span>
<span class="fc" id="L170">		addAttribute(VISIBLE_EXPRESSION).setDataType(SCRIPT).setNillable(true).setLabel(&quot;Visible expression&quot;);</span>
<span class="fc" id="L171">		addAttribute(VALIDATION_EXPRESSION).setDataType(SCRIPT).setNillable(true).setLabel(&quot;Validation expression&quot;);</span>
<span class="fc" id="L172">		addAttribute(DEFAULT_VALUE).setDataType(TEXT).setNillable(true).setLabel(&quot;Default value&quot;);</span>
<span class="fc" id="L173">	}</span>

	// setter injection instead of constructor injection to avoid unresolvable circular dependencies
	@Autowired
	public void setTagMetadata(TagMetadata tagMetadata)
	{
<span class="fc" id="L179">		this.tagMetadata = requireNonNull(tagMetadata);</span>
<span class="fc" id="L180">	}</span>

	@Autowired
	public void setEntityTypeMetadata(EntityTypeMetadata entityTypeMeta)
	{
<span class="fc" id="L185">		this.entityTypeMeta = requireNonNull(entityTypeMeta);</span>
<span class="fc" id="L186">	}</span>

	private static String getMappedByValidationExpression()
	{
<span class="fc" id="L190">		return &quot;$('&quot; + MAPPED_BY + &quot;').isNull().and($('&quot; + TYPE + &quot;').eq('&quot; + getValueString(ONE_TO_MANY)</span>
<span class="fc" id="L191">				+ &quot;').not()).or(&quot; + &quot;$('&quot; + MAPPED_BY + &quot;').isNull().not().and($('&quot; + TYPE + &quot;').eq('&quot; + getValueString(</span>
				ONE_TO_MANY) + &quot;'))).value()&quot;;
	}

	private static String getOrderByValidationExpression()
	{
<span class="fc" id="L197">		String regex = &quot;/^\\w+(,(ASC|DESC))?(;\\w+(,(ASC|DESC))?)*$/&quot;;</span>
<span class="fc" id="L198">		return &quot;$('&quot; + ORDER_BY + &quot;').isNull().or(&quot; + &quot;$('&quot; + ORDER_BY + &quot;').matches(&quot; + regex + &quot;).and($('&quot; + TYPE</span>
<span class="fc" id="L199">				+ &quot;').eq('&quot; + getValueString(ONE_TO_MANY) + &quot;'))).value()&quot;;</span>
	}

	private static String getNullableValidationExpression()
	{
<span class="fc" id="L204">		return &quot;$('&quot; + IS_NULLABLE + &quot;').eq(true).or(&quot; + &quot;$('&quot; + NULLABLE_EXPRESSION + &quot;').isNull()).value()&quot;;</span>
	}

	private static String getEnumOptionsValidationExpression()
	{
<span class="fc" id="L209">		return &quot;$('&quot; + ENUM_OPTIONS + &quot;').isNull().and($('&quot; + TYPE + &quot;').eq('&quot; + getValueString(ENUM) + &quot;').not()).or(&quot;</span>
<span class="fc" id="L210">				+ &quot;$('&quot; + ENUM_OPTIONS + &quot;').isNull().not().and($('&quot; + TYPE + &quot;').eq('&quot; + getValueString(ENUM)</span>
				+ &quot;'))).value()&quot;;
	}

	private static String getRefEntityValidationExpression()
	{
<span class="fc" id="L216">		String regex = &quot;/^(&quot; + Arrays.stream(AttributeType.values())</span>
<span class="fc" id="L217">									 .filter(EntityTypeUtils::isReferenceType)</span>
<span class="fc" id="L218">									 .map(AttributeType::getValueString)</span>
<span class="fc" id="L219">									 .collect(Collectors.joining(&quot;|&quot;)) + &quot;)$/&quot;;</span>

<span class="fc" id="L221">		return &quot;$('&quot; + REF_ENTITY_TYPE + &quot;').isNull().and($('&quot; + TYPE + &quot;').matches(&quot; + regex + &quot;).not()).or(&quot; + &quot;$('&quot;</span>
				+ REF_ENTITY_TYPE + &quot;').isNull().not().and($('&quot; + TYPE + &quot;').matches(&quot; + regex + &quot;))).value()&quot;;
	}

	private static String getCascadeDeleteValidationExpression()
	{
<span class="fc" id="L227">		return &quot;$('&quot; + IS_CASCADE_DELETE + &quot;').isNull().or(&quot; + &quot;$('&quot; + REF_ENTITY_TYPE + &quot;').isNull().not()).value()&quot;;</span>
	}

	private static String getAutoValidationExpression()
	{
<span class="fc" id="L232">		String dateTypeRegex = &quot;/^(&quot; + Arrays.stream(AttributeType.values())</span>
<span class="fc" id="L233">											 .filter(EntityTypeUtils::isDateType)</span>
<span class="fc" id="L234">											 .map(AttributeType::getValueString)</span>
<span class="fc" id="L235">											 .collect(Collectors.joining(&quot;|&quot;)) + &quot;)$/&quot;;</span>

<span class="fc" id="L237">		String autoIsTrue = &quot;$('&quot; + IS_AUTO + &quot;').eq(true)&quot;;</span>
<span class="fc" id="L238">		String autoIsFalse = &quot;$('&quot; + IS_AUTO + &quot;').eq(false)&quot;;</span>
<span class="fc" id="L239">		String autoIsTrueAndIsIdIsTrueAndTypeIsStringOrNull =</span>
<span class="fc" id="L240">				autoIsTrue + &quot;.and($('&quot; + IS_ID_ATTRIBUTE + &quot;').eq(true).and($('&quot; + TYPE + &quot;').eq('&quot; + getValueString(</span>
						STRING) + &quot;').or($('&quot; + TYPE + &quot;').isNull())))&quot;;
<span class="fc" id="L242">		String autoIsTrueAndIsIdIsFalseOrNullAndTypeIsDateType =</span>
				autoIsTrue + &quot;.and($('&quot; + IS_ID_ATTRIBUTE + &quot;').eq(false).or($('&quot; + IS_ID_ATTRIBUTE
						+ &quot;').isNull())).and($('&quot; + TYPE + &quot;').matches(&quot; + dateTypeRegex + &quot;))&quot;;

<span class="fc" id="L246">		return autoIsFalse + &quot;.or(&quot; + autoIsTrueAndIsIdIsTrueAndTypeIsStringOrNull + &quot;).or(&quot;</span>
				+ autoIsTrueAndIsIdIsFalseOrNullAndTypeIsDateType + &quot;).value()&quot;;
	}

	private static String getRangeValidationExpression(String attribute)
	{
<span class="fc" id="L252">		String regex = &quot;/^(&quot; + Arrays.stream(AttributeType.values())</span>
<span class="fc" id="L253">									 .filter(EntityTypeUtils::isIntegerType)</span>
<span class="fc" id="L254">									 .map(AttributeType::getValueString)</span>
<span class="fc" id="L255">									 .collect(Collectors.joining(&quot;|&quot;)) + &quot;)$/&quot;;</span>
<span class="fc" id="L256">		String rangeIsNull = &quot;$('&quot; + attribute + &quot;').isNull()&quot;;</span>

<span class="fc" id="L258">		return rangeIsNull + &quot;.or(&quot; + rangeIsNull + &quot;.not().and($('&quot; + TYPE + &quot;').matches(&quot; + regex + &quot;))).value()&quot;;</span>
	}

	// Package private for testability
	static String getIdAttributeValidationExpression()
	{
<span class="fc" id="L264">		String isIdIsTrue = &quot;$('&quot; + IS_ID_ATTRIBUTE + &quot;').eq(true)&quot;;</span>
<span class="fc" id="L265">		String isIdIsFalseOrNull = &quot;$('&quot; + IS_ID_ATTRIBUTE + &quot;').eq(false).or($('&quot; + IS_ID_ATTRIBUTE + &quot;').isNull())&quot;;</span>

		// Use the valid ID attribute types to constuct the validation expression
<span class="fc" id="L268">		List&lt;String&gt; typeExpressions = getValidIdAttributeTypes().stream()</span>
<span class="fc" id="L269">																 .map(attributeType -&gt; &quot;$('&quot; + TYPE + &quot;').eq('&quot;</span>
<span class="fc" id="L270">																		 + getValueString(attributeType) + &quot;')&quot;)</span>
<span class="fc" id="L271">																 .collect(Collectors.toList());</span>

<span class="fc" id="L273">		boolean first = true;</span>
<span class="fc" id="L274">		StringBuilder typeIsNullOrStringOrIntOrLong = new StringBuilder();</span>
<span class="fc bfc" id="L275" title="All 2 branches covered.">		for (String expression : typeExpressions)</span>
		{
<span class="fc bfc" id="L277" title="All 2 branches covered.">			if (first)</span>
			{
<span class="fc" id="L279">				typeIsNullOrStringOrIntOrLong.append(expression);</span>
<span class="fc" id="L280">				first = false;</span>
<span class="fc" id="L281">				continue;</span>
			}
<span class="fc" id="L283">			typeIsNullOrStringOrIntOrLong.append(&quot;.or(&quot;).append(expression).append(&quot;)&quot;);</span>
<span class="fc" id="L284">		}</span>
<span class="fc" id="L285">		typeIsNullOrStringOrIntOrLong.append(&quot;.or($('&quot; + TYPE + &quot;').isNull())&quot;);</span>

<span class="fc" id="L287">		String nullableIsFalse = &quot;$('&quot; + IS_NULLABLE + &quot;').eq(false)&quot;;</span>

<span class="fc" id="L289">		return isIdIsFalseOrNull + &quot;.or(&quot; + isIdIsTrue + &quot;.and(&quot; + typeIsNullOrStringOrIntOrLong + &quot;).and(&quot;</span>
				+ nullableIsFalse + &quot;)).value()&quot;;
	}

	private static String getLookupAttributeValidationExpression()
	{
<span class="fc" id="L295">		String regex = &quot;/^(&quot; + Arrays.stream(AttributeType.values())</span>
<span class="fc" id="L296">									 .filter(EntityTypeUtils::isReferenceType)</span>
<span class="fc" id="L297">									 .map(AttributeType::getValueString)</span>
<span class="fc" id="L298">									 .collect(Collectors.joining(&quot;|&quot;)) + &quot;)$/&quot;;</span>

<span class="fc" id="L300">		return &quot;$('&quot; + LOOKUP_ATTRIBUTE_INDEX + &quot;').isNull().or(&quot; + &quot;$('&quot; + LOOKUP_ATTRIBUTE_INDEX</span>
				+ &quot;').isNull().not().and($('&quot; + TYPE + &quot;').matches(&quot; + regex + &quot;).not())).value()&quot;;
	}

	private static String getAggregatableExpression()
	{
<span class="fc" id="L306">		String aggregatableIsNullOrFalse =</span>
				&quot;$('&quot; + IS_AGGREGATABLE + &quot;').isNull().or($('&quot; + IS_AGGREGATABLE + &quot;').eq(false))&quot;;
<span class="fc" id="L308">		String regex = &quot;/^(&quot; + Arrays.stream(AttributeType.values())</span>
<span class="fc" id="L309">									 .filter(EntityTypeUtils::isReferenceType)</span>
<span class="fc" id="L310">									 .map(AttributeType::getValueString)</span>
<span class="fc" id="L311">									 .collect(Collectors.joining(&quot;|&quot;)) + &quot;)$/&quot;;</span>
<span class="fc" id="L312">		return aggregatableIsNullOrFalse + &quot;.or(&quot; + &quot;$('&quot; + TYPE + &quot;')&quot; + &quot;.matches(&quot; + regex + &quot;)&quot; + &quot;.and(&quot; + &quot;$('&quot;</span>
				+ IS_NULLABLE + &quot;')&quot; + &quot;.eq(false)&quot; + &quot;)&quot; + &quot;)&quot; + &quot;.or(&quot; + &quot;$('&quot; + TYPE + &quot;')&quot; + &quot;.matches(&quot; + regex
				+ &quot;).not()).value()&quot;;
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>