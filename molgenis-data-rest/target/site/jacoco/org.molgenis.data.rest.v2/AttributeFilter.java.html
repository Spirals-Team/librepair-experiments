<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AttributeFilter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">data-rest</a> &gt; <a href="index.source.html" class="el_package">org.molgenis.data.rest.v2</a> &gt; <span class="el_source">AttributeFilter.java</span></div><h1>AttributeFilter.java</h1><pre class="source lang-java linenums">package org.molgenis.data.rest.v2;

import org.molgenis.data.Entity;
import org.molgenis.data.meta.model.Attribute;
import org.molgenis.data.meta.model.EntityType;

import java.util.Collections;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.Map.Entry;

/**
 * An AttributeFilter represents the value of the attrs parameter in a REST query.
 * &lt;p&gt;
 * The AttributeFilter allows you to specify which attributes should be fetched for each {@link Entity} that is
 * retrieved.
 * &lt;p&gt;
 * By default, the top level entity will always be fetched with all attributes, but you can also specify a list of
 * attribute names. Those will be added to the ID and label attributes, which will always be fetched.
 * &lt;p&gt;
 * Referenced entities will always be fetched using ID and label, but you can also specify a list of attribute names.
 * Those will be added to the ID and label attributes, which will always be fetched. You can also specify the special
 * selector `*` which will fetch all attributes for a referenced entity.
 */
class AttributeFilter implements Iterable&lt;Entry&lt;String, AttributeFilter&gt;&gt;
{
	private final Map&lt;String, AttributeFilter&gt; attributes;
	private boolean includeAllAttrs;
	private boolean includeIdAttr;
	private boolean includeLabelAttr;
	private AttributeFilter idAttrFilter;
	private AttributeFilter labelAttrFilter;

	public AttributeFilter()
<span class="fc" id="L36">	{</span>
<span class="fc" id="L37">		this.attributes = new LinkedHashMap&lt;&gt;();</span>
<span class="fc" id="L38">	}</span>

	public boolean isIncludeAllAttrs()
	{
<span class="fc" id="L42">		return includeAllAttrs;</span>
	}

	/**
	 * Indicates if this filter is {@link #includeAllAttrs}, and NO other attributes are selected.
	 */
	public boolean isStar()
	{
<span class="pc bpc" id="L50" title="1 of 6 branches missed.">		return includeAllAttrs &amp;&amp; (attributes == null || attributes.keySet().isEmpty());</span>
	}

	AttributeFilter setIncludeAllAttrs(boolean includeAllAttrs)
	{
<span class="fc" id="L55">		this.includeAllAttrs = includeAllAttrs;</span>
<span class="fc" id="L56">		return this;</span>
	}

	public boolean isIncludeIdAttr()
	{
<span class="fc" id="L61">		return includeIdAttr;</span>
	}

	public AttributeFilter setIncludeIdAttr(boolean includeIdAttr)
	{
<span class="fc" id="L66">		return setIncludeIdAttr(includeIdAttr, null);</span>
	}

	public AttributeFilter setIncludeIdAttr(boolean includeIdAttr, AttributeFilter idAttrFilter)
	{
<span class="fc" id="L71">		this.includeIdAttr = includeIdAttr;</span>
<span class="fc" id="L72">		this.idAttrFilter = idAttrFilter;</span>
<span class="fc" id="L73">		return this;</span>
	}

	public boolean isIncludeLabelAttr()
	{
<span class="fc" id="L78">		return includeLabelAttr;</span>
	}

	public AttributeFilter setIncludeLabelAttr(boolean includeLabelAttr)
	{
<span class="fc" id="L83">		return setIncludeLabelAttr(includeLabelAttr, null);</span>
	}

	public AttributeFilter setIncludeLabelAttr(boolean includeLabelAttr, AttributeFilter labelAttrFilter)
	{
<span class="fc" id="L88">		this.includeLabelAttr = includeLabelAttr;</span>
<span class="fc" id="L89">		this.labelAttrFilter = labelAttrFilter;</span>
<span class="fc" id="L90">		return this;</span>
	}

	public AttributeFilter getAttributeFilter(EntityType entityType, Attribute attr)
	{
<span class="pc bpc" id="L95" title="3 of 4 branches missed.">		if (idAttrFilter != null &amp;&amp; attr.equals(entityType.getIdAttribute()))</span>
		{
<span class="nc" id="L97">			return idAttrFilter;</span>
		}
<span class="pc bpc" id="L99" title="3 of 4 branches missed.">		else if (labelAttrFilter != null &amp;&amp; attr.equals(entityType.getLabelAttribute()))</span>
		{
<span class="nc" id="L101">			return labelAttrFilter;</span>
		}
		else
		{
<span class="fc" id="L105">			return attributes.get(normalize(attr.getName()));</span>
		}
	}

	@Override
	public Iterator&lt;Entry&lt;String, AttributeFilter&gt;&gt; iterator()
	{
<span class="fc" id="L112">		return Collections.unmodifiableMap(attributes).entrySet().iterator();</span>
	}

	public AttributeFilter add(String name)
	{
<span class="fc" id="L117">		return add(name, null);</span>
	}

	public AttributeFilter add(String name, AttributeFilter attributeSelection)
	{
<span class="fc" id="L122">		attributes.put(normalize(name), attributeSelection);</span>
<span class="fc" id="L123">		return this;</span>
	}

	private String normalize(String name)
	{
<span class="fc" id="L128">		return name;//.toLowerCase();</span>
	}

	@Override
	public int hashCode()
	{
<span class="nc" id="L134">		final int prime = 31;</span>
<span class="nc" id="L135">		int result = 1;</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">		result = prime * result + ((attributes == null) ? 0 : attributes.hashCode());</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">		result = prime * result + (includeAllAttrs ? 1231 : 1237);</span>
<span class="nc" id="L138">		return result;</span>
	}

	@Override
	public boolean equals(Object obj)
	{
<span class="pc bpc" id="L144" title="1 of 2 branches missed.">		if (this == obj) return true;</span>
<span class="pc bpc" id="L145" title="1 of 2 branches missed.">		if (obj == null) return false;</span>
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">		if (getClass() != obj.getClass()) return false;</span>
<span class="fc" id="L147">		AttributeFilter other = (AttributeFilter) obj;</span>
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">		if (attributes == null)</span>
		{
<span class="nc bnc" id="L150" title="All 2 branches missed.">			if (other.attributes != null) return false;</span>
		}
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">		else if (!attributes.equals(other.attributes)) return false;</span>
<span class="pc bpc" id="L153" title="1 of 2 branches missed.">		if (includeAllAttrs != other.includeAllAttrs) return false;</span>
<span class="fc" id="L154">		return true;</span>
	}

	@Override
	public String toString()
	{
<span class="nc" id="L160">		return &quot;AttributeFilter [attributes=&quot; + attributes + &quot;, includeAllAttrs=&quot; + includeAllAttrs + &quot;]&quot;;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>