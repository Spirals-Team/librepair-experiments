<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AttributeResponse.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">data-rest</a> &gt; <a href="index.source.html" class="el_package">org.molgenis.data.rest</a> &gt; <span class="el_source">AttributeResponse.java</span></div><h1>AttributeResponse.java</h1><pre class="source lang-java linenums">package org.molgenis.data.rest;

import com.google.common.collect.Iterables;
import com.google.common.collect.Lists;
import org.molgenis.data.DataService;
import org.molgenis.data.Range;
import org.molgenis.data.meta.AttributeType;
import org.molgenis.data.meta.model.Attribute;
import org.molgenis.data.meta.model.EntityType;
import org.molgenis.data.rest.util.Href;
import org.molgenis.security.core.UserPermissionEvaluator;

import java.util.Collections;
import java.util.List;
import java.util.Map;
import java.util.Set;

import static org.molgenis.i18n.LanguageService.getCurrentUserLanguageCode;

public class AttributeResponse
{
	private final String href;
	private final AttributeType fieldType;
	private final String name;
	private final String label;
	private final String description;
	private final List&lt;?&gt; attributes;
	private final List&lt;String&gt; enumOptions;
	private final Long maxLength;
	private final Object refEntity;
	private final String mappedBy;
	private final Boolean auto;
	private final Boolean nillable;
	private final Boolean readOnly;
	private final Object defaultValue;
	private final Boolean labelAttribute;
	private final Boolean unique;
	private final Boolean visible;
	private Boolean lookupAttribute;
	private Boolean isAggregatable;
	private Range range;
	private String expression;
	private String nullableExpression;
	private String visibleExpression;
	private String validationExpression;

	public AttributeResponse(String entityParentName, EntityType entityType, Attribute attr,
			UserPermissionEvaluator permissionService, DataService dataService)
	{
<span class="nc" id="L50">		this(entityParentName, entityType, attr, null, null, permissionService, dataService);</span>
<span class="nc" id="L51">	}</span>

	/**
	 * @param attributesSet       set of lowercase attribute names to include in response
	 * @param attributeExpandsSet set of lowercase attribute names to expand in response
	 */
	public AttributeResponse(final String entityParentName, EntityType entityType, Attribute attr,
			Set&lt;String&gt; attributesSet, final Map&lt;String, Set&lt;String&gt;&gt; attributeExpandsSet,
			UserPermissionEvaluator permissionService, DataService dataService)
<span class="fc" id="L60">	{</span>
<span class="fc" id="L61">		String attrName = attr.getName();</span>
<span class="fc" id="L62">		this.href = Href.concatMetaAttributeHref(RestController.BASE_URI, entityParentName, attrName);</span>

<span class="pc bpc" id="L64" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;fieldType&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L66">			this.fieldType = attr.getDataType();</span>
		}
<span class="nc" id="L68">		else this.fieldType = null;</span>

<span class="pc bpc" id="L70" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;name&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L72">			this.name = attrName;</span>
		}
<span class="nc" id="L74">		else this.name = null;</span>

<span class="pc bpc" id="L76" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;label&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L78">			this.label = attr.getLabel(getCurrentUserLanguageCode());</span>
		}
<span class="nc" id="L80">		else this.label = null;</span>

<span class="pc bpc" id="L82" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;description&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L84">			this.description = attr.getDescription(getCurrentUserLanguageCode());</span>
		}
<span class="nc" id="L86">		else this.description = null;</span>

<span class="pc bpc" id="L88" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;enumOptions&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L90">			this.enumOptions = attr.getEnumOptions();</span>
		}
<span class="nc" id="L92">		else this.enumOptions = null;</span>

<span class="pc bpc" id="L94" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;maxLength&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L96">			this.maxLength = attr.getDataType().getMaxLength();</span>
		}
<span class="nc" id="L98">		else this.maxLength = null;</span>

<span class="pc bpc" id="L100" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;expression&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L102">			this.expression = attr.getExpression();</span>
		}
<span class="nc" id="L104">		else this.expression = null;</span>

<span class="pc bpc" id="L106" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;refEntity&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L108">			EntityType refEntity = attr.getRefEntity();</span>
<span class="pc bpc" id="L109" title="2 of 4 branches missed.">			if (attributeExpandsSet != null &amp;&amp; attributeExpandsSet.containsKey(&quot;refEntity&quot;.toLowerCase()))</span>
			{
<span class="fc" id="L111">				Set&lt;String&gt; subAttributesSet = attributeExpandsSet.get(&quot;refEntity&quot;.toLowerCase());</span>
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">				this.refEntity = refEntity != null ? new EntityTypeResponse(refEntity, subAttributesSet,</span>
<span class="pc" id="L113">						Collections.singletonMap(&quot;attributes&quot;.toLowerCase(), null), permissionService,</span>
						dataService) : null;
<span class="fc" id="L115">			}</span>
			else
			{
<span class="nc bnc" id="L118" title="All 2 branches missed.">				this.refEntity = refEntity != null ? new Href(</span>
<span class="nc" id="L119">						Href.concatMetaEntityHref(RestController.BASE_URI, refEntity.getId()),</span>
<span class="nc" id="L120">						String.format(&quot;%s/%s&quot;, RestController.BASE_URI,</span>
<span class="nc" id="L121">								refEntity.getId())) : null; // FIXME apply Href escaping fix</span>
			}
<span class="fc" id="L123">		}</span>
<span class="nc" id="L124">		else this.refEntity = null;</span>

<span class="fc" id="L126">		Attribute mappedByAttr = attr.getMappedBy();</span>
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">		this.mappedBy = mappedByAttr != null ? mappedByAttr.getName() : null;</span>

<span class="pc bpc" id="L129" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;attributes&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L131">			Iterable&lt;Attribute&gt; attributeParts = attr.getChildren();</span>
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">			this.attributes =</span>
<span class="pc" id="L133">					attributeParts != null ? Lists.newArrayList(Iterables.transform(attributeParts, attribute -&gt;</span>
					{
<span class="nc bnc" id="L135" title="All 4 branches missed.">						if (attributeExpandsSet != null &amp;&amp; attributeExpandsSet.containsKey(&quot;attributes&quot;.toLowerCase()))</span>
						{
<span class="nc" id="L137">							Set&lt;String&gt; subAttributesSet = attributeExpandsSet.get(&quot;attributes&quot;.toLowerCase());</span>
<span class="nc" id="L138">							return new AttributeResponse(entityParentName, entityType, attribute, subAttributesSet,</span>
<span class="nc" id="L139">									Collections.singletonMap(&quot;refEntity&quot;.toLowerCase(), null), permissionService,</span>
									dataService);
						}
						else
						{
<span class="nc" id="L144">							return Collections.&lt;String, Object&gt;singletonMap(&quot;href&quot;,</span>
<span class="nc" id="L145">									Href.concatMetaAttributeHref(RestController.BASE_URI, entityParentName,</span>
<span class="nc" id="L146">											attribute.getName()));</span>
						}
					})) : null;
<span class="fc" id="L149">		}</span>
<span class="nc" id="L150">		else this.attributes = null;</span>

<span class="pc bpc" id="L152" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;auto&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L154">			this.auto = attr.isAuto();</span>
		}
<span class="nc" id="L156">		else this.auto = null;</span>

<span class="pc bpc" id="L158" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;nillable&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L160">			this.nillable = attr.isNillable();</span>
		}
<span class="nc" id="L162">		else this.nillable = null;</span>

<span class="pc bpc" id="L164" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;readOnly&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L166">			this.readOnly = attr.isReadOnly();</span>
		}
<span class="nc" id="L168">		else this.readOnly = null;</span>

<span class="pc bpc" id="L170" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;defaultValue&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L172">			this.defaultValue = attr.getDefaultValue();</span>
		}
<span class="nc" id="L174">		else this.defaultValue = null;</span>

<span class="pc bpc" id="L176" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;labelAttribute&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L178">			this.labelAttribute = attr.equals(entityType.getLabelAttribute());</span>
		}
<span class="nc" id="L180">		else this.labelAttribute = null;</span>

<span class="pc bpc" id="L182" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;unique&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L184">			this.unique = attr.isUnique();</span>
		}
<span class="nc" id="L186">		else this.unique = null;</span>

<span class="pc bpc" id="L188" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;lookupAttribute&quot;.toLowerCase()))</span>
		{
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">			this.lookupAttribute = entityType.getLookupAttribute(attr.getName()) != null;</span>
		}
<span class="nc" id="L192">		else this.lookupAttribute = null;</span>

<span class="pc bpc" id="L194" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;isAggregatable&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L196">			this.isAggregatable = attr.isAggregatable();</span>
		}
<span class="nc" id="L198">		else this.isAggregatable = null;</span>

<span class="pc bpc" id="L200" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;range&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L202">			this.range = attr.getRange();</span>
		}
<span class="nc" id="L204">		else this.range = null;</span>

<span class="pc bpc" id="L206" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;isVisible&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L208">			this.visible = attr.isVisible();</span>
		}
<span class="nc" id="L210">		else this.visible = null;</span>

<span class="pc bpc" id="L212" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;nullableExpression&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L214">			this.nullableExpression = attr.getNullableExpression();</span>
		}
<span class="nc" id="L216">		else this.nullableExpression = null;</span>

<span class="pc bpc" id="L218" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;visibleExpression&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L220">			this.visibleExpression = attr.getVisibleExpression();</span>
		}
<span class="nc" id="L222">		else this.visibleExpression = null;</span>

<span class="pc bpc" id="L224" title="3 of 4 branches missed.">		if (attributesSet == null || attributesSet.contains(&quot;validationExpression&quot;.toLowerCase()))</span>
		{
<span class="fc" id="L226">			this.validationExpression = attr.getValidationExpression();</span>
		}
<span class="nc" id="L228">		else this.validationExpression = null;</span>
<span class="fc" id="L229">	}</span>

	public String getHref()
	{
<span class="nc" id="L233">		return href;</span>
	}

	public AttributeType getFieldType()
	{
<span class="nc" id="L238">		return fieldType;</span>
	}

	public String getName()
	{
<span class="nc" id="L243">		return name;</span>
	}

	public String getLabel()
	{
<span class="nc" id="L248">		return label;</span>
	}

	public String getDescription()
	{
<span class="nc" id="L253">		return description;</span>
	}

	public List&lt;?&gt; getAttributes()
	{
<span class="nc" id="L258">		return attributes;</span>
	}

	public List&lt;String&gt; getEnumOptions()
	{
<span class="nc" id="L263">		return enumOptions;</span>
	}

	public Long getMaxLength()
	{
<span class="nc" id="L268">		return maxLength;</span>
	}

	public Object getRefEntity()
	{
<span class="nc" id="L273">		return refEntity;</span>
	}

	public String getMappedBy()
	{
<span class="nc" id="L278">		return mappedBy;</span>
	}

	public boolean isAuto()
	{
<span class="nc" id="L283">		return auto;</span>
	}

	public boolean isNillable()
	{
<span class="nc" id="L288">		return nillable;</span>
	}

	public boolean isReadOnly()
	{
<span class="nc" id="L293">		return readOnly;</span>
	}

	public Object getDefaultValue()
	{
<span class="nc" id="L298">		return defaultValue;</span>
	}

	public boolean isLabelAttribute()
	{
<span class="nc" id="L303">		return labelAttribute;</span>
	}

	public boolean isUnique()
	{
<span class="nc" id="L308">		return unique;</span>
	}

	public boolean isVisible()
	{
<span class="nc" id="L313">		return visible;</span>
	}

	public Boolean getLookupAttribute()
	{
<span class="nc" id="L318">		return lookupAttribute;</span>
	}

	public Boolean isAggregatable()
	{
<span class="nc" id="L323">		return isAggregatable;</span>
	}

	public Boolean getNillable()
	{
<span class="nc" id="L328">		return nillable;</span>
	}

	public Boolean getReadOnly()
	{
<span class="nc" id="L333">		return readOnly;</span>
	}

	public Boolean getLabelAttribute()
	{
<span class="nc" id="L338">		return labelAttribute;</span>
	}

	public Boolean getUnique()
	{
<span class="nc" id="L343">		return unique;</span>
	}

	public Boolean getAggregatable()
	{
<span class="nc" id="L348">		return isAggregatable;</span>
	}

	public Range getRange()
	{
<span class="nc" id="L353">		return range;</span>
	}

	public String getExpression()
	{
<span class="nc" id="L358">		return expression;</span>
	}

	public String getNullableExpression()
	{
<span class="nc" id="L363">		return nullableExpression;</span>
	}

	public String getVisibleExpression()
	{
<span class="nc" id="L368">		return visibleExpression;</span>
	}

	public String getValidationExpression()
	{
<span class="nc" id="L373">		return validationExpression;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>