<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SimpleHashMap.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">chapter_004</a> &gt; <a href="index.source.html" class="el_package">ru.job4j.map</a> &gt; <span class="el_source">SimpleHashMap.java</span></div><h1>SimpleHashMap.java</h1><pre class="source lang-java linenums">package ru.job4j.map;

import java.util.ConcurrentModificationException;
import java.util.Iterator;
import java.util.NoSuchElementException;
import java.util.Objects;

/**
 * @author Michael Hodkov
 * @version $Id$
 * @since 0.1
 */
public class SimpleHashMap&lt;K, V&gt; implements Iterable {
    private EntryItems[] array;
<span class="pc" id="L15">    private int defaultSize = 10;</span>
<span class="pc" id="L16">    private int size = 0;</span>
<span class="pc" id="L17">    private int modCount = 0;</span>

<span class="nc" id="L19">    public SimpleHashMap(int capacity) {</span>
<span class="nc bnc" id="L20" title="All 2 branches missed.">        if (capacity &lt; defaultSize) {</span>
<span class="nc" id="L21">            capacity = defaultSize;</span>
        }
<span class="nc" id="L23">        array = new EntryItems[capacity];</span>
<span class="nc" id="L24">    }</span>

<span class="fc" id="L26">    public SimpleHashMap() {</span>
<span class="fc" id="L27">        array = new EntryItems[defaultSize];</span>
<span class="fc" id="L28">    }</span>

    public boolean insert(K key, V value) {
<span class="fc" id="L31">        int factor = array.length;</span>
<span class="pc bpc" id="L32" title="1 of 2 branches missed.">        if (size &gt; factor * 2 / 3) {</span>
<span class="nc" id="L33">            resize(0);</span>
<span class="nc" id="L34">            factor = array.length;</span>
        }
<span class="fc" id="L36">        int index = myHash(key, factor);</span>
<span class="fc bfc" id="L37" title="All 2 branches covered.">        if (array[index] != null) {</span>
<span class="fc" id="L38">            return false;</span>
        }
<span class="fc" id="L40">        array[index] = new EntryItems(key, value);</span>
<span class="fc" id="L41">        modCount++;</span>
<span class="fc" id="L42">        size++;</span>
<span class="fc" id="L43">        return true;</span>
    }

    private void resize(int bigProblem) {
<span class="nc" id="L47">        EntryItems[] newArray = new EntryItems[array.length * 2 + bigProblem];</span>
<span class="nc" id="L48">        int factor = newArray.length;</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">        for (int i = 0; i &lt; array.length; i++) {</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">            if (array[i] != null) {</span>
<span class="nc" id="L51">                int index = myHash((K) array[i].key, factor);</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">                if (newArray[index] != null) {</span>
<span class="nc" id="L53">                    restart(factor);</span>
                } else {
<span class="nc" id="L55">                    newArray[index] = array[i];</span>
                }
            }
        }
<span class="nc" id="L59">        array = newArray;</span>
<span class="nc" id="L60">    }</span>

    private void restart(int factor) {
<span class="nc" id="L63">        resize(factor);</span>
<span class="nc" id="L64">    }</span>

    private int myHash(K key, int factor) {
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">        if (key == null) {</span>
<span class="nc" id="L68">            return 0;</span>
        }
<span class="fc" id="L70">        int h = key.hashCode();</span>
<span class="fc" id="L71">        h ^= (h &gt;&gt;&gt; 2) ^ (h &gt;&gt;&gt; 3);</span>
<span class="fc" id="L72">        h %= factor;</span>
<span class="pc bpc" id="L73" title="1 of 2 branches missed.">        return h &gt;= 0 ? h : h * -1;</span>
    }

    public V get(K key) {
<span class="fc" id="L77">        int index = myHash(key, array.length);</span>
<span class="pc bpc" id="L78" title="2 of 4 branches missed.">        if (array[index] != null &amp;&amp; array[index].key.equals(key)) {</span>
<span class="fc" id="L79">            return (V) array[index].value;</span>
        }
<span class="nc" id="L81">        return null;</span>
    }

    public boolean delete(K key) {
<span class="fc" id="L85">        modCount++;</span>
<span class="fc" id="L86">        int index = myHash(key, array.length);</span>
<span class="pc bpc" id="L87" title="2 of 4 branches missed.">        if (array[index] != null &amp;&amp; array[index].key.equals(key)) {</span>
<span class="fc" id="L88">            array[index] = null;</span>
<span class="fc" id="L89">            size--;</span>
<span class="fc" id="L90">            return true;</span>
        }
<span class="nc" id="L92">        return false;</span>
    }

    public int getSize() {
<span class="fc" id="L96">        return size;</span>
    }

    public int getCapacity() {
<span class="fc" id="L100">        return array.length;</span>
    }

    @Override
    public Iterator&lt;V&gt; iterator() {
<span class="fc" id="L105">        return new Iterator&lt;V&gt;() {</span>
<span class="fc" id="L106">            private int iterIndex = 0;</span>
<span class="fc" id="L107">            private int expectedModCount = modCount;</span>
            @Override
            public boolean hasNext() {
<span class="fc bfc" id="L110" title="All 2 branches covered.">                while (iterIndex &lt; getCapacity()) {</span>
<span class="fc bfc" id="L111" title="All 2 branches covered.">                    if (array[iterIndex] != null) {</span>
<span class="fc" id="L112">                        return true;</span>
                    } else {
<span class="fc" id="L114">                        iterIndex++;</span>
                    }
                }
<span class="fc" id="L117">                return false;</span>
            }

            @Override
            public V next() {
<span class="fc bfc" id="L122" title="All 2 branches covered.">                if (expectedModCount != modCount) {</span>
<span class="fc" id="L123">                    throw new ConcurrentModificationException(&quot;Iterator only for read.&quot;);</span>
                }
<span class="fc bfc" id="L125" title="All 2 branches covered.">                if (iterIndex == getCapacity()) {</span>
<span class="fc" id="L126">                    throw new NoSuchElementException(&quot;Not more elements.&quot;);</span>
                }
<span class="fc" id="L128">                hasNext();</span>
<span class="fc" id="L129">                return (V) array[iterIndex++].value;</span>
            }
        };
    }

    public void see() {
<span class="nc bnc" id="L135" title="All 2 branches missed.">        for (int i = 0; i &lt; array.length; i++) {</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">            if (array[i] != null) {</span>
<span class="nc" id="L137">                System.out.println(&quot;key: &quot; + array[i].key + &quot;, value: &quot; + array[i].value);</span>
            }
        }
<span class="nc" id="L140">    }</span>

    class EntryItems&lt;K, V&gt; {
        private K key;
        private V value;

<span class="fc" id="L146">        public EntryItems(K key, V value) {</span>
<span class="fc" id="L147">            this.key = key;</span>
<span class="fc" id="L148">            this.value = value;</span>
<span class="fc" id="L149">        }</span>

        @Override
        public boolean equals(Object o) {
<span class="nc bnc" id="L153" title="All 2 branches missed.">            if (this == o) {</span>
<span class="nc" id="L154">                return true;</span>
            }
<span class="nc bnc" id="L156" title="All 4 branches missed.">            if (o == null || getClass() != o.getClass()) {</span>
<span class="nc" id="L157">                return false;</span>
            }
<span class="nc" id="L159">            EntryItems that = (EntryItems) o;</span>
<span class="nc bnc" id="L160" title="All 4 branches missed.">            return Objects.equals(key, that.key) &amp;&amp; Objects.equals(value, that.value);</span>
        }

        @Override
        public int hashCode() {
<span class="nc" id="L165">            return Objects.hash(key, value);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>