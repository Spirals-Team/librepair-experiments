<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Jsonifiable.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Eclipse Ditto :: Model :: Base</a> &gt; <a href="index.source.html" class="el_package">org.eclipse.ditto.model.base.json</a> &gt; <span class="el_source">Jsonifiable.java</span></div><h1>Jsonifiable.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2017 Bosch Software Innovations GmbH.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v2.0
 * which accompanies this distribution, and is available at
 * https://www.eclipse.org/org/documents/epl-2.0/index.php
 *
 * Contributors:
 *    Bosch Software Innovations GmbH - initial contribution
 */
package org.eclipse.ditto.model.base.json;

import java.util.Arrays;
import java.util.Comparator;
import java.util.function.Predicate;

import org.eclipse.ditto.json.JsonFieldSelector;
import org.eclipse.ditto.json.JsonObject;
import org.eclipse.ditto.json.JsonPointer;
import org.eclipse.ditto.json.JsonValue;

/**
 * A {@code Jsonifiable} is an entity which can be represented as JSON (string).
 *
 * @param &lt;J&gt; the type of the JSON result.
 */
public interface Jsonifiable&lt;J extends JsonValue&gt; {

    /**
     * Returns the latest JsonSchemaVersion the implementing class supports.
     *
     * @return the latest JsonSchemaVersion the implementing class supports.
     */
    default JsonSchemaVersion getLatestSchemaVersion() {
<span class="nc" id="L36">        return Arrays.stream(getSupportedSchemaVersions())</span>
<span class="nc" id="L37">                .max(Comparator.naturalOrder()) // find highest (latest) schema version</span>
<span class="nc" id="L38">                .orElseThrow(() -&gt; // if array is empty, throw:</span>
<span class="nc" id="L39">                        new IllegalStateException(</span>
                                &quot;Jsonifiable does not provide information about which schema versions it implements&quot;));
    }

    /**
     * Returns all supported JsonSchemaVersions the implementing class supports. Must be overwritten for
     * classes/interfaces which do not support the &quot;full range&quot; of JsonSchemaVersions currently available.
     *
     * @return all supported JsonSchemaVersions the implementing class supports.
     */
    default JsonSchemaVersion[] getSupportedSchemaVersions() {
<span class="nc" id="L50">        return new JsonSchemaVersion[]{JsonSchemaVersion.V_1, JsonSchemaVersion.V_2};</span>
    }

    /**
     * Returns the JsonSchemaVersion &lt;b&gt;the instance&lt;/b&gt; of this Jsonifiable implements. Must be overridden if schema
     * version is persisted in implementing entity itself! Otherwise falls back to the {@link
     * #getLatestSchemaVersion()}.
     *
     * @return the current JsonSchemaVersion.
     */
    default JsonSchemaVersion getImplementedSchemaVersion() {
<span class="nc" id="L61">        return getLatestSchemaVersion();</span>
    }

    /**
     * Returns whether or not this {@code Jsonifiable} implements the given {@code version}.
     *
     * @param version the version.
     * @return whether or not this Jsonifiable implements the given version.
     */
    default boolean implementsSchemaVersion(final int version) {
<span class="nc" id="L71">        return JsonSchemaVersion.forInt(version)</span>
<span class="nc" id="L72">                .map(this::implementsSchemaVersion)</span>
<span class="nc" id="L73">                .orElse(false);</span>
    }

    /**
     * Returns whether or not this {@code Jsonifiable} implements the given {@code schemaVersion}.
     *
     * @param schemaVersion the schema version.
     * @return whether or not this Jsonifiable implements the given schemaVersion.
     */
    default boolean implementsSchemaVersion(final JsonSchemaVersion schemaVersion) {
<span class="nc" id="L83">        return Arrays.asList(getSupportedSchemaVersions()).contains(schemaVersion);</span>
    }

    /**
     * Returns this object as {@link JsonValue}.
     *
     * @return a JSON value representation of this object.
     */
    J toJson();

    /**
     * Returns a JSON string representation of this object.
     *
     * @return a JSON string representation of this object.
     * @see #toJson()
     */
    default String toJsonString() {
<span class="nc" id="L100">        return toJson().toString();</span>
    }

    /**
     * Represents a {@code Jsonifiable} where additionally a {@code Predicate} can be specified which determines the
     * content of the result JSON. The predicate is parametrized as only the implementing class knows how the JSON is
     * being created. In the following example an object is jsonified but only those fields should be included which are
     * part of a particular schema version. First the declaration of the object's class:
     *
     * &lt;pre&gt;
     *    public final class MyObject implements Jsonifiable.WithPredicate&amp;lt;JsonField&amp;gt; {
     *       ...
     *    }
     * &lt;/pre&gt;
     *
     * Then the method invocation for creating a JSON object of a particular JSON schema version.
     *
     * &lt;pre&gt;
     *    final MyObject myObject = ...;
     *    final JsonValue myObjectJson = myObject.toJson(JsonSchemaVersion.V_1);
     * &lt;/pre&gt;
     *
     * This works because {@code JsonSchemaVersion} implements {@code Predicate&lt;JsonField&gt;}.
     *
     * @param &lt;J&gt; the type of the JSON result.
     * @param &lt;T&gt; the type which the predicate consumes for evaluation.
     */
    interface WithPredicate&lt;J extends JsonValue, T&gt; extends Jsonifiable&lt;J&gt; {

        /**
         * Returns this object as {@link JsonValue}. The content of the result is determined by the given predicate.
         *
         * @param predicate determines the content of the result.
         * @return a JSON value representation of this object.
         * @throws NullPointerException if {@code predicate} is {@code null}.
         */
        default J toJson(final Predicate&lt;T&gt; predicate) {
<span class="nc bnc" id="L137" title="All 2 branches missed.">            if (predicate instanceof JsonSchemaVersion) {</span>
                // by default: return REGULAR fields which are not HIDDEN:
<span class="nc" id="L139">                return toJson((JsonSchemaVersion) predicate, (Predicate&lt;T&gt;) FieldType.notHidden());</span>
            } else {
                // Default JsonSchemaVersion for all implementations:
<span class="nc" id="L142">                return toJson(getLatestSchemaVersion(), predicate);</span>
            }
        }

        /**
         * Returns this object as {@link JsonValue}. The content of the result is determined by the given predicate.
         *
         * @param schemaVersion the JsonSchemaVersion in which to return the JSON.
         * @param predicate determines the content of the result.
         * @return a JSON value representation of this object.
         * @throws NullPointerException if {@code predicate} is {@code null}.
         */
        J toJson(JsonSchemaVersion schemaVersion, Predicate&lt;T&gt; predicate);

        /**
         * Returns a JSON string representation of this object. The content of the result is determined by the given
         * predicate.
         *
         * @param predicate determines the content of the result.
         * @return a JSON string representation of this object.
         * @throws NullPointerException if {@code predicate} is {@code null}.
         * @see #toJson(Predicate)
         */
        default String toJsonString(final Predicate&lt;T&gt; predicate) {
<span class="nc" id="L166">            return toJson(predicate).toString();</span>
        }

        /**
         * Returns a JSON string representation of this object. The content of the result is determined by the given
         * predicate.
         *
         * @param schemaVersion the JsonSchemaVersion in which to return the JSON.
         * @param predicate determines the content of the result.
         * @return a JSON string representation of this object.
         * @throws NullPointerException if {@code predicate} is {@code null}.
         * @see #toJson(JsonSchemaVersion, Predicate)
         */
        default String toJsonString(final JsonSchemaVersion schemaVersion, final Predicate&lt;T&gt; predicate) {
<span class="nc" id="L180">            return toJson(schemaVersion, predicate).toString();</span>
        }
    }

    /**
     * Represents a {@code Jsonifiable} where additionally a {@code JsonPointer} can be specified to determine the
     * content of the result JSON.
     *
     * @param &lt;J&gt; the type of the JSON result.
     */
    interface WithPointer&lt;J extends JsonValue&gt; extends Jsonifiable&lt;J&gt; {

        /**
         * Returns this object as {@link JsonValue}. The content of the result is determined by the given pointer.
         *
         * @param pointer determines the field to be included in the JSON representation.
         * @return a JSON value representation of this object.
         * @throws NullPointerException if {@code pointer} is {@code null}.
         */
        default J toJson(final JsonPointer pointer) {
<span class="nc" id="L200">            return toJson(getLatestSchemaVersion(), pointer);</span>
        }

        /**
         * Returns this object as {@link JsonValue}. The content of the result is determined by the given pointer.
         *
         * @param schemaVersion the JsonSchemaVersion in which to return the JSON.
         * @param pointer determines the field to be included in the JSON representation.
         * @return a JSON value representation of this object.
         * @throws NullPointerException if {@code pointer} is {@code null}.
         */
        J toJson(JsonSchemaVersion schemaVersion, JsonPointer pointer);

        /**
         * Returns a JSON string representation of this object. The content of the result is determined by the given
         * pointer.
         *
         * @param pointer determines the field to be included in the JSON representation.
         * @return a JSON string representation of this object.
         * @throws NullPointerException if {@code pointer} is {@code null}.
         * @see #toJson(JsonPointer)
         */
        default String toJsonString(final JsonPointer pointer) {
<span class="nc" id="L223">            return toJson(pointer).toString();</span>
        }

        /**
         * Returns a JSON string representation of this object. The content of the result is determined by the given
         * pointer.
         *
         * @param schemaVersion the JsonSchemaVersion in which to return the JSON.
         * @param pointer determines the field to be included in the JSON representation.
         * @return a JSON string representation of this object.
         * @throws NullPointerException if {@code pointer} is {@code null}.
         * @see #toJson(JsonSchemaVersion, JsonPointer)
         */
        default String toJsonString(final JsonSchemaVersion schemaVersion, final JsonPointer pointer) {
<span class="nc" id="L237">            return toJson(schemaVersion, pointer).toString();</span>
        }
    }

    /**
     * Represents a {@code Jsonifiable} where additionally a {@code JsonFieldSelector} can be specified to determine the
     * content of the result JSON.
     *
     */
    interface WithFieldSelector extends Jsonifiable&lt;JsonObject&gt;, WithPointer&lt;JsonObject&gt; {

        /**
         * Returns this object as {@link JsonObject}. The content of the result is determined by the given field
         * selector.
         *
         * @param fieldSelector determines the content of the result.
         * @return a JSON object representation of this object.
         * @throws NullPointerException if {@code fieldSelector} is {@code null}.
         */
        default JsonObject toJson(final JsonFieldSelector fieldSelector) {
<span class="nc" id="L257">            return toJson(getLatestSchemaVersion(), fieldSelector);</span>
        }

        /**
         * Returns this object as {@link JsonObject}. The content of the result is determined by the given field
         * selector.
         *
         * @param schemaVersion the JsonSchemaVersion in which to return the JSON.
         * @param fieldSelector determines the content of the result.
         * @return a JSON object representation of this object.
         * @throws NullPointerException if {@code fieldSelector} is {@code null}.
         */
        JsonObject toJson(JsonSchemaVersion schemaVersion, JsonFieldSelector fieldSelector);

        /**
         * Returns a JSON string representation of this object. The content of the result is determined by the given
         * field selector.
         *
         * @param fieldSelector determines the content of the result.
         * @return a JSON string representation of this object.
         * @throws NullPointerException if {@code fieldSelector} is {@code null}.
         * @see #toJson(JsonFieldSelector)
         */
        default String toJsonString(final JsonFieldSelector fieldSelector) {
<span class="nc" id="L281">            return toJson(fieldSelector).toString();</span>
        }

        /**
         * Returns a JSON string representation of this object. The content of the result is determined by the given
         * field selector.
         *
         * @param schemaVersion the JsonSchemaVersion in which to return the JSON.
         * @param fieldSelector determines the content of the result.
         * @return a JSON string representation of this object.
         * @throws NullPointerException if {@code fieldSelector} is {@code null}.
         * @see #toJson(JsonSchemaVersion, JsonFieldSelector)
         */
        default String toJsonString(final JsonSchemaVersion schemaVersion, final JsonFieldSelector fieldSelector) {
<span class="nc" id="L295">            return toJson(schemaVersion, fieldSelector).toString();</span>
        }

        @Override
        default JsonObject toJson(final JsonPointer pointer) {
<span class="nc" id="L300">            return toJson(pointer.toFieldSelector());</span>
        }

        @Override
        default JsonObject toJson(final JsonSchemaVersion schemaVersion, final JsonPointer pointer) {
<span class="nc" id="L305">            return toJson(schemaVersion, pointer.toFieldSelector());</span>
        }
    }

    /**
     * Represents a {@code Jsonifiable} where additionally a {@code Predicate} as well as a {@code JsonFieldSelector}
     * can be specified to determine the content of the result JSON.
     *
     * @param &lt;T&gt; the type which the predicate consumes for evaluation.
     */
    interface WithFieldSelectorAndPredicate&lt;T&gt; extends Jsonifiable.WithPredicate&lt;JsonObject, T&gt;, WithFieldSelector {

        /**
         * Returns this object as {@link JsonValue}. The content of the result is determined by the given predicate as
         * well as the given field selector.
         *
         * @param fieldSelector additionally determines the content of the result.
         * @param predicate determines the content of the result.
         * @return a JSON value representation of this object.
         * @throws NullPointerException if any argument is {@code null}.
         * @see #toJson(Predicate)
         * @see #toJson(JsonFieldSelector)
         */
        default JsonObject toJson(final JsonFieldSelector fieldSelector, final Predicate&lt;T&gt; predicate) {
<span class="nc" id="L329">            return toJson(getLatestSchemaVersion(), predicate).get(fieldSelector);</span>
        }

        /**
         * Returns this object as {@link JsonValue}. The content of the result is determined by the given predicate as
         * well as the given field selector.
         *
         * @param schemaVersion the JsonSchemaVersion in which to return the JSON.
         * @param fieldSelector additionally determines the content of the result.
         * @param predicate determines the content of the result.
         * @return a JSON value representation of this object.
         * @throws NullPointerException if any argument is {@code null}.
         * @see #toJson(Predicate)
         * @see #toJson(JsonFieldSelector)
         */
        default JsonObject toJson(final JsonSchemaVersion schemaVersion, final JsonFieldSelector fieldSelector,
                final Predicate&lt;T&gt; predicate) {
<span class="nc" id="L346">            return toJson(schemaVersion, predicate).get(fieldSelector);</span>
        }

        /**
         * Returns a JSON string representation of this object. The content of the result is determined by the given
         * predicate as well as the given field selector.
         *
         * @param fieldSelector additionally determines the content of the result.
         * @param predicate determines the content of the result.
         * @return a JSON string representation of this object.
         * @throws NullPointerException if any argument is {@code null}.
         * @see #toJson(Predicate)
         * @see #toJson(JsonFieldSelector)
         */
        default String toJsonString(final JsonFieldSelector fieldSelector, final Predicate&lt;T&gt; predicate) {
<span class="nc" id="L361">            return toJsonString(getLatestSchemaVersion(), fieldSelector, predicate);</span>
        }

        /**
         * Returns a JSON string representation of this object. The content of the result is determined by the given
         * predicate as well as the given field selector.
         *
         * @param schemaVersion the schema version in which to return the JSON.
         * @param fieldSelector additionally determines the content of the result.
         * @param predicate determines the content of the result.
         * @return a JSON string representation of this object.
         * @throws NullPointerException if any argument is {@code null}.
         * @see #toJson(Predicate)
         * @see #toJson(JsonFieldSelector)
         */
        default String toJsonString(final JsonSchemaVersion schemaVersion, final JsonFieldSelector fieldSelector,
                final Predicate&lt;T&gt; predicate) {
<span class="nc" id="L378">            return toJson(schemaVersion, fieldSelector, predicate).toString();</span>
        }
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>