<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Connection.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Eclipse Ditto :: Model :: Connectivity</a> &gt; <a href="index.source.html" class="el_package">org.eclipse.ditto.model.connectivity</a> &gt; <span class="el_source">Connection.java</span></div><h1>Connection.java</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2017 Bosch Software Innovations GmbH.
 *
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v2.0
 * which accompanies this distribution, and is available at
 * https://www.eclipse.org/org/documents/epl-2.0/index.php
 *
 * Contributors:
 *    Bosch Software Innovations GmbH - initial contribution
 */
package org.eclipse.ditto.model.connectivity;

import java.util.Map;
import java.util.Optional;
import java.util.Set;

import javax.annotation.concurrent.Immutable;

import org.eclipse.ditto.json.JsonArray;
import org.eclipse.ditto.json.JsonFactory;
import org.eclipse.ditto.json.JsonField;
import org.eclipse.ditto.json.JsonFieldDefinition;
import org.eclipse.ditto.json.JsonFieldSelector;
import org.eclipse.ditto.json.JsonObject;
import org.eclipse.ditto.model.base.auth.AuthorizationContext;
import org.eclipse.ditto.model.base.json.FieldType;
import org.eclipse.ditto.model.base.json.JsonSchemaVersion;
import org.eclipse.ditto.model.base.json.Jsonifiable;

/**
 * Represents a connection within the Connectivity service.
 */
@Immutable
public interface Connection extends Jsonifiable.WithFieldSelectorAndPredicate&lt;JsonField&gt; {

    /**
     * Returns the identifier of this {@code Connection}.
     *
     * @return the identifier.
     */
    String getId();

    /**
     * Returns the connection type of this {@code Connection}.
     *
     * @return the connection type
     */
    ConnectionType getConnectionType();

    /**
     * Returns the persisted/desired ConnectionStatus of this {@code Connection}.
     *
     * @return the persisted ConnectionStatus
     */
    ConnectionStatus getConnectionStatus();

    /**
     * Returns the Authorization Context of this {@code Connection}.
     *
     * @return the Authorization Context.
     */
    AuthorizationContext getAuthorizationContext();

    /**
     * Returns a set of the sources of this {@code Connection}.
     *
     * @return the sources
     */
    Set&lt;Source&gt; getSources();

    /**
     * Returns a set of targets of this {@code Connection}.
     */
    Set&lt;Target&gt; getTargets();

    /**
     * Returns how many clients on different cluster nodes should establish the {@code Connection}.
     * &lt;p&gt;
     * If greater than 1, the connection is created in a HA mode, running on at least 2 cluster nodes.
     * &lt;/p&gt;
     *
     * @return the client count.
     */
    int getClientCount();

    /**
     * Returns whether or not failover is enabled for this {@code Connection}.
     *
     * @return {@code true} if failover is enabled, else {@code false}.
     */
    boolean isFailoverEnabled();

    /**
     * Returns the URI of this {@code Connection}.
     *
     * @return the URI.
     */
    String getUri();

    /**
     * Returns the protocol part of the URI of this {@code Connection}.
     *
     * @return the protocol.
     */
    String getProtocol();

    /**
     * Returns the username part of the URI of this {@code Connection}.
     *
     * @return the username.
     */
    Optional&lt;String&gt; getUsername();

    /**
     * Returns the password part of the URI of this {@code Connection}.
     *
     * @return the password.
     */
    Optional&lt;String&gt; getPassword();

    /**
     * Returns the hostname part of the URI of this {@code Connection}.
     *
     * @return the hostname.
     */
    String getHostname();

    /**
     * Returns the port part of the URI of this {@code Connection}.
     *
     * @return the port.
     */
    int getPort();

    /**
     * Returns the path part of the URI of this {@code Connection}.
     *
     * @return the path.
     */
    String getPath();

    /**
     * Whether to validate server certificates on connection establishment,
     *
     * @return {@code true} (default) if server certificates must be valid
     */
    boolean isValidateCertificates();

    /**
     * The size of the command processor pool i.e. how many processor actors.
     *
     * @return size of the command processor actor pool
     */
    int getProcessorPoolSize();

    /**
     * Returns configuration which is only applicable for a specific {@link ConnectionType}.
     *
     * @return an arbitrary map of config keys to config values
     */
    Map&lt;String, String&gt; getSpecificConfig();

    /**
     * Returns the MappingContext to apply in this connection containing either JavaScript scripts or a custom
     * implementation in Java mapping from external messages to internal Ditto Protocol messages.
     *
     * @return the MappingContext to apply for this connection
     */
    Optional&lt;MappingContext&gt; getMappingContext();

    /**
     * Returns a mutable builder with a fluent API for immutable {@code Connection}. The builder is initialised with the
     * entries of this instance.
     *
     * @return the new builder.
     */
    default ConnectionBuilder toBuilder() {
<span class="nc" id="L179">        return ConnectivityModelFactory.newConnectionBuilder(this);</span>
    }

    /**
     * Returns all non hidden marked fields of this {@code Connection}.
     *
     * @return a JSON object representation of this Connection including only non hidden marked fields.
     */
    @Override
    default JsonObject toJson() {
<span class="fc" id="L189">        return toJson(FieldType.notHidden());</span>
    }

    @Override
    default JsonObject toJson(final JsonSchemaVersion schemaVersion, final JsonFieldSelector fieldSelector) {
<span class="nc" id="L194">        return toJson(schemaVersion, FieldType.notHidden()).get(fieldSelector);</span>
    }

    /**
     * An enumeration of the known {@code JsonField}s of a {@code Connection}.
     */
    @Immutable
    final class JsonFields {

        /**
         * JSON field containing the {@code JsonSchemaVersion}.
         */
        public static final JsonFieldDefinition&lt;Integer&gt; SCHEMA_VERSION =
<span class="fc" id="L207">                JsonFactory.newIntFieldDefinition(JsonSchemaVersion.getJsonKey(), FieldType.SPECIAL, FieldType.HIDDEN,</span>
                        JsonSchemaVersion.V_1, JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code Connection} identifier.
         */
<span class="fc" id="L213">        public static final JsonFieldDefinition&lt;String&gt; ID =</span>
<span class="fc" id="L214">                JsonFactory.newStringFieldDefinition(&quot;id&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code ConnectionType}.
         */
<span class="fc" id="L220">        public static final JsonFieldDefinition&lt;String&gt; CONNECTION_TYPE =</span>
<span class="fc" id="L221">                JsonFactory.newStringFieldDefinition(&quot;connectionType&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code ConnectionStatus}.
         */
<span class="fc" id="L227">        public static final JsonFieldDefinition&lt;String&gt; CONNECTION_STATUS =</span>
<span class="fc" id="L228">                JsonFactory.newStringFieldDefinition(&quot;connectionStatus&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code Connection} uri.
         */
<span class="fc" id="L234">        public static final JsonFieldDefinition&lt;String&gt; URI =</span>
<span class="fc" id="L235">                JsonFactory.newStringFieldDefinition(&quot;uri&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code Connection} authorization context (list of authorization subjects).
         */
<span class="fc" id="L241">        public static final JsonFieldDefinition&lt;JsonArray&gt; AUTHORIZATION_CONTEXT =</span>
<span class="fc" id="L242">                JsonFactory.newJsonArrayFieldDefinition(&quot;authorizationContext&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code Connection} sources configuration.
         */
<span class="fc" id="L248">        public static final JsonFieldDefinition&lt;JsonArray&gt; SOURCES =</span>
<span class="fc" id="L249">                JsonFactory.newJsonArrayFieldDefinition(&quot;sources&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);
        /**
         * JSON field containing the {@code Connection} targets configuration.
         */
<span class="fc" id="L254">        public static final JsonFieldDefinition&lt;JsonArray&gt; TARGETS =</span>
<span class="fc" id="L255">                JsonFactory.newJsonArrayFieldDefinition(&quot;targets&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code Connection} client count.
         */
<span class="fc" id="L261">        public static final JsonFieldDefinition&lt;Integer&gt; CLIENT_COUNT =</span>
<span class="fc" id="L262">                JsonFactory.newIntFieldDefinition(&quot;clientCount&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code Connection} failover enabled.
         */
<span class="fc" id="L268">        public static final JsonFieldDefinition&lt;Boolean&gt; FAILOVER_ENABLED =</span>
<span class="fc" id="L269">                JsonFactory.newBooleanFieldDefinition(&quot;failoverEnabled&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code Connection} trust all certificates.
         */
<span class="fc" id="L275">        public static final JsonFieldDefinition&lt;Boolean&gt; VALIDATE_CERTIFICATES =</span>
<span class="fc" id="L276">                JsonFactory.newBooleanFieldDefinition(&quot;validateCertificates&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code Connection} processor pool size.
         */
<span class="fc" id="L282">        public static final JsonFieldDefinition&lt;Integer&gt; PROCESSOR_POOL_SIZE =</span>
<span class="fc" id="L283">                JsonFactory.newIntFieldDefinition(&quot;processorPoolSize&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code Connection} {@link ConnectionType} specific config.
         */
<span class="fc" id="L289">        public static final JsonFieldDefinition&lt;JsonObject&gt; SPECIFIC_CONFIG =</span>
<span class="fc" id="L290">                JsonFactory.newJsonObjectFieldDefinition(&quot;specificConfig&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

        /**
         * JSON field containing the {@code Connection} {@link MappingContext} to apply.
         */
<span class="fc" id="L296">        public static final JsonFieldDefinition&lt;JsonObject&gt; MAPPING_CONTEXT =</span>
<span class="fc" id="L297">                JsonFactory.newJsonObjectFieldDefinition(&quot;mappingContext&quot;, FieldType.REGULAR, JsonSchemaVersion.V_1,</span>
                        JsonSchemaVersion.V_2);

<span class="nc" id="L300">        private JsonFields() {</span>
<span class="nc" id="L301">            throw new AssertionError();</span>
        }

    }

    /**
     * An enumeration of regular expressions for an URI.
     */
    final class UriRegex {

        /**
         * Regex group for the protocol part of an URI.
         */
        public static final String PROTOCOL_REGEX_GROUP = &quot;protocol&quot;;

        /**
         * Regex for the protocol part of an URI.
         */
        private static final String PROTOCOL_REGEX = &quot;(?&lt;&quot; + PROTOCOL_REGEX_GROUP + &quot;&gt;amqps?)://&quot;;

        /**
         * Regex group for the username part of an URI.
         */
        public static final String USERNAME_REGEX_GROUP = &quot;username&quot;;

        /**
         * Regex for the username part of an URI.
         */
        private static final String USERNAME_REGEX = &quot;(?&lt;&quot; + USERNAME_REGEX_GROUP + &quot;&gt;(\\S+))&quot;;


        /**
         * Regex group for the password part of an URI.
         */
        @SuppressWarnings(&quot;squid:S2068&quot;)
        public static final String PASSWORD_REGEX_GROUP = &quot;password&quot;;

        /**
         * Regex for the password part of an URI.
         */
        private static final String PASSWORD_REGEX = &quot;(?&lt;&quot; + PASSWORD_REGEX_GROUP + &quot;&gt;(\\S+))&quot;;

        /**
         * Regex for the username part of an URI.
         */

        private static final String USERNAME_PASSWORD_REGEX = &quot;(&quot; + USERNAME_REGEX + &quot;:&quot; + PASSWORD_REGEX + &quot;@)?&quot;;
        /**
         * Regex group for the host part of an URI.
         */
        public static final String HOSTNAME_REGEX_GROUP = &quot;hostname&quot;;

        /**
         * Regex for the host part of an URI.
         */
        private static final String HOSTNAME_REGEX = &quot;(?&lt;&quot; + HOSTNAME_REGEX_GROUP + &quot;&gt;[\\S&amp;&amp;[^:]]+):&quot;;

        /**
         * Regex group for the port part of an URI.
         */
        public static final String PORT_REGEX_GROUP = &quot;port&quot;;

        /**
         * Regex for the port part of an URI.
         */
        private static final String PORT_REGEX = &quot;(?&lt;&quot; + PORT_REGEX_GROUP + &quot;&gt;(\\d*))?&quot;;

        /**
         * Regex group for the path part of an URI.
         */
        public static final String PATH_REGEX_GROUP = &quot;path&quot;;

        /**
         * Regex for the path part of an URI.
         */
        private static final String PATH_REGEX = &quot;(/(?&lt;&quot; + PATH_REGEX_GROUP + &quot;&gt;(\\S+))?)?&quot;;

        /**
         * Regex for an URI.
         */
        public static final String REGEX =
                PROTOCOL_REGEX + USERNAME_PASSWORD_REGEX + HOSTNAME_REGEX + PORT_REGEX + PATH_REGEX;

<span class="nc" id="L384">        private UriRegex() {</span>
<span class="nc" id="L385">            throw new AssertionError();</span>
        }

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>