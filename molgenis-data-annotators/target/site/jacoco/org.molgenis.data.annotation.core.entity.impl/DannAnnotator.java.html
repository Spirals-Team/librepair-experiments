<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DannAnnotator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">data-annotators</a> &gt; <a href="index.source.html" class="el_package">org.molgenis.data.annotation.core.entity.impl</a> &gt; <span class="el_source">DannAnnotator.java</span></div><h1>DannAnnotator.java</h1><pre class="source lang-java linenums">package org.molgenis.data.annotation.core.entity.impl;

import org.molgenis.data.DataService;
import org.molgenis.data.Entity;
import org.molgenis.data.annotation.core.RepositoryAnnotator;
import org.molgenis.data.annotation.core.entity.AnnotatorConfig;
import org.molgenis.data.annotation.core.entity.AnnotatorInfo;
import org.molgenis.data.annotation.core.entity.EntityAnnotator;
import org.molgenis.data.annotation.core.entity.impl.framework.AbstractAnnotator;
import org.molgenis.data.annotation.core.entity.impl.framework.RepositoryAnnotatorImpl;
import org.molgenis.data.annotation.core.filter.MultiAllelicResultFilter;
import org.molgenis.data.annotation.core.query.LocusQueryCreator;
import org.molgenis.data.annotation.core.resources.Resource;
import org.molgenis.data.annotation.core.resources.Resources;
import org.molgenis.data.annotation.core.resources.impl.RepositoryFactory;
import org.molgenis.data.annotation.core.resources.impl.ResourceImpl;
import org.molgenis.data.annotation.core.resources.impl.SingleResourceConfig;
import org.molgenis.data.annotation.core.resources.impl.tabix.TabixRepositoryFactory;
import org.molgenis.data.annotation.web.settings.SingleFileLocationCmdLineAnnotatorSettingsConfigurer;
import org.molgenis.data.meta.model.Attribute;
import org.molgenis.data.meta.model.AttributeFactory;
import org.molgenis.data.meta.model.EntityType;
import org.molgenis.data.meta.model.EntityTypeFactory;
import org.molgenis.data.vcf.model.VcfAttributes;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.ArrayList;
import java.util.List;

import static org.molgenis.data.annotation.web.settings.DannAnnotatorSettings.Meta.DANN_LOCATION;
import static org.molgenis.data.meta.AttributeType.STRING;

@Configuration
<span class="fc" id="L36">public class DannAnnotator implements AnnotatorConfig</span>
{
	public static final String NAME = &quot;dann&quot;;

	public static final String DANN_SCORE = &quot;DANN_SCORE&quot;;
	public static final String DANN_SCORE_LABEL = &quot;DANNSCORE&quot;;
	public static final String DANN_TABIX_RESOURCE = &quot;DANNTabixResource&quot;;

	@Autowired
	private Entity dannAnnotatorSettings;

	@Autowired
	private DataService dataService;

	@Autowired
	private Resources resources;

	@Autowired
	private VcfAttributes vcfAttributes;

	@Autowired
	private EntityTypeFactory entityTypeFactory;

	@Autowired
	private AttributeFactory attributeFactory;
	private RepositoryAnnotatorImpl annotator;

	@Bean
	public RepositoryAnnotator dann()
	{
<span class="fc" id="L66">		annotator = new RepositoryAnnotatorImpl(NAME);</span>
<span class="fc" id="L67">		return annotator;</span>
	}

	@Override
	public void init()
	{
<span class="fc" id="L73">		List&lt;Attribute&gt; attributes = createDannOutputAttributes();</span>

<span class="fc" id="L75">		AnnotatorInfo dannInfo = AnnotatorInfo.create(AnnotatorInfo.Status.READY,</span>
				AnnotatorInfo.Type.PATHOGENICITY_ESTIMATE, NAME,
				&quot;Annotating genetic variants, especially non-coding variants, &quot;
						+ &quot;for the purpose of identifying pathogenic variants remains a challenge.&quot;
						+ &quot; Combined annotation-dependent depletion (CADD) is an al- gorithm designed &quot;
						+ &quot;to annotate both coding and non-coding variants, and has been shown to outper- form &quot;
						+ &quot;other annotation algorithms. CADD trains a linear kernel support vector machine (SVM) &quot;
						+ &quot;to dif- ferentiate evolutionarily derived, likely benign, alleles from simulated, &quot;
						+ &quot;likely deleterious, variants. However, SVMs cannot capture non-linear relationships&quot;
						+ &quot; among the features, which can limit performance. To address this issue, we have&quot;
						+ &quot; developed DANN. DANN uses the same feature set and training data as CADD to train&quot;
						+ &quot; a deep neural network (DNN). DNNs can capture non-linear relation- ships among &quot;
						+ &quot;features and are better suited than SVMs for problems with a large number of samples &quot;
						+ &quot;and features. We exploit Compute Unified Device Architecture-compatible &quot;
						+ &quot;graphics processing units and deep learning techniques such as dropout and momentum &quot;
						+ &quot;training to accelerate the DNN training. DANN achieves about a 19%relative reduction &quot;
						+ &quot;in the error rate and about a 14%relative increase in the area under the curve (AUC) metric &quot;
						+ &quot;over CADDâ€™s SVM methodology. &quot;
						+ &quot;All data and source code are available at https://cbcl.ics.uci.edu/ public_data/DANN/.&quot;,
				attributes);

<span class="fc" id="L96">		EntityAnnotator entityAnnotator = new AbstractAnnotator(DANN_TABIX_RESOURCE, dannInfo,</span>
				new LocusQueryCreator(vcfAttributes), new MultiAllelicResultFilter(attributes, vcfAttributes),
				dataService, resources,
				new SingleFileLocationCmdLineAnnotatorSettingsConfigurer(DANN_LOCATION, dannAnnotatorSettings))
<span class="fc" id="L100">		{</span>
			@Override
			public List&lt;Attribute&gt; createAnnotatorAttributes(AttributeFactory attributeFactory)
			{
<span class="nc" id="L104">				return createDannOutputAttributes();</span>
			}
		};

<span class="fc" id="L108">		annotator.init(entityAnnotator);</span>
<span class="fc" id="L109">	}</span>

	private List&lt;Attribute&gt; createDannOutputAttributes()
	{
<span class="fc" id="L113">		List&lt;Attribute&gt; attributes = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L114">		Attribute dann_score = attributeFactory.create()</span>
<span class="fc" id="L115">											   .setName(DANN_SCORE)</span>
<span class="fc" id="L116">											   .setDataType(STRING)</span>
<span class="fc" id="L117">											   .setDescription(</span>
													   &quot;deleterious score of genetic variants using neural networks.&quot;)
<span class="fc" id="L119">											   .setLabel(DANN_SCORE_LABEL);</span>

<span class="fc" id="L121">		attributes.add(dann_score);</span>
<span class="fc" id="L122">		return attributes;</span>
	}

	@Bean
	Resource dannResource()
	{
		Resource dannTabixResource;

<span class="fc" id="L130">		dannTabixResource = new ResourceImpl(DANN_TABIX_RESOURCE,</span>
				new SingleResourceConfig(DANN_LOCATION, dannAnnotatorSettings))
<span class="fc" id="L132">		{</span>
			@Override
			public RepositoryFactory getRepositoryFactory()
			{

<span class="fc" id="L137">				String idAttrName = &quot;id&quot;;</span>
				// FIXME 4714 refactor to work with auto id, setPackage() and setName()
<span class="fc" id="L139">				EntityType repoMetaData = entityTypeFactory.create(DANN_TABIX_RESOURCE);</span>
<span class="fc" id="L140">				repoMetaData.addAttribute(vcfAttributes.getChromAttribute());</span>
<span class="fc" id="L141">				repoMetaData.addAttribute(vcfAttributes.getPosAttribute());</span>
<span class="fc" id="L142">				repoMetaData.addAttribute(vcfAttributes.getRefAttribute());</span>
<span class="fc" id="L143">				repoMetaData.addAttribute(vcfAttributes.getAltAttribute());</span>
<span class="fc" id="L144">				repoMetaData.addAttribute(attributeFactory.create().setName(&quot;DANN_SCORE&quot;).setDataType(STRING));</span>
<span class="fc" id="L145">				Attribute idAttribute = attributeFactory.create()</span>
<span class="fc" id="L146">														.setName(idAttrName)</span>
<span class="fc" id="L147">														.setVisible(false)</span>
<span class="fc" id="L148">														.setIdAttribute(true);</span>
<span class="fc" id="L149">				repoMetaData.addAttribute(idAttribute);</span>
<span class="fc" id="L150">				return new TabixRepositoryFactory(repoMetaData);</span>
			}
		};

<span class="fc" id="L154">		return dannTabixResource;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>