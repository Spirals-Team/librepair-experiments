<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RealizationServer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">PartThreeInputOutput</a> &gt; <a href="index.source.html" class="el_package">ru.aserdyuchenko.fileManager</a> &gt; <span class="el_source">RealizationServer.java</span></div><h1>RealizationServer.java</h1><pre class="source lang-java linenums">package ru.aserdyuchenko.fileManager;

import java.io.InputStream;
import java.io.OutputStream;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;
import java.io.File;
import java.nio.file.Files;
import java.util.Arrays;
import java.io.RandomAccessFile;
/**
 * @author Anton Serdyuchenko.
 */
public class RealizationServer {
/**
 * @param file - file.
 */
	private RandomAccessFile file;
/**
 * @param socket - socket.
 */
	private final Socket socket;
/**
 * @param port - port.
 */
	private static int port;
/**
 * Переменная нужна для перехода в нужный каталог.
 * @param nowPath.
 */
<span class="fc" id="L34">	private String nowPath = &quot;./&quot;;</span>
/**
 * Переменная нужна для перехода в нужный каталог.
 * @param homePath.
 */
<span class="fc" id="L39">	private String homePath = &quot;./&quot;;</span>
/**
 * @param socket - server socket.
 */
<span class="fc" id="L43">	public RealizationServer(Socket socket) {</span>
<span class="fc" id="L44">		this.socket = socket;</span>
<span class="fc" id="L45">	}</span>
/**
 * @param args - args.
 * @throws IOException - exception.
 */
	public static void main(String[] args) throws IOException {
<span class="nc" id="L51">		port = Integer.parseInt(readProperties(&quot;number.port&quot;));</span>
<span class="nc" id="L52">		try (final Socket socket = new ServerSocket(port).accept()) {</span>
<span class="nc" id="L53">			new RealizationServer(socket);</span>
<span class="nc bnc" id="L54" title="All 8 branches missed.">		}</span>
<span class="nc" id="L55">	}</span>
/**
 * @param newHomePath - home path.
 * @throws IOException - IOException.
 */
	public void startServer(String newHomePath) throws IOException {
<span class="fc" id="L61">		homePath = newHomePath;</span>

<span class="fc" id="L63">		InputStream socketInStr = socket.getInputStream();</span>
<span class="fc" id="L64">		OutputStream socketOutStr = socket.getOutputStream();</span>
<span class="fc" id="L65">		DataInputStream in = new DataInputStream(socketInStr);</span>
<span class="fc" id="L66">		DataOutputStream out = new DataOutputStream(socketOutStr);</span>
<span class="fc" id="L67">		String ask = null;</span>
		do {
<span class="fc" id="L69">   		System.out.println(&quot;wait command ...&quot;);</span>
<span class="fc" id="L70">    	ask = in.readLine();</span>
<span class="fc" id="L71">    	System.out.println(ask);</span>
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">			if (&quot;Go to&quot;.equals(ask)) {</span>
				do {
<span class="nc" id="L74">					ask = in.readLine();</span>
<span class="nc" id="L75">					out.writeBytes(Arrays.toString(seeThisPath(ask)));</span>
<span class="nc" id="L76">					ask = in.readLine();</span>
<span class="nc" id="L77">					out.writeBytes(&quot;\n&quot;);</span>
<span class="nc bnc" id="L78" title="All 2 branches missed.">				} while (!(&quot;Exit in menu&quot;.equals(ask)));</span>
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">			} else if (&quot;Go home&quot;.equals(ask)) {</span>
<span class="nc" id="L80">				nowPath = homePath;</span>
<span class="nc" id="L81">				out.writeBytes(Arrays.toString(seeHomePath()));</span>
<span class="nc" id="L82">				out.writeBytes(&quot;\n&quot;);</span>
<span class="fc bfc" id="L83" title="All 2 branches covered.">			} else if (&quot;Download&quot;.equals(ask)) {</span>
<span class="fc" id="L84">				ask = in.readLine();</span>
<span class="fc" id="L85">				out.write(downloadFile(ask));</span>
<span class="pc bpc" id="L86" title="1 of 2 branches missed.">			} else if (&quot;Push&quot;.equals(ask)) {</span>
				do {
<span class="nc" id="L88">					ask = in.readLine();</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">					if (&quot;Create new file&quot;.equals(ask)) {</span>
<span class="nc" id="L90">						ask = in.readLine();</span>
<span class="nc" id="L91">						createNewFileInServer(ask);</span>
<span class="nc" id="L92">						out.writeBytes(&quot;File create&quot;);</span>
<span class="nc" id="L93">						out.writeBytes(&quot;\n&quot;);</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">					} else if (&quot;Exit in menu&quot;.equals(ask)) {</span>
<span class="nc" id="L95">						out.writeBytes(&quot;Write in file done&quot;);</span>
<span class="nc" id="L96">						break;</span>
					} else {
<span class="nc" id="L98">						pushFile(ask);</span>
					}
<span class="nc bnc" id="L100" title="All 2 branches missed.">				} while (!(&quot;Exit in menu&quot;.equals(ask)));</span>
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">			} else if (!(&quot;Exit&quot;.equals(ask))) {</span>
<span class="nc" id="L102">				out.writeBytes(&quot;I don`t understand.\n&quot;);</span>
			}
<span class="fc bfc" id="L104" title="All 2 branches covered.">		} while (!(&quot;Exit&quot;.equals(ask)));</span>
<span class="fc" id="L105">	}</span>
/**
 * @param needValue - what value you need.
 * @return value - value.
 * @throws IOException - IOException.
 */
	public static String readProperties(String needValue) throws IOException {
<span class="nc" id="L112">		RealizationSettings settings = new RealizationSettings();</span>
<span class="nc" id="L113">		ClassLoader loader = RealizationSettings.class.getClassLoader();</span>
<span class="nc" id="L114">		try (InputStream io = loader.getResourceAsStream(&quot;app.properties&quot;)) {</span>
<span class="nc" id="L115">			settings.load(io);</span>
<span class="nc bnc" id="L116" title="All 8 branches missed.">		}</span>
<span class="nc" id="L117">		String value = settings.getValue(needValue);</span>
<span class="nc" id="L118">		return value;</span>
	}
/**
 * Возвращает список корневого каталога.
 * @return list - содержимое корневой папки.
 */
	public String[] seeHomePath() {
<span class="nc" id="L125">		String[] list = new File(homePath).list();</span>
<span class="nc" id="L126">		return list;</span>
	}
/**
 * Осуществляет переход в выбранные каталог.
 * @param thisPath - thisPath.
 * @return list - содержимое данной папки.
 */
	public String[] seeThisPath(String thisPath) {
<span class="nc" id="L134">		String[] list = new File(homePath + thisPath).list();</span>
<span class="nc" id="L135">		return list;</span>
	}
/**
 * Скачать файл.
 * @param nameFile - nameFile.
 * @return content - content.
 * @throws IOException - IOException.
 */
	public byte[] downloadFile(String nameFile) throws IOException {
<span class="fc" id="L144">		File file = new File(nameFile);</span>
<span class="fc" id="L145">		byte[] content = Files.readAllBytes(file.toPath());</span>
<span class="fc" id="L146">		return content;</span>
	}
/**
 * Загрузить файл.
 * @param bytesForNewFile - bytesForNewFile.
 * @throws IOException - IOException.
 */
	public void pushFile(String bytesForNewFile) throws IOException {
<span class="nc" id="L154">		file.writeBytes(bytesForNewFile);</span>
<span class="nc" id="L155">	}</span>
/**
 * Создание нового файла.
 * @param nameNewFile - nameNewFile.
 * @throws IOException - IOException.
 */
 public void createNewFileInServer(String nameNewFile) throws IOException {
<span class="nc" id="L162">	this.file = new RandomAccessFile(nameNewFile, &quot;rw&quot;);</span>
<span class="nc" id="L163"> }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>