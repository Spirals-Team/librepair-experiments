<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>IRetry.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">infrastructure</a> &gt; <a href="../index.html" class="el_bundle">runtime</a> &gt; <a href="index.source.html" class="el_package">org.corfudb.util.retry</a> &gt; <span class="el_source">IRetry.java</span></div><h1>IRetry.java</h1><pre class="source lang-java linenums">package org.corfudb.util.retry;

import java.util.function.Consumer;

import lombok.SneakyThrows;


/**
 * The IRetry interface is used to support retry loops by using different strategies
 * for the pause between the retries. It is done by a builder, that needs the
 * correct strategy and the lambda to be executed. The code in the run function is responsible
 * to handle the exceptions and to decide whether a retry is needed or the exception should be
 * thrown outside.
 *
 * &lt;p&gt;Created by mwei on 9/1/15
 */

public interface IRetry&lt;E extends Exception, F extends Exception, G extends Exception,
        H extends Exception, O, A extends IRetry&gt; {


    static &lt;R, Z extends IRetry&gt; IRetry&lt;RuntimeException, RuntimeException, RuntimeException,
            RuntimeException, R, Z&gt; build(Class&lt;Z&gt; retryType, IRetryable&lt;RuntimeException,
            RuntimeException, RuntimeException, RuntimeException, R&gt; runFunction) {
<span class="nc" id="L25">        return build(retryType, RuntimeException.class, RuntimeException.class,</span>
                RuntimeException.class, RuntimeException.class, runFunction);
    }

    static &lt;T extends Exception, R, Z extends IRetry&gt; IRetry&lt;T, RuntimeException, RuntimeException,
            RuntimeException, R, Z&gt; build(Class&lt;Z&gt; retryType, Class&lt;? extends T&gt; firstExceptionType,
                                          IRetryable&lt;T, RuntimeException, RuntimeException,
                                                  RuntimeException, R&gt; runFunction) {
<span class="nc" id="L33">        return build(retryType, firstExceptionType, RuntimeException.class, RuntimeException.class,</span>
                RuntimeException.class, runFunction);
    }

    static &lt;T extends Exception, U extends Exception, R, Z extends IRetry&gt; IRetry&lt;T, U,
            RuntimeException, RuntimeException, R, Z&gt; build(Class&lt;Z&gt; retryType,
                                                            Class&lt;? extends T&gt; firstExceptionType,
            Class&lt;? extends U&gt; secondExceptionType, IRetryable&lt;T, U, RuntimeException,
            RuntimeException, R&gt; runFunction) {
<span class="nc" id="L42">        return build(retryType, firstExceptionType, secondExceptionType, RuntimeException.class,</span>
                RuntimeException.class, runFunction);
    }

    static &lt;T extends Exception, U extends Exception, V extends Exception, R,
            Z extends IRetry&gt; IRetry&lt;T, U, V, RuntimeException, R,
            Z&gt; build(Class&lt;Z&gt; retryType,Class&lt;? extends T&gt; firstExceptionType,
                                                Class&lt;? extends U&gt; secondExceptionType,
            Class&lt;? extends V&gt; thirdExceptionType, IRetryable&lt;T, U, V,
            RuntimeException, R&gt; runFunction) {
<span class="nc" id="L52">        return build(retryType, firstExceptionType, secondExceptionType, thirdExceptionType,</span>
                RuntimeException.class, runFunction);
    }

<span class="nc" id="L56">    @SneakyThrows</span>
    static &lt;T extends Exception, U extends Exception, V extends Exception, W extends Exception, R,
            Z extends IRetry&gt;
                IRetry&lt;T, U, V, W, R, Z&gt; build(Class&lt;Z&gt; retryType,
                                               Class&lt;? extends T&gt; firstExceptionType,
                                               Class&lt;? extends U&gt; secondExceptionType,
                                               Class&lt;? extends V&gt; thirdExceptionType,
                                               Class&lt;? extends W&gt; fourthExceptionType, IRetryable&lt;T,
            U, V,
            W, R&gt; runFunction) {
<span class="nc" id="L66">        return (IRetry&lt;T, U, V, W, R, Z&gt;) retryType.getConstructor(IRetryable.class)</span>
<span class="nc" id="L67">                .newInstance(runFunction);</span>
    }


    /**
     * Run the retry. This function may never return.
     */
    default O run()
            throws E, F, G, H, InterruptedException {
        while (true) {
            try {
<span class="nc" id="L78">                return getRunFunction().retryFunction();</span>
<span class="nc" id="L79">            } catch (RetryNeededException ex) {</span>
                // retry requested
<span class="nc" id="L81">                nextWait();</span>
<span class="nc" id="L82">            }</span>
        }
    }

    /**
     * Get the function that needs to be retried.
     */
    IRetryable&lt;E, F, G, H, O&gt; getRunFunction();


    /**
     * Configure settings for the underlying class.
     * The consumer will be given access to the underlying retry type to configure
     * type-specific options.
     *
     * @param settingsFunction A consumer with access to the underlying retry type.
     * @return An IRetry, to support a fluent API interface.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    default IRetry&lt;E, F, G, H, O, A&gt; setOptions(Consumer&lt;A&gt; settingsFunction) {
<span class="nc" id="L102">        settingsFunction.accept((A) this);</span>
<span class="nc" id="L103">        return this;</span>
    }

    /**
     * Apply the retry logic.
     */
    void nextWait() throws InterruptedException;



}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>